(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var yr=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(yr||{}),Nd=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(Nd||{}),Ka=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Ka||{}),ut=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(ut||{}),Je=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Je||{}),O=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(O||{}),Gr=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Gr||{}),rt=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(rt||{}),Y=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Y||{}),yi=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(yi||{}),Gi=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Gi||{}),ni=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(ni||{}),ve=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(ve||{}),Ze=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Ze||{}),sl=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(sl||{}),Te=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Te||{}),qt=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(qt||{}),jt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(jt||{}),ti=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(ti||{});const Vg={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},q={ADAPTER:Vg,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var ra=/iPhone/i,lu=/iPod/i,uu=/iPad/i,cu=/\biOS-universal(?:.+)Mac\b/i,na=/\bAndroid(?:.+)Mobile\b/i,du=/Android/i,Er=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,ss=/Silk/i,ci=/Windows Phone/i,fu=/\bWindows(?:.+)ARM\b/i,pu=/BlackBerry/i,gu=/BB10/i,mu=/Opera Mini/i,yu=/\b(CriOS|Chrome)(?:.+)Mobile/i,vu=/Mobile(?:.+)Firefox\b/i,_u=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function jg(i){return function(t){return t.test(i)}}function xu(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=jg(e),s={apple:{phone:n(ra)&&!n(ci),ipod:n(lu),tablet:!n(ra)&&(n(uu)||_u(t))&&!n(ci),universal:n(cu),device:(n(ra)||n(lu)||n(uu)||n(cu)||_u(t))&&!n(ci)},amazon:{phone:n(Er),tablet:!n(Er)&&n(ss),device:n(Er)||n(ss)},android:{phone:!n(ci)&&n(Er)||!n(ci)&&n(na),tablet:!n(ci)&&!n(Er)&&!n(na)&&(n(ss)||n(du)),device:!n(ci)&&(n(Er)||n(ss)||n(na)||n(du))||n(/\bokhttp\b/i)},windows:{phone:n(ci),tablet:n(fu),device:n(ci)||n(fu)},other:{blackberry:n(pu),blackberry10:n(gu),opera:n(mu),firefox:n(vu),chrome:n(yu),device:n(pu)||n(gu)||n(mu)||n(vu)||n(yu)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const Yg=xu.default??xu,vi=Yg(globalThis.navigator);q.RETINA_PREFIX=/@([0-9\.]+)x/;q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function qg(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var Bd={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function s(h,l,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,c||h,d),p=e?e+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p},a.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},a.prototype.emit=function(l,u,c,d,f,p){var g=e?e+l:l;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,_,v;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,c),!0;case 4:return m.fn.call(m.context,u,c,d),!0;case 5:return m.fn.call(m.context,u,c,d,f),!0;case 6:return m.fn.call(m.context,u,c,d,f,p),!0}for(v=1,_=new Array(y-1);v<y;v++)_[v-1]=arguments[v];m.fn.apply(m.context,_)}else{var x=m.length,E;for(v=0;v<x;v++)switch(m[v].once&&this.removeListener(l,m[v].fn,void 0,!0),y){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,u);break;case 3:m[v].fn.call(m[v].context,u,c);break;case 4:m[v].fn.call(m[v].context,u,c,d);break;default:if(!_)for(E=1,_=new Array(y-1);E<y;E++)_[E-1]=arguments[E];m[v].fn.apply(m[v].context,_)}}return!0},a.prototype.on=function(l,u,c){return s(this,l,u,c,!1)},a.prototype.once=function(l,u,c){return s(this,l,u,c,!0)},a.prototype.removeListener=function(l,u,c,d){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!c||p.context===c)&&o(this,f);else{for(var g=0,m=[],y=p.length;g<y;g++)(p[g].fn!==u||d&&!p[g].once||c&&p[g].context!==c)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(Bd);var Kg=Bd.exports;const Vn=Xn(Kg);var ol={exports:{}};ol.exports=Ro;ol.exports.default=Ro;function Ro(i,t,e){e=e||2;var r=t&&t.length,n=r?t[0]*e:i.length,s=Ld(i,0,n,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,h,l,u,c,d,f;if(r&&(s=em(i,t,s,e)),i.length>80*e){a=l=i[0],h=u=i[1];for(var p=e;p<n;p+=e)c=i[p],d=i[p+1],c<a&&(a=c),d<h&&(h=d),c>l&&(l=c),d>u&&(u=d);f=Math.max(l-a,u-h),f=f!==0?32767/f:0}return kn(s,o,e,a,h,f,0),o}function Ld(i,t,e,r,n){var s,o;if(n===Ja(i,t,e,r)>0)for(s=t;s<e;s+=r)o=wu(s,i[s],i[s+1],o);else for(s=e-r;s>=t;s-=r)o=wu(s,i[s],i[s+1],o);return o&&Do(o,o.next)&&(Un(o),o=o.next),o}function cr(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(Do(e,e.next)||Ft(e.prev,e,e.next)===0)){if(Un(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function kn(i,t,e,r,n,s,o){if(i){!o&&s&&om(i,r,n,s);for(var a=i,h,l;i.prev!==i.next;){if(h=i.prev,l=i.next,s?Qg(i,r,n,s):Zg(i)){t.push(h.i/e|0),t.push(i.i/e|0),t.push(l.i/e|0),Un(i),i=l.next,a=l.next;continue}if(i=l,i===a){o?o===1?(i=Jg(cr(i),t,e),kn(i,t,e,r,n,s,2)):o===2&&tm(i,t,e,r,n,s):kn(cr(i),t,e,r,n,s,1);break}}}}function Zg(i){var t=i.prev,e=i,r=i.next;if(Ft(t,e,r)>=0)return!1;for(var n=t.x,s=e.x,o=r.x,a=t.y,h=e.y,l=r.y,u=n<s?n<o?n:o:s<o?s:o,c=a<h?a<l?a:l:h<l?h:l,d=n>s?n>o?n:o:s>o?s:o,f=a>h?a>l?a:l:h>l?h:l,p=r.next;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&Fr(n,a,s,h,o,l,p.x,p.y)&&Ft(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Qg(i,t,e,r){var n=i.prev,s=i,o=i.next;if(Ft(n,s,o)>=0)return!1;for(var a=n.x,h=s.x,l=o.x,u=n.y,c=s.y,d=o.y,f=a<h?a<l?a:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,g=a>h?a>l?a:l:h>l?h:l,m=u>c?u>d?u:d:c>d?c:d,y=Za(f,p,t,e,r),_=Za(g,m,t,e,r),v=i.prevZ,x=i.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=f&&v.x<=g&&v.y>=p&&v.y<=m&&v!==n&&v!==o&&Fr(a,u,h,c,l,d,v.x,v.y)&&Ft(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=f&&x.x<=g&&x.y>=p&&x.y<=m&&x!==n&&x!==o&&Fr(a,u,h,c,l,d,x.x,x.y)&&Ft(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=g&&v.y>=p&&v.y<=m&&v!==n&&v!==o&&Fr(a,u,h,c,l,d,v.x,v.y)&&Ft(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=g&&x.y>=p&&x.y<=m&&x!==n&&x!==o&&Fr(a,u,h,c,l,d,x.x,x.y)&&Ft(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Jg(i,t,e){var r=i;do{var n=r.prev,s=r.next.next;!Do(n,s)&&Od(n,r,r.next,s)&&Fn(n,s)&&Fn(s,n)&&(t.push(n.i/e|0),t.push(r.i/e|0),t.push(s.i/e|0),Un(r),Un(r.next),r=i=s),r=r.next}while(r!==i);return cr(r)}function tm(i,t,e,r,n,s){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&lm(o,a)){var h=kd(o,a);o=cr(o,o.next),h=cr(h,h.next),kn(o,t,e,r,n,s,0),kn(h,t,e,r,n,s,0);return}a=a.next}o=o.next}while(o!==i)}function em(i,t,e,r){var n=[],s,o,a,h,l;for(s=0,o=t.length;s<o;s++)a=t[s]*r,h=s<o-1?t[s+1]*r:i.length,l=Ld(i,a,h,r,!1),l===l.next&&(l.steiner=!0),n.push(hm(l));for(n.sort(im),s=0;s<n.length;s++)e=rm(n[s],e);return e}function im(i,t){return i.x-t.x}function rm(i,t){var e=nm(i,t);if(!e)return t;var r=kd(e,i);return cr(r,r.next),cr(e,e.next)}function nm(i,t){var e=t,r=i.x,n=i.y,s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===r))return o}e=e.next}while(e!==t);if(!o)return null;var h=o,l=o.x,u=o.y,c=1/0,d;e=o;do r>=e.x&&e.x>=l&&r!==e.x&&Fr(n<u?r:s,n,l,u,n<u?s:r,n,e.x,e.y)&&(d=Math.abs(n-e.y)/(r-e.x),Fn(e,i)&&(d<c||d===c&&(e.x>o.x||e.x===o.x&&sm(o,e)))&&(o=e,c=d)),e=e.next;while(e!==h);return o}function sm(i,t){return Ft(i.prev,i,t.prev)<0&&Ft(t.next,i,i.next)<0}function om(i,t,e,r){var n=i;do n.z===0&&(n.z=Za(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,am(n)}function am(i){var t,e,r,n,s,o,a,h,l=1;do{for(e=i,i=null,s=null,o=0;e;){for(o++,r=e,a=0,t=0;t<l&&(a++,r=r.nextZ,!!r);t++);for(h=l;a>0||h>0&&r;)a!==0&&(h===0||!r||e.z<=r.z)?(n=e,e=e.nextZ,a--):(n=r,r=r.nextZ,h--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;e=r}s.nextZ=null,l*=2}while(o>1);return i}function Za(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function hm(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Fr(i,t,e,r,n,s,o,a){return(n-o)*(t-a)>=(i-o)*(s-a)&&(i-o)*(r-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(n-o)*(r-a)}function lm(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!um(i,t)&&(Fn(i,t)&&Fn(t,i)&&cm(i,t)&&(Ft(i.prev,i,t.prev)||Ft(i,t.prev,t))||Do(i,t)&&Ft(i.prev,i,i.next)>0&&Ft(t.prev,t,t.next)>0)}function Ft(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Do(i,t){return i.x===t.x&&i.y===t.y}function Od(i,t,e,r){var n=as(Ft(i,t,e)),s=as(Ft(i,t,r)),o=as(Ft(e,r,i)),a=as(Ft(e,r,t));return!!(n!==s&&o!==a||n===0&&os(i,e,t)||s===0&&os(i,r,t)||o===0&&os(e,i,r)||a===0&&os(e,t,r))}function os(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function as(i){return i>0?1:i<0?-1:0}function um(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Od(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Fn(i,t){return Ft(i.prev,i,i.next)<0?Ft(i,t,i.next)>=0&&Ft(i,i.prev,t)>=0:Ft(i,t,i.prev)<0||Ft(i,i.next,t)<0}function cm(i,t){var e=i,r=!1,n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function kd(i,t){var e=new Qa(i.i,i.x,i.y),r=new Qa(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function wu(i,t,e,r){var n=new Qa(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Un(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Qa(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ro.deviation=function(i,t,e,r){var n=t&&t.length,s=n?t[0]*e:i.length,o=Math.abs(Ja(i,0,s,e));if(n)for(var a=0,h=t.length;a<h;a++){var l=t[a]*e,u=a<h-1?t[a+1]*e:i.length;o-=Math.abs(Ja(i,l,u,e))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*e,f=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((i[d]-i[p])*(i[f+1]-i[d+1])-(i[d]-i[f])*(i[p+1]-i[d+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function Ja(i,t,e,r){for(var n=0,s=t,o=e-r;s<e;s+=r)n+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return n}Ro.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,n=0;n<i.length;n++){for(var s=0;s<i[n].length;s++)for(var o=0;o<t;o++)e.vertices.push(i[n][s][o]);n>0&&(r+=i[n-1].length,e.holes.push(r))}return e};var dm=ol.exports;const fm=Xn(dm);var Zs={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Zs.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,s=typeof Os=="object"&&Os;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,g="-",m=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,E=Math.floor,N=String.fromCharCode,I;function S(k){throw new RangeError(v[k])}function D(k,F){for(var ct=k.length,bt=[];ct--;)bt[ct]=F(k[ct]);return bt}function U(k,F){var ct=k.split("@"),bt="";ct.length>1&&(bt=ct[0]+"@",k=ct[1]),k=k.replace(_,".");var yt=k.split("."),St=D(yt,F).join(".");return bt+St}function L(k){for(var F=[],ct=0,bt=k.length,yt,St;ct<bt;)yt=k.charCodeAt(ct++),yt>=55296&&yt<=56319&&ct<bt?(St=k.charCodeAt(ct++),(St&64512)==56320?F.push(((yt&1023)<<10)+(St&1023)+65536):(F.push(yt),ct--)):F.push(yt);return F}function C(k){return D(k,function(F){var ct="";return F>65535&&(F-=65536,ct+=N(F>>>10&1023|55296),F=56320|F&1023),ct+=N(F),ct}).join("")}function b(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:h}function R(k,F){return k+22+75*(k<26)-((F!=0)<<5)}function tt(k,F,ct){var bt=0;for(k=ct?E(k/d):k>>1,k+=E(k/F);k>x*u>>1;bt+=h)k=E(k/x);return E(bt+(x+1)*k/(k+c))}function et(k){var F=[],ct=k.length,bt,yt=0,St=p,Rt=f,Gt,$t,le,Yt,Dt,Nt,It,ye,A;for(Gt=k.lastIndexOf(g),Gt<0&&(Gt=0),$t=0;$t<Gt;++$t)k.charCodeAt($t)>=128&&S("not-basic"),F.push(k.charCodeAt($t));for(le=Gt>0?Gt+1:0;le<ct;){for(Yt=yt,Dt=1,Nt=h;le>=ct&&S("invalid-input"),It=b(k.charCodeAt(le++)),(It>=h||It>E((a-yt)/Dt))&&S("overflow"),yt+=It*Dt,ye=Nt<=Rt?l:Nt>=Rt+u?u:Nt-Rt,!(It<ye);Nt+=h)A=h-ye,Dt>E(a/A)&&S("overflow"),Dt*=A;bt=F.length+1,Rt=tt(yt-Yt,bt,Yt==0),E(yt/bt)>a-St&&S("overflow"),St+=E(yt/bt),yt%=bt,F.splice(yt++,0,St)}return C(F)}function Z(k){var F,ct,bt,yt,St,Rt,Gt,$t,le,Yt,Dt,Nt=[],It,ye,A,hi;for(k=L(k),It=k.length,F=p,ct=0,St=f,Rt=0;Rt<It;++Rt)Dt=k[Rt],Dt<128&&Nt.push(N(Dt));for(bt=yt=Nt.length,yt&&Nt.push(g);bt<It;){for(Gt=a,Rt=0;Rt<It;++Rt)Dt=k[Rt],Dt>=F&&Dt<Gt&&(Gt=Dt);for(ye=bt+1,Gt-F>E((a-ct)/ye)&&S("overflow"),ct+=(Gt-F)*ye,F=Gt,Rt=0;Rt<It;++Rt)if(Dt=k[Rt],Dt<F&&++ct>a&&S("overflow"),Dt==F){for($t=ct,le=h;Yt=le<=St?l:le>=St+u?u:le-St,!($t<Yt);le+=h)hi=$t-Yt,A=h-Yt,Nt.push(N(R(Yt+hi%A,0))),$t=E(hi/A);Nt.push(N(R($t,0))),St=tt(ct,ye,bt==yt),ct=0,++bt}++ct,++F}return Nt.join("")}function at(k){return U(k,function(F){return m.test(F)?et(F.slice(4).toLowerCase()):F})}function gt(k){return U(k,function(F){return y.test(F)?"xn--"+Z(F):F})}if(o={version:"1.4.1",ucs2:{decode:L,encode:C},decode:et,encode:Z,toASCII:gt,toUnicode:at},r&&n)if(i.exports==r)n.exports=o;else for(I in o)o.hasOwnProperty(I)&&(r[I]=o[I]);else e.punycode=o})(Os)})(Zs,Zs.exports);var pm=Zs.exports,gm=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var s=Object.getOwnPropertySymbols(t);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==n||o.enumerable!==!0)return!1}return!0},bu=typeof Symbol<"u"&&Symbol,mm=gm,ym=function(){return typeof bu!="function"||typeof Symbol!="function"||typeof bu("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:mm()},Eu={foo:{}},vm=Object,_m=function(){return{__proto__:Eu}.foo===Eu.foo&&!({__proto__:null}instanceof vm)},xm="Function.prototype.bind called on incompatible ",wm=Object.prototype.toString,bm=Math.max,Em="[object Function]",Au=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var s=0;s<e.length;s+=1)r[s+t.length]=e[s];return r},Am=function(t,e){for(var r=[],n=e||0,s=0;n<t.length;n+=1,s+=1)r[s]=t[n];return r},Sm=function(i,t){for(var e="",r=0;r<i.length;r+=1)e+=i[r],r+1<i.length&&(e+=t);return e},Tm=function(t){var e=this;if(typeof e!="function"||wm.apply(e)!==Em)throw new TypeError(xm+e);for(var r=Am(arguments,1),n,s=function(){if(this instanceof n){var u=e.apply(this,Au(r,arguments));return Object(u)===u?u:this}return e.apply(t,Au(r,arguments))},o=bm(0,e.length-r.length),a=[],h=0;h<o;h++)a[h]="$"+h;if(n=Function("binder","return function ("+Sm(a,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var l=function(){};l.prototype=e.prototype,n.prototype=new l,l.prototype=null}return n},Im=Tm,al=Function.prototype.bind||Im,Cm=Function.prototype.call,Mm=Object.prototype.hasOwnProperty,Pm=al,Rm=Pm.call(Cm,Mm),wt,qr=SyntaxError,Fd=Function,$r=TypeError,sa=function(i){try{return Fd('"use strict"; return ('+i+").constructor;")()}catch{}},or=Object.getOwnPropertyDescriptor;if(or)try{or({},"")}catch{or=null}var oa=function(){throw new $r},Dm=or?function(){try{return arguments.callee,oa}catch{try{return or(arguments,"callee").get}catch{return oa}}}():oa,Ar=ym(),Nm=_m(),te=Object.getPrototypeOf||(Nm?function(i){return i.__proto__}:null),Rr={},Bm=typeof Uint8Array>"u"||!te?wt:te(Uint8Array),ar={"%AggregateError%":typeof AggregateError>"u"?wt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?wt:ArrayBuffer,"%ArrayIteratorPrototype%":Ar&&te?te([][Symbol.iterator]()):wt,"%AsyncFromSyncIteratorPrototype%":wt,"%AsyncFunction%":Rr,"%AsyncGenerator%":Rr,"%AsyncGeneratorFunction%":Rr,"%AsyncIteratorPrototype%":Rr,"%Atomics%":typeof Atomics>"u"?wt:Atomics,"%BigInt%":typeof BigInt>"u"?wt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?wt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?wt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?wt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?wt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?wt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?wt:FinalizationRegistry,"%Function%":Fd,"%GeneratorFunction%":Rr,"%Int8Array%":typeof Int8Array>"u"?wt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?wt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?wt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ar&&te?te(te([][Symbol.iterator]())):wt,"%JSON%":typeof JSON=="object"?JSON:wt,"%Map%":typeof Map>"u"?wt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ar||!te?wt:te(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?wt:Promise,"%Proxy%":typeof Proxy>"u"?wt:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?wt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?wt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ar||!te?wt:te(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?wt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ar&&te?te(""[Symbol.iterator]()):wt,"%Symbol%":Ar?Symbol:wt,"%SyntaxError%":qr,"%ThrowTypeError%":Dm,"%TypedArray%":Bm,"%TypeError%":$r,"%Uint8Array%":typeof Uint8Array>"u"?wt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?wt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?wt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?wt:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?wt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?wt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?wt:WeakSet};if(te)try{null.error}catch(i){var Lm=te(te(i));ar["%Error.prototype%"]=Lm}var Om=function i(t){var e;if(t==="%AsyncFunction%")e=sa("async function () {}");else if(t==="%GeneratorFunction%")e=sa("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=sa("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=i("%AsyncGenerator%");n&&te&&(e=te(n.prototype))}return ar[t]=e,e},Su={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},jn=al,Qs=Rm,km=jn.call(Function.call,Array.prototype.concat),Fm=jn.call(Function.apply,Array.prototype.splice),Tu=jn.call(Function.call,String.prototype.replace),Js=jn.call(Function.call,String.prototype.slice),Um=jn.call(Function.call,RegExp.prototype.exec),Gm=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,$m=/\\(\\)?/g,Hm=function(t){var e=Js(t,0,1),r=Js(t,-1);if(e==="%"&&r!=="%")throw new qr("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new qr("invalid intrinsic syntax, expected opening `%`");var n=[];return Tu(t,Gm,function(s,o,a,h){n[n.length]=a?Tu(h,$m,"$1"):o||s}),n},zm=function(t,e){var r=t,n;if(Qs(Su,r)&&(n=Su[r],r="%"+n[0]+"%"),Qs(ar,r)){var s=ar[r];if(s===Rr&&(s=Om(r)),typeof s>"u"&&!e)throw new $r("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new qr("intrinsic "+t+" does not exist!")},vr=function(t,e){if(typeof t!="string"||t.length===0)throw new $r("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new $r('"allowMissing" argument must be a boolean');if(Um(/^%?[^%]*%?$/,t)===null)throw new qr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=Hm(t),n=r.length>0?r[0]:"",s=zm("%"+n+"%",e),o=s.name,a=s.value,h=!1,l=s.alias;l&&(n=l[0],Fm(r,km([0,1],l)));for(var u=1,c=!0;u<r.length;u+=1){var d=r[u],f=Js(d,0,1),p=Js(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new qr("property names with quotes must have matching quotes");if((d==="constructor"||!c)&&(h=!0),n+="."+d,o="%"+n+"%",Qs(ar,o))a=ar[o];else if(a!=null){if(!(d in a)){if(!e)throw new $r("base intrinsic for "+t+" exists, but the property is not available.");return}if(or&&u+1>=r.length){var g=or(a,d);c=!!g,c&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[d]}else c=Qs(a,d),a=a[d];c&&!h&&(ar[o]=a)}}return a},Ud={exports:{}},Wm=vr,th=Wm("%Object.defineProperty%",!0),eh=function(){if(th)try{return th({},"a",{value:1}),!0}catch{return!1}return!1};eh.hasArrayLengthDefineBug=function(){if(!eh())return null;try{return th([],"length",{value:1}).length!==1}catch{return!0}};var Gd=eh,Xm=vr,ks=Xm("%Object.getOwnPropertyDescriptor%",!0);if(ks)try{ks([],"length")}catch{ks=null}var $d=ks,Vm=Gd(),hl=vr,Dn=Vm&&hl("%Object.defineProperty%",!0);if(Dn)try{Dn({},"a",{value:1})}catch{Dn=!1}var jm=hl("%SyntaxError%"),Sr=hl("%TypeError%"),Iu=$d,Ym=function(t,e,r){if(!t||typeof t!="object"&&typeof t!="function")throw new Sr("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Sr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Sr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Sr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Sr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Sr("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,h=!!Iu&&Iu(t,e);if(Dn)Dn(t,e,{configurable:o===null&&h?h.configurable:!o,enumerable:n===null&&h?h.enumerable:!n,value:r,writable:s===null&&h?h.writable:!s});else if(a||!n&&!s&&!o)t[e]=r;else throw new jm("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Hd=vr,Cu=Ym,qm=Gd(),Mu=$d,Pu=Hd("%TypeError%"),Km=Hd("%Math.floor%"),Zm=function(t,e){if(typeof t!="function")throw new Pu("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||Km(e)!==e)throw new Pu("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,s=!0;if("length"in t&&Mu){var o=Mu(t,"length");o&&!o.configurable&&(n=!1),o&&!o.writable&&(s=!1)}return(n||s||!r)&&(qm?Cu(t,"length",e,!0,!0):Cu(t,"length",e)),t};(function(i){var t=al,e=vr,r=Zm,n=e("%TypeError%"),s=e("%Function.prototype.apply%"),o=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||t.call(o,s),h=e("%Object.defineProperty%",!0),l=e("%Math.max%");if(h)try{h({},"a",{value:1})}catch{h=null}i.exports=function(d){if(typeof d!="function")throw new n("a function is required");var f=a(t,o,arguments);return r(f,1+l(0,d.length-(arguments.length-1)),!0)};var u=function(){return a(t,s,arguments)};h?h(i.exports,"apply",{value:u}):i.exports.apply=u})(Ud);var Qm=Ud.exports,zd=vr,Wd=Qm,Jm=Wd(zd("String.prototype.indexOf")),ty=function(t,e){var r=zd(t,!!e);return typeof r=="function"&&Jm(t,".prototype.")>-1?Wd(r):r};const ey={},iy=Object.freeze(Object.defineProperty({__proto__:null,default:ey},Symbol.toStringTag,{value:"Module"})),ry=qg(iy);var ll=typeof Map=="function"&&Map.prototype,aa=Object.getOwnPropertyDescriptor&&ll?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,to=ll&&aa&&typeof aa.get=="function"?aa.get:null,Ru=ll&&Map.prototype.forEach,ul=typeof Set=="function"&&Set.prototype,ha=Object.getOwnPropertyDescriptor&&ul?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,eo=ul&&ha&&typeof ha.get=="function"?ha.get:null,Du=ul&&Set.prototype.forEach,ny=typeof WeakMap=="function"&&WeakMap.prototype,Nn=ny?WeakMap.prototype.has:null,sy=typeof WeakSet=="function"&&WeakSet.prototype,Bn=sy?WeakSet.prototype.has:null,oy=typeof WeakRef=="function"&&WeakRef.prototype,Nu=oy?WeakRef.prototype.deref:null,ay=Boolean.prototype.valueOf,hy=Object.prototype.toString,ly=Function.prototype.toString,uy=String.prototype.match,cl=String.prototype.slice,Li=String.prototype.replace,cy=String.prototype.toUpperCase,Bu=String.prototype.toLowerCase,Xd=RegExp.prototype.test,Lu=Array.prototype.concat,Qe=Array.prototype.join,dy=Array.prototype.slice,Ou=Math.floor,ih=typeof BigInt=="function"?BigInt.prototype.valueOf:null,la=Object.getOwnPropertySymbols,rh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Kr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",he=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Kr||"symbol")?Symbol.toStringTag:null,Vd=Object.prototype.propertyIsEnumerable,ku=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function Fu(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||Xd.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-Ou(-i):Ou(i);if(r!==i){var n=String(r),s=cl.call(t,n.length+1);return Li.call(n,e,"$&_")+"."+Li.call(Li.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Li.call(t,e,"$&_")}var nh=ry,Uu=nh.custom,Gu=Yd(Uu)?Uu:null,fy=function i(t,e,r,n){var s=e||{};if(Ni(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ni(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Ni(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ni(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ni(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Kd(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var h=String(t);return a?Fu(t,h):h}if(typeof t=="bigint"){var l=String(t)+"n";return a?Fu(t,l):l}var u=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=u&&u>0&&typeof t=="object")return sh(t)?"[Array]":"[Object]";var c=Ry(s,r);if(typeof n>"u")n=[];else if(qd(n,t)>=0)return"[Circular]";function d(b,R,tt){if(R&&(n=dy.call(n),n.push(R)),tt){var et={depth:s.depth};return Ni(s,"quoteStyle")&&(et.quoteStyle=s.quoteStyle),i(b,et,r+1,n)}return i(b,s,r+1,n)}if(typeof t=="function"&&!$u(t)){var f=by(t),p=hs(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+Qe.call(p,", ")+" }":"")}if(Yd(t)){var g=Kr?Li.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):rh.call(t);return typeof t=="object"&&!Kr?fn(g):g}if(Cy(t)){for(var m="<"+Bu.call(String(t.nodeName)),y=t.attributes||[],_=0;_<y.length;_++)m+=" "+y[_].name+"="+jd(py(y[_].value),"double",s);return m+=">",t.childNodes&&t.childNodes.length&&(m+="..."),m+="</"+Bu.call(String(t.nodeName))+">",m}if(sh(t)){if(t.length===0)return"[]";var v=hs(t,d);return c&&!Py(v)?"["+oh(v,c)+"]":"[ "+Qe.call(v,", ")+" ]"}if(my(t)){var x=hs(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Vd.call(t,"cause")?"{ ["+String(t)+"] "+Qe.call(Lu.call("[cause]: "+d(t.cause),x),", ")+" }":x.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Qe.call(x,", ")+" }"}if(typeof t=="object"&&o){if(Gu&&typeof t[Gu]=="function"&&nh)return nh(t,{depth:u-r});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Ey(t)){var E=[];return Ru&&Ru.call(t,function(b,R){E.push(d(R,t,!0)+" => "+d(b,t))}),Hu("Map",to.call(t),E,c)}if(Ty(t)){var N=[];return Du&&Du.call(t,function(b){N.push(d(b,t))}),Hu("Set",eo.call(t),N,c)}if(Ay(t))return ua("WeakMap");if(Iy(t))return ua("WeakSet");if(Sy(t))return ua("WeakRef");if(vy(t))return fn(d(Number(t)));if(xy(t))return fn(d(ih.call(t)));if(_y(t))return fn(ay.call(t));if(yy(t))return fn(d(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Os)return"{ [object globalThis] }";if(!gy(t)&&!$u(t)){var I=hs(t,d),S=ku?ku(t)===Object.prototype:t instanceof Object||t.constructor===Object,D=t instanceof Object?"":"null prototype",U=!S&&he&&Object(t)===t&&he in t?cl.call(zi(t),8,-1):D?"Object":"",L=S||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",C=L+(U||D?"["+Qe.call(Lu.call([],U||[],D||[]),": ")+"] ":"");return I.length===0?C+"{}":c?C+"{"+oh(I,c)+"}":C+"{ "+Qe.call(I,", ")+" }"}return String(t)};function jd(i,t,e){var r=(e.quoteStyle||t)==="double"?'"':"'";return r+i+r}function py(i){return Li.call(String(i),/"/g,"&quot;")}function sh(i){return zi(i)==="[object Array]"&&(!he||!(typeof i=="object"&&he in i))}function gy(i){return zi(i)==="[object Date]"&&(!he||!(typeof i=="object"&&he in i))}function $u(i){return zi(i)==="[object RegExp]"&&(!he||!(typeof i=="object"&&he in i))}function my(i){return zi(i)==="[object Error]"&&(!he||!(typeof i=="object"&&he in i))}function yy(i){return zi(i)==="[object String]"&&(!he||!(typeof i=="object"&&he in i))}function vy(i){return zi(i)==="[object Number]"&&(!he||!(typeof i=="object"&&he in i))}function _y(i){return zi(i)==="[object Boolean]"&&(!he||!(typeof i=="object"&&he in i))}function Yd(i){if(Kr)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!rh)return!1;try{return rh.call(i),!0}catch{}return!1}function xy(i){if(!i||typeof i!="object"||!ih)return!1;try{return ih.call(i),!0}catch{}return!1}var wy=Object.prototype.hasOwnProperty||function(i){return i in this};function Ni(i,t){return wy.call(i,t)}function zi(i){return hy.call(i)}function by(i){if(i.name)return i.name;var t=uy.call(ly.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function qd(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function Ey(i){if(!to||!i||typeof i!="object")return!1;try{to.call(i);try{eo.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function Ay(i){if(!Nn||!i||typeof i!="object")return!1;try{Nn.call(i,Nn);try{Bn.call(i,Bn)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function Sy(i){if(!Nu||!i||typeof i!="object")return!1;try{return Nu.call(i),!0}catch{}return!1}function Ty(i){if(!eo||!i||typeof i!="object")return!1;try{eo.call(i);try{to.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function Iy(i){if(!Bn||!i||typeof i!="object")return!1;try{Bn.call(i,Bn);try{Nn.call(i,Nn)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function Cy(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function Kd(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return Kd(cl.call(i,0,t.maxStringLength),t)+r}var n=Li.call(Li.call(i,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,My);return jd(n,"single",t)}function My(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+cy.call(t.toString(16))}function fn(i){return"Object("+i+")"}function ua(i){return i+" { ? }"}function Hu(i,t,e,r){var n=r?oh(e,r):Qe.call(e,", ");return i+" ("+t+") {"+n+"}"}function Py(i){for(var t=0;t<i.length;t++)if(qd(i[t],`
`)>=0)return!1;return!0}function Ry(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=Qe.call(Array(i.indent+1)," ");else return null;return{base:e,prev:Qe.call(Array(t+1),e)}}function oh(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+Qe.call(i,","+e)+`
`+t.prev}function hs(i,t){var e=sh(i),r=[];if(e){r.length=i.length;for(var n=0;n<i.length;n++)r[n]=Ni(i,n)?t(i[n],i):""}var s=typeof la=="function"?la(i):[],o;if(Kr){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var h in i)Ni(i,h)&&(e&&String(Number(h))===h&&h<i.length||Kr&&o["$"+h]instanceof Symbol||(Xd.call(/[^\w$]/,h)?r.push(t(h,i)+": "+t(i[h],i)):r.push(h+": "+t(i[h],i))));if(typeof la=="function")for(var l=0;l<s.length;l++)Vd.call(i,s[l])&&r.push("["+t(s[l])+"]: "+t(i[s[l]],i));return r}var dl=vr,nn=ty,Dy=fy,Ny=dl("%TypeError%"),ls=dl("%WeakMap%",!0),us=dl("%Map%",!0),By=nn("WeakMap.prototype.get",!0),Ly=nn("WeakMap.prototype.set",!0),Oy=nn("WeakMap.prototype.has",!0),ky=nn("Map.prototype.get",!0),Fy=nn("Map.prototype.set",!0),Uy=nn("Map.prototype.has",!0),fl=function(i,t){for(var e=i,r;(r=e.next)!==null;e=r)if(r.key===t)return e.next=r.next,r.next=i.next,i.next=r,r},Gy=function(i,t){var e=fl(i,t);return e&&e.value},$y=function(i,t,e){var r=fl(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},Hy=function(i,t){return!!fl(i,t)},zy=function(){var t,e,r,n={assert:function(s){if(!n.has(s))throw new Ny("Side channel does not contain "+Dy(s))},get:function(s){if(ls&&s&&(typeof s=="object"||typeof s=="function")){if(t)return By(t,s)}else if(us){if(e)return ky(e,s)}else if(r)return Gy(r,s)},has:function(s){if(ls&&s&&(typeof s=="object"||typeof s=="function")){if(t)return Oy(t,s)}else if(us){if(e)return Uy(e,s)}else if(r)return Hy(r,s);return!1},set:function(s,o){ls&&s&&(typeof s=="object"||typeof s=="function")?(t||(t=new ls),Ly(t,s,o)):us?(e||(e=new us),Fy(e,s,o)):(r||(r={key:{},next:null}),$y(r,s,o))}};return n},Wy=String.prototype.replace,Xy=/%20/g,ca={RFC1738:"RFC1738",RFC3986:"RFC3986"},pl={default:ca.RFC3986,formatters:{RFC1738:function(i){return Wy.call(i,Xy,"+")},RFC3986:function(i){return String(i)}},RFC1738:ca.RFC1738,RFC3986:ca.RFC3986},Vy=pl,da=Object.prototype.hasOwnProperty,rr=Array.isArray,Xe=function(){for(var i=[],t=0;t<256;++t)i.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return i}(),jy=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(rr(r)){for(var n=[],s=0;s<r.length;++s)typeof r[s]<"u"&&n.push(r[s]);e.obj[e.prop]=n}}},Zd=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(r[n]=t[n]);return r},Yy=function i(t,e,r){if(!e)return t;if(typeof e!="object"){if(rr(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!da.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return rr(t)&&!rr(e)&&(n=Zd(t,r)),rr(t)&&rr(e)?(e.forEach(function(s,o){if(da.call(t,o)){var a=t[o];a&&typeof a=="object"&&s&&typeof s=="object"?t[o]=i(a,s,r):t.push(s)}else t[o]=s}),t):Object.keys(e).reduce(function(s,o){var a=e[o];return da.call(s,o)?s[o]=i(s[o],a,r):s[o]=a,s},n)},qy=function(t,e){return Object.keys(e).reduce(function(r,n){return r[n]=e[n],r},t)},Ky=function(i,t,e){var r=i.replace(/\+/g," ");if(e==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Zy=function(t,e,r,n,s){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});for(var a="",h=0;h<o.length;++h){var l=o.charCodeAt(h);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||s===Vy.RFC1738&&(l===40||l===41)){a+=o.charAt(h);continue}if(l<128){a=a+Xe[l];continue}if(l<2048){a=a+(Xe[192|l>>6]+Xe[128|l&63]);continue}if(l<55296||l>=57344){a=a+(Xe[224|l>>12]+Xe[128|l>>6&63]+Xe[128|l&63]);continue}h+=1,l=65536+((l&1023)<<10|o.charCodeAt(h)&1023),a+=Xe[240|l>>18]+Xe[128|l>>12&63]+Xe[128|l>>6&63]+Xe[128|l&63]}return a},Qy=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],u=o[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(e.push({obj:o,prop:l}),r.push(u))}return jy(e),t},Jy=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},t0=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},e0=function(t,e){return[].concat(t,e)},i0=function(t,e){if(rr(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},Qd={arrayToObject:Zd,assign:qy,combine:e0,compact:Qy,decode:Ky,encode:Zy,isBuffer:t0,isRegExp:Jy,maybeMap:i0,merge:Yy},Jd=zy,Fs=Qd,Ln=pl,r0=Object.prototype.hasOwnProperty,zu={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},gi=Array.isArray,n0=Array.prototype.push,tf=function(i,t){n0.apply(i,gi(t)?t:[t])},s0=Date.prototype.toISOString,Wu=Ln.default,ae={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Fs.encode,encodeValuesOnly:!1,format:Wu,formatter:Ln.formatters[Wu],indices:!1,serializeDate:function(t){return s0.call(t)},skipNulls:!1,strictNullHandling:!1},o0=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},fa={},a0=function i(t,e,r,n,s,o,a,h,l,u,c,d,f,p,g,m){for(var y=t,_=m,v=0,x=!1;(_=_.get(fa))!==void 0&&!x;){var E=_.get(t);if(v+=1,typeof E<"u"){if(E===v)throw new RangeError("Cyclic object value");x=!0}typeof _.get(fa)>"u"&&(v=0)}if(typeof h=="function"?y=h(e,y):y instanceof Date?y=c(y):r==="comma"&&gi(y)&&(y=Fs.maybeMap(y,function(et){return et instanceof Date?c(et):et})),y===null){if(s)return a&&!p?a(e,ae.encoder,g,"key",d):e;y=""}if(o0(y)||Fs.isBuffer(y)){if(a){var N=p?e:a(e,ae.encoder,g,"key",d);return[f(N)+"="+f(a(y,ae.encoder,g,"value",d))]}return[f(e)+"="+f(String(y))]}var I=[];if(typeof y>"u")return I;var S;if(r==="comma"&&gi(y))p&&a&&(y=Fs.maybeMap(y,a)),S=[{value:y.length>0?y.join(",")||null:void 0}];else if(gi(h))S=h;else{var D=Object.keys(y);S=l?D.sort(l):D}for(var U=n&&gi(y)&&y.length===1?e+"[]":e,L=0;L<S.length;++L){var C=S[L],b=typeof C=="object"&&typeof C.value<"u"?C.value:y[C];if(!(o&&b===null)){var R=gi(y)?typeof r=="function"?r(U,C):U:U+(u?"."+C:"["+C+"]");m.set(t,v);var tt=Jd();tt.set(fa,m),tf(I,i(b,R,r,n,s,o,r==="comma"&&p&&gi(y)?null:a,h,l,u,c,d,f,p,g,tt))}}return I},h0=function(t){if(!t)return ae;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||ae.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Ln.default;if(typeof t.format<"u"){if(!r0.call(Ln.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=Ln.formatters[r],s=ae.filter;return(typeof t.filter=="function"||gi(t.filter))&&(s=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:ae.addQueryPrefix,allowDots:typeof t.allowDots>"u"?ae.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ae.charsetSentinel,delimiter:typeof t.delimiter>"u"?ae.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:ae.encode,encoder:typeof t.encoder=="function"?t.encoder:ae.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:ae.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:ae.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:ae.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ae.strictNullHandling}},l0=function(i,t){var e=i,r=h0(t),n,s;typeof r.filter=="function"?(s=r.filter,e=s("",e)):gi(r.filter)&&(s=r.filter,n=s);var o=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in zu?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var h=zu[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=h==="comma"&&t&&t.commaRoundTrip;n||(n=Object.keys(e)),r.sort&&n.sort(r.sort);for(var u=Jd(),c=0;c<n.length;++c){var d=n[c];r.skipNulls&&e[d]===null||tf(o,a0(e[d],d,h,l,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""},Zr=Qd,ah=Object.prototype.hasOwnProperty,u0=Array.isArray,Jt={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:Zr.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},c0=function(i){return i.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},ef=function(i,t){return i&&typeof i=="string"&&t.comma&&i.indexOf(",")>-1?i.split(","):i},d0="utf8=%26%2310003%3B",f0="utf8=%E2%9C%93",p0=function(t,e){var r={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=n.split(e.delimiter,s),a=-1,h,l=e.charset;if(e.charsetSentinel)for(h=0;h<o.length;++h)o[h].indexOf("utf8=")===0&&(o[h]===f0?l="utf-8":o[h]===d0&&(l="iso-8859-1"),a=h,h=o.length);for(h=0;h<o.length;++h)if(h!==a){var u=o[h],c=u.indexOf("]="),d=c===-1?u.indexOf("="):c+1,f,p;d===-1?(f=e.decoder(u,Jt.decoder,l,"key"),p=e.strictNullHandling?null:""):(f=e.decoder(u.slice(0,d),Jt.decoder,l,"key"),p=Zr.maybeMap(ef(u.slice(d+1),e),function(g){return e.decoder(g,Jt.decoder,l,"value")})),p&&e.interpretNumericEntities&&l==="iso-8859-1"&&(p=c0(p)),u.indexOf("[]=")>-1&&(p=u0(p)?[p]:p),ah.call(r,f)?r[f]=Zr.combine(r[f],p):r[f]=p}return r},g0=function(i,t,e,r){for(var n=r?t:ef(t,e),s=i.length-1;s>=0;--s){var o,a=i[s];if(a==="[]"&&e.parseArrays)o=[].concat(n);else{o=e.plainObjects?Object.create(null):{};var h=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=parseInt(h,10);!e.parseArrays&&h===""?o={0:n}:!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&e.parseArrays&&l<=e.arrayLimit?(o=[],o[l]=n):h!=="__proto__"&&(o[h]=n)}n=o}return n},m0=function(t,e,r,n){if(t){var s=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,h=r.depth>0&&o.exec(s),l=h?s.slice(0,h.index):s,u=[];if(l){if(!r.plainObjects&&ah.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var c=0;r.depth>0&&(h=a.exec(s))!==null&&c<r.depth;){if(c+=1,!r.plainObjects&&ah.call(Object.prototype,h[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(h[1])}return h&&u.push("["+s.slice(h.index)+"]"),g0(u,e,r,n)}},y0=function(t){if(!t)return Jt;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Jt.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?Jt.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Jt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Jt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Jt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Jt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Jt.comma,decoder:typeof t.decoder=="function"?t.decoder:Jt.decoder,delimiter:typeof t.delimiter=="string"||Zr.isRegExp(t.delimiter)?t.delimiter:Jt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Jt.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Jt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Jt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Jt.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Jt.strictNullHandling}},v0=function(i,t){var e=y0(t);if(i===""||i===null||typeof i>"u")return e.plainObjects?Object.create(null):{};for(var r=typeof i=="string"?p0(i,e):i,n=e.plainObjects?Object.create(null):{},s=Object.keys(r),o=0;o<s.length;++o){var a=s[o],h=m0(a,r[a],e,typeof i=="string");n=Zr.merge(n,h,e)}return e.allowSparse===!0?n:Zr.compact(n)},_0=l0,x0=v0,w0=pl,b0={formats:w0,parse:x0,stringify:_0},E0=pm;function wi(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var A0=/^([a-z0-9.+-]+:)/i,S0=/:[0-9]*$/,T0=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,I0=["<",">",'"',"`"," ","\r",`
`,"	"],C0=["{","}","|","\\","^","`"].concat(I0),hh=["'"].concat(C0),Xu=["%","/","?",";","#"].concat(hh),Vu=["/","?","#"],M0=255,ju=/^[+a-z0-9A-Z_-]{0,63}$/,P0=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,R0={javascript:!0,"javascript:":!0},lh={javascript:!0,"javascript:":!0},Hr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},uh=b0;function D0(i,t,e){if(i&&typeof i=="object"&&i instanceof wi)return i;var r=new wi;return r.parse(i,t,e),r}wi.prototype.parse=function(i,t,e){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),n=r!==-1&&r<i.indexOf("#")?"?":"#",s=i.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),i=s.join(n);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var h=T0.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=uh.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=A0.exec(a);if(l){l=l[0];var u=l.toLowerCase();this.protocol=u,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&lh[l])&&(a=a.substr(2),this.slashes=!0)}if(!lh[l]&&(c||l&&!Hr[l])){for(var d=-1,f=0;f<Vu.length;f++){var p=a.indexOf(Vu[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var g,m;d===-1?m=a.lastIndexOf("@"):m=a.lastIndexOf("@",d),m!==-1&&(g=a.slice(0,m),a=a.slice(m+1),this.auth=decodeURIComponent(g)),d=-1;for(var f=0;f<Xu.length;f++){var p=a.indexOf(Xu[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),f=0,v=_.length;f<v;f++){var x=_[f];if(x&&!x.match(ju)){for(var E="",N=0,I=x.length;N<I;N++)x.charCodeAt(N)>127?E+="x":E+=x[N];if(!E.match(ju)){var S=_.slice(0,f),D=_.slice(f+1),U=x.match(P0);U&&(S.push(U[1]),D.unshift(U[2])),D.length&&(a="/"+D.join(".")+a),this.hostname=S.join(".");break}}}this.hostname.length>M0?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=E0.toASCII(this.hostname));var L=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+L,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!R0[u])for(var f=0,v=hh.length;f<v;f++){var b=hh[f];if(a.indexOf(b)!==-1){var R=encodeURIComponent(b);R===b&&(R=escape(b)),a=a.split(b).join(R)}}var tt=a.indexOf("#");tt!==-1&&(this.hash=a.substr(tt),a=a.slice(0,tt));var et=a.indexOf("?");if(et!==-1?(this.search=a.substr(et),this.query=a.substr(et+1),t&&(this.query=uh.parse(this.query)),a=a.slice(0,et)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Hr[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var L=this.pathname||"",Z=this.search||"";this.path=L+Z}return this.href=this.format(),this};wi.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",n=!1,s="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=uh.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Hr[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+r};wi.prototype.resolve=function(i){return this.resolveObject(D0(i,!1,!0)).format()};wi.prototype.resolveObject=function(i){if(typeof i=="string"){var t=new wi;t.parse(i,!1,!0),i=t}for(var e=new wi,r=Object.keys(this),n=0;n<r.length;n++){var s=r[n];e[s]=this[s]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(e[h]=i[h])}return Hr[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!Hr[i.protocol]){for(var l=Object.keys(i),u=0;u<l.length;u++){var c=l[u];e[c]=i[c]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!lh[i.protocol]){for(var v=(i.pathname||"").split("/");v.length&&!(i.host=v.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),v[0]!==""&&v.unshift(""),v.length<2&&v.unshift(""),e.pathname=v.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var d=e.pathname||"",f=e.search||"";e.path=d+f}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",g=i.host||i.pathname&&i.pathname.charAt(0)==="/",m=g||p||e.host&&i.pathname,y=m,_=e.pathname&&e.pathname.split("/")||[],v=i.pathname&&i.pathname.split("/")||[],x=e.protocol&&!Hr[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(_[0]===""?_[0]=e.host:_.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(v[0]===""?v[0]=i.host:v.unshift(i.host)),i.host=null),m=m&&(v[0]===""||_[0]==="")),g)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,_=v;else if(v.length)_||(_=[]),_.pop(),_=_.concat(v),e.search=i.search,e.query=i.query;else if(i.search!=null){if(x){e.host=_.shift(),e.hostname=e.host;var E=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;E&&(e.auth=E.shift(),e.hostname=E.shift(),e.host=e.hostname)}return e.search=i.search,e.query=i.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!_.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var N=_.slice(-1)[0],I=(e.host||i.host||_.length>1)&&(N==="."||N==="..")||N==="",S=0,D=_.length;D>=0;D--)N=_[D],N==="."?_.splice(D,1):N===".."?(_.splice(D,1),S++):S&&(_.splice(D,1),S--);if(!m&&!y)for(;S--;S)_.unshift("..");m&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),I&&_.join("/").substr(-1)!=="/"&&_.push("");var U=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(x){e.hostname=U?"":_.length?_.shift():"",e.host=e.hostname;var E=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;E&&(e.auth=E.shift(),e.hostname=E.shift(),e.host=e.hostname)}return m=m||e.host&&_.length,m&&!U&&_.unshift(""),_.length>0?e.pathname=_.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};wi.prototype.parseHost=function(){var i=this.host,t=S0.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const Yu={};function _t(i,t,e=3){if(Yu[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),Yu[t]=!0}function Re(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function pn(i){return i.split("?")[0].split("#")[0]}function N0(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function B0(i,t,e){return i.replace(new RegExp(N0(t),"g"),e)}function L0(i,t){let e="",r=0,n=-1,s=0,o=-1;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",r=0):(e=e.slice(0,h),r=e.length-1-e.lastIndexOf("/")),n=a,s=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=a,s=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(n+1,a)}`:e=i.slice(n+1,a),r=a-n-1;n=a,s=0}else o===46&&s!==-1?++s:s=-1}return e}const Zt={toPosix(i){return B0(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){Re(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(Re(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=pn(this.toPosix(t??q.ADAPTER.getBaseUrl())),n=pn(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?Zt.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(Re(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=L0(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return Re(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(Re(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.extname(n)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(Re(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const s=this.getProtocol(i),o=i;i=i.slice(s.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!n){r=a;break}}else n=!1;return r===-1?e?"/":this.isUrl(o)?s+i:s:e&&r===1?"//":s+i.slice(0,r)},rootname(i){Re(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){Re(i),t&&Re(t),i=pn(this.toPosix(i));let e=0,r=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(s=i.length-1;s>=0;--s){const h=i.charCodeAt(s);if(h===47){if(!n){e=s+1;break}}else a===-1&&(n=!1,a=s+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(r=s):(o=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(s=i.length-1;s>=0;--s)if(i.charCodeAt(s)===47){if(!n){e=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":i.slice(e,r)},extname(i){Re(i),i=pn(this.toPosix(i));let t=-1,e=0,r=-1,n=!0,s=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}r===-1&&(n=!1,r=o+1),a===46?t===-1?t=o:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){Re(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=pn(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let s=-1,o=0,a=-1,h=!0,l=i.length-1,u=0;for(;l>=n;--l){if(e=i.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?s===-1?s=l:u!==1&&(u=1):s!==-1&&(u=-1)}return s===-1||a===-1||u===0||u===1&&s===a-1&&s===o+1?a!==-1&&(o===0&&r?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(o,a)):(o===0&&r?(t.name=i.slice(1,s),t.base=i.slice(1,a)):(t.name=i.slice(o,s),t.base=i.slice(o,a)),t.ext=i.slice(s,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};let pa;async function O0(){return pa??(pa=(async()=>{var s;const i=document.createElement("canvas").getContext("webgl");if(!i)return ve.UNPACK;const t=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return ve.UNPACK;const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);const r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,n),i.deleteFramebuffer(r),i.deleteTexture(e),(s=i.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?ve.PMA:ve.UNPACK})()),pa}let ga;function k0(){return typeof ga>"u"&&(ga=function(){var t;const i={stencil:!0,failIfMajorPerformanceCaveat:q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!q.ADAPTER.getWebGLRenderingContext())return!1;const e=q.ADAPTER.createCanvas();let r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);const n=!!((t=r==null?void 0:r.getContextAttributes())!=null&&t.stencil);if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}}()),ga}var F0={grad:.9,turn:360,rad:360/(2*Math.PI)},di=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},ee=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Ie=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},rf=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},qu=function(i){return{r:Ie(i.r,0,255),g:Ie(i.g,0,255),b:Ie(i.b,0,255),a:Ie(i.a)}},ma=function(i){return{r:ee(i.r),g:ee(i.g),b:ee(i.b),a:ee(i.a,3)}},U0=/^#([0-9a-f]{3,8})$/i,cs=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},nf=function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=Math.max(t,e,r),o=s-Math.min(t,e,r),a=o?s===t?(e-r)/o:s===e?2+(r-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},sf=function(i){var t=i.h,e=i.s,r=i.v,n=i.a;t=t/360*6,e/=100,r/=100;var s=Math.floor(t),o=r*(1-e),a=r*(1-(t-s)*e),h=r*(1-(1-t+s)*e),l=s%6;return{r:255*[r,a,o,o,h,r][l],g:255*[h,r,r,a,o,o][l],b:255*[o,o,h,r,r,a][l],a:n}},Ku=function(i){return{h:rf(i.h),s:Ie(i.s,0,100),l:Ie(i.l,0,100),a:Ie(i.a)}},Zu=function(i){return{h:ee(i.h),s:ee(i.s),l:ee(i.l),a:ee(i.a,3)}},Qu=function(i){return sf((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},On=function(i){return{h:(t=nf(i)).h,s:(n=(200-(e=t.s))*(r=t.v)/100)>0&&n<200?e*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,r,n},G0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,$0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,H0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,z0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ch={string:[[function(i){var t=U0.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?ee(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?ee(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=H0.exec(i)||z0.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:qu({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=G0.exec(i)||$0.exec(i);if(!t)return null;var e,r,n=Ku({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(F0[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Qu(n)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=n===void 0?1:n;return di(t)&&di(e)&&di(r)?qu({r:Number(t),g:Number(e),b:Number(r),a:Number(s)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,n=i.a,s=n===void 0?1:n;if(!di(t)||!di(e)||!di(r))return null;var o=Ku({h:Number(t),s:Number(e),l:Number(r),a:Number(s)});return Qu(o)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,n=i.a,s=n===void 0?1:n;if(!di(t)||!di(e)||!di(r))return null;var o=function(a){return{h:rf(a.h),s:Ie(a.s,0,100),v:Ie(a.v,0,100),a:Ie(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(s)});return sf(o)},"hsv"]]},Ju=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},W0=function(i){return typeof i=="string"?Ju(i.trim(),ch.string):typeof i=="object"&&i!==null?Ju(i,ch.object):[null,void 0]},ya=function(i,t){var e=On(i);return{h:e.h,s:Ie(e.s+100*t,0,100),l:e.l,a:e.a}},va=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},tc=function(i,t){var e=On(i);return{h:e.h,s:e.s,l:Ie(e.l+100*t,0,100),a:e.a}},dh=function(){function i(t){this.parsed=W0(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return ee(va(this.rgba),2)},i.prototype.isDark=function(){return va(this.rgba)<.5},i.prototype.isLight=function(){return va(this.rgba)>=.5},i.prototype.toHex=function(){return t=ma(this.rgba),e=t.r,r=t.g,n=t.b,o=(s=t.a)<1?cs(ee(255*s)):"","#"+cs(e)+cs(r)+cs(n)+o;var t,e,r,n,s,o},i.prototype.toRgb=function(){return ma(this.rgba)},i.prototype.toRgbString=function(){return t=ma(this.rgba),e=t.r,r=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+n+", "+s+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,s},i.prototype.toHsl=function(){return Zu(On(this.rgba))},i.prototype.toHslString=function(){return t=Zu(On(this.rgba)),e=t.h,r=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+s+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,s},i.prototype.toHsv=function(){return t=nf(this.rgba),{h:ee(t.h),s:ee(t.s),v:ee(t.v),a:ee(t.a,3)};var t},i.prototype.invert=function(){return je({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),je(ya(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),je(ya(this.rgba,-t))},i.prototype.grayscale=function(){return je(ya(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),je(tc(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),je(tc(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?je({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ee(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=On(this.rgba);return typeof t=="number"?je({h:t,s:e.s,l:e.l,a:e.a}):ee(e.h)},i.prototype.isEqual=function(t){return this.toHex()===je(t).toHex()},i}(),je=function(i){return i instanceof dh?i:new dh(i)},ec=[],X0=function(i){i.forEach(function(t){ec.indexOf(t)<0&&(t(dh,ch),ec.push(t))})};function V0(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in e)r[e[n]]=n;var s={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=r[this.toHex()];if(l)return l;if(o!=null&&o.closest){var u=this.toRgb(),c=1/0,d="black";if(!s.length)for(var f in e)s[f]=new i(e[f]).toRgb();for(var p in e){var g=(a=u,h=s[p],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));g<c&&(c=g,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new i(h).toRgb():null},"name"])}X0([V0]);const Dr=class Us{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Us)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,s)=>n===e[s]);if(t!==null&&e!==null){const n=Object.keys(t),s=Object.keys(e);return n.length!==s.length?!1:n.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(n*255),t}toRgbArray(t){t=t??[];const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,n,s]=Us.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(r=r*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(r<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,n,s]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}normalize(t){let e,r,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,r=(o>>8&255)/255,n=(o&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,n,s=255]=t,e/=255,r/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Us.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=je(t);o.isValid()&&({r:e,g:r,b:n,a:s}=o.rgba,e/=255,r/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),r)}),t)}};Dr.shared=new Dr,Dr.temp=new Dr,Dr.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Bt=Dr;function j0(i){return _t("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Bt.shared.setValue(i).toHex()}function Y0(i){return _t("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Bt.shared.setValue(i).toNumber()}function q0(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[ut.NORMAL_NPM]=ut.NORMAL,i[ut.ADD_NPM]=ut.ADD,i[ut.SCREEN_NPM]=ut.SCREEN,t[ut.NORMAL]=ut.NORMAL_NPM,t[ut.ADD]=ut.ADD_NPM,t[ut.SCREEN]=ut.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const of=q0();function af(i,t){return of[t?1:0][i]}function K0(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function hf(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function io(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function ic(i){return!(i&i-1)&&!!i}function rc(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function zr(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}function Oi(i){return i===0?0:i<0?-1:1}let Z0=0;function dr(){return++Z0}const fh=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};fh.EMPTY=new fh(0,0,0,0);let nc=fh;const sc={},Ye=Object.create(null),Mi=Object.create(null);class Q0{constructor(t,e,r){this._canvas=q.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||q.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function oc(i,t,e){for(let r=0,n=4*e*t;r<t;++r,n+=4)if(i[n+3]!==0)return!1;return!0}function ac(i,t,e,r,n){const s=4*t;for(let o=r,a=r*s+4*e;o<=n;++o,a+=s)if(i[a+3]!==0)return!1;return!0}function J0(i){const{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const n=r.getImageData(0,0,t,e).data;let s=0,o=0,a=t-1,h=e-1;for(;o<e&&oc(n,t,o);)++o;if(o===e)return nc.EMPTY;for(;oc(n,t,h);)--h;for(;ac(n,t,s,o,h);)++s;for(;ac(n,t,a,o,h);)--a;return++a,++h,new nc(s,o,a,h)}function tv(i){const t=J0(i),{width:e,height:r}=t;let n=null;if(!t.isEmpty()){const s=i.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:n}}function ev(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Ai(i,t=1){var r;const e=(r=q.RETINA_PREFIX)==null?void 0:r.exec(i);return e?parseFloat(e[1]):t}var W=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(W||{});const ph=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},hc=(i,t)=>ph(i).priority??t,J={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(ph).forEach(t=>{t.type.forEach(e=>{var r,n;return(n=(r=this._removeHandlers)[e])==null?void 0:n.call(r,t)})}),this},add(...i){return i.map(ph).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,n=this._removeHandlers;if(r[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,n[i]=e;const s=this._queue;return s[i]&&(s[i].forEach(o=>t(o)),delete s[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((n,s)=>hc(s,e)-hc(n,e)))},r=>{const n=t.indexOf(r.ref);n!==-1&&t.splice(n,1)})}};class gh{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const iv=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function rv(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function nv(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=iv.replace(/%forloop%/gi,rv(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const _a=0,xa=1,wa=2,ba=3,Ea=4,Aa=5;class oi{constructor(){this.data=0,this.blendMode=ut.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<_a)}set blend(t){!!(this.data&1<<_a)!==t&&(this.data^=1<<_a)}get offsets(){return!!(this.data&1<<xa)}set offsets(t){!!(this.data&1<<xa)!==t&&(this.data^=1<<xa)}get culling(){return!!(this.data&1<<wa)}set culling(t){!!(this.data&1<<wa)!==t&&(this.data^=1<<wa)}get depthTest(){return!!(this.data&1<<ba)}set depthTest(t){!!(this.data&1<<ba)!==t&&(this.data^=1<<ba)}get depthMask(){return!!(this.data&1<<Aa)}set depthMask(t){!!(this.data&1<<Aa)!==t&&(this.data^=1<<Aa)}get clockwiseFrontFace(){return!!(this.data&1<<Ea)}set clockwiseFrontFace(t){!!(this.data&1<<Ea)!==t&&(this.data^=1<<Ea)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ut.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new oi;return t.depthTest=!1,t.blend=!0,t}}oi.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const mh=[];function lf(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=mh.length-1;r>=0;--r){const n=mh[r];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ue{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,s,o,a,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][l](t,e,r,n,s,o,a,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Ue.prototype,{dispatch:{value:Ue.prototype.emit},run:{value:Ue.prototype.emit}});class Gn{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Ue("setRealSize"),this.onUpdate=new Ue("update"),this.onError=new Ue("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class No extends Gn{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ve.UNPACK);const s=e.realWidth,o=e.realHeight;return r.width===s&&r.height===o?n.texSubImage2D(e.target,0,0,0,s,o,e.format,r.type,this.data):(r.width=s,r.height=o,n.texImage2D(e.target,0,r.internalFormat,s,o,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const sv={scaleMode:yi.NEAREST,alphaMode:ve.NPM},yh=class Nr extends Vn{constructor(t=null,e=null){super(),e=Object.assign({},Nr.defaultOptions,e);const{alphaMode:r,mipmap:n,anisotropicLevel:s,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=e;t&&!(t instanceof Gn)&&(t=lf(t,p),t.internal=!0),this.resolution=f||q.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=r,this.uid=dr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ic(this.realWidth)&&ic(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Mi[this.cacheId],delete Ye[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Nr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=q.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${dr()}`}s=t._pixiId}let o=Mi[s];if(n&&r&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new Nr(t,e),o.cacheId=s,Nr.addToCache(o,s)),o}static fromBuffer(t,e,r,n){t=t||new Float32Array(e*r*4);const s=new No(t,{width:e,height:r,...n==null?void 0:n.resourceOptions});let o,a;return t instanceof Float32Array?(o=O.RGBA,a=rt.FLOAT):t instanceof Int32Array?(o=O.RGBA_INTEGER,a=rt.INT):t instanceof Uint32Array?(o=O.RGBA_INTEGER,a=rt.UNSIGNED_INT):t instanceof Int16Array?(o=O.RGBA_INTEGER,a=rt.SHORT):t instanceof Uint16Array?(o=O.RGBA_INTEGER,a=rt.UNSIGNED_SHORT):t instanceof Int8Array?(o=O.RGBA,a=rt.BYTE):(o=O.RGBA,a=rt.UNSIGNED_BYTE),s.internal=!0,new Nr(s,Object.assign({},sv,{type:a,format:o},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Mi[e]&&Mi[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Mi[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Mi[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Mi[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Mi[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};yh.defaultOptions={mipmap:ni.POW2,anisotropicLevel:0,scaleMode:yi.LINEAR,wrapMode:Gi.CLAMP,alphaMode:ve.UNPACK,target:Gr.TEXTURE_2D,format:O.RGBA,type:rt.UNSIGNED_BYTE},yh._globalBatch=0;let mt=yh;class vh{constructor(){this.texArray=null,this.blend=0,this.type=Je.TRIANGLES,this.start=0,this.size=0,this.data=null}}let ov=0;class zt{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=ov++,this.disposeRunner=new Ue("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?ti.ELEMENT_ARRAY_BUFFER:ti.ARRAY_BUFFER}get index(){return this.type===ti.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new zt(t)}}class ro{constructor(t,e=0,r=!1,n=rt.FLOAT,s,o,a,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=o,this.instance=a,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,n,s){return new ro(t,e,r,n,s)}}const av={Float32Array,Uint32Array,Int32Array,Uint8Array};function hv(i,t){let e=0,r=0;const n={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;const s=new ArrayBuffer(e*4);let o=null,a=0;for(let h=0;h<i.length;h++){const l=t[h],u=i[h],c=hf(u);n[c]||(n[c]=new av[c](s)),o=n[c];for(let d=0;d<u.length;d++){const f=(d/l|0)*r+a,p=d%l;o[f+p]=u[d]}a+=l}return new Float32Array(s)}const lc={5126:4,5123:2,5121:1};let lv=0;const uv={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class $i{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=lv++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ue("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,s,o,a,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof zt||(e instanceof Array&&(e=new Float32Array(e)),e=new zt(e));const l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,r,n,s);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new ro(u,r,n,s,o,a,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof zt||(t instanceof Array&&(t=new Uint16Array(t)),t=new zt(t)),t.type=ti.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new zt;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*lc[s.type]/4),s.buffer=0}for(r.data=hv(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new $i;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new zt(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new ro(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=ti.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new $i,r=[],n=[],s=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)n[h]=n[h]||0,n[h]+=o.buffers[h].data.length,s[h]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new uv[hf(o.buffers[a].data)](n[a]),e.buffers[a]=new zt(r[a]);for(let a=0;a<t.length;a++){o=t[a];for(let h=0;h<o.buffers.length;h++)r[h].set(o.buffers[h].data,s[h]),s[h]+=o.buffers[h].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=ti.ELEMENT_ARRAY_BUFFER;let a=0,h=0,l=0,u=0;for(let c=0;c<o.buffers.length;c++)if(o.buffers[c]!==o.indexBuffer){u=c;break}for(const c in o.attributes){const d=o.attributes[c];(d.buffer|0)===u&&(h+=d.size*lc[d.type]/4)}for(let c=0;c<t.length;c++){const d=t[c].indexBuffer.data;for(let f=0;f<d.length;f++)e.indexBuffer.data[f+l]+=a;a+=t[c].buffers[u].data.length/h,l+=d.length}}return e}}class uf extends $i{constructor(t=!1){super(),this._buffer=new zt(null,t,!1),this._indexBuffer=new zt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,rt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,rt.FLOAT).addAttribute("aColor",this._buffer,4,!0,rt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,rt.FLOAT).addIndex(this._indexBuffer)}}const no=Math.PI*2,cv=180/Math.PI,dv=Math.PI/180;var re=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(re||{});class ot{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ot(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}ot.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const ds=[new ot,new ot,new ot,new ot];class ft{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=re.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new ft(0,0,0,0)}clone(){return new ft(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const S=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=S)return!1;const D=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>D}const r=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=r||o<=s)return!1;const a=ds[0].set(t.left,t.top),h=ds[1].set(t.left,t.bottom),l=ds[2].set(t.right,t.top),u=ds[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(a.x,h.x,l.x,u.x)<=r||Math.min(a.x,h.x,l.x,u.x)>=n||Math.max(a.y,h.y,l.y,u.y)<=s||Math.min(a.y,h.y,l.y,u.y)>=o))return!1;const d=c*(h.y-a.y),f=c*(a.x-h.x),p=d*r+f*s,g=d*n+f*s,m=d*r+f*o,y=d*n+f*o;if(Math.max(p,g,m,y)<=d*a.x+f*a.y||Math.min(p,g,m,y)>=d*u.x+f*u.y)return!1;const _=c*(a.y-l.y),v=c*(l.x-a.x),x=_*r+v*s,E=_*n+v*s,N=_*r+v*o,I=_*n+v*o;return!(Math.max(x,E,N,I)<=_*a.x+v*a.y||Math.min(x,E,N,I)>=_*u.x+v*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}}ft.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Yn{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=re.CIRC}clone(){return new Yn(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}getBounds(){return new ft(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Yn.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Bo{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=re.ELIP}clone(){return new Bo(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new ft(this.x-this.width,this.y-this.height,this.width,this.height)}}Bo.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class hr{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,s=e.length;n<s;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.type=re.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new hr(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const a=this.points[s*2],h=this.points[s*2+1],l=this.points[o*2],u=this.points[o*2+1];h>e!=u>e&&t<(l-a)*((e-h)/(u-h))+a&&(r=!r)}return r}}hr.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,t)=>`${i}, ${t}`,"")}]`};class Lo{constructor(t=0,e=0,r=0,n=0,s=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=re.RREC}clone(){return new Lo(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const o=r*r;if(n*n+s*s<=o||(n=t-(this.x+this.width-r),n*n+s*s<=o)||(s=e-(this.y+this.height-r),n*n+s*s<=o)||(n=t-(this.x+r),n*n+s*s<=o))return!0}return!1}}Lo.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Lt{constructor(t=1,e=0,r=0,n=1,s=0,o=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,o){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new ot;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new ot;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,n,s,o,a,h,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),h=Math.atan2(r,e),l=Math.abs(a+h);return l<1e-5||Math.abs(no-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*r+o.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Lt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Lt}static get TEMP_MATRIX(){return new Lt}}Lt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Zi=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Qi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ji=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],tr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],_h=[],cf=[],fs=Math.sign;function fv(){for(let i=0;i<16;i++){const t=[];_h.push(t);for(let e=0;e<16;e++){const r=fs(Zi[i]*Zi[e]+Ji[i]*Qi[e]),n=fs(Qi[i]*Zi[e]+tr[i]*Qi[e]),s=fs(Zi[i]*Ji[e]+Ji[i]*tr[e]),o=fs(Qi[i]*Ji[e]+tr[i]*tr[e]);for(let a=0;a<16;a++)if(Zi[a]===r&&Qi[a]===n&&Ji[a]===s&&tr[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new Lt;t.set(Zi[i],Qi[i],Ji[i],tr[i],0,0),cf.push(t)}}fv();const kt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Zi[i],uY:i=>Qi[i],vX:i=>Ji[i],vY:i=>tr[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>_h[i][t],sub:(i,t)=>_h[i][kt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?kt.S:kt.N:Math.abs(t)*2<=Math.abs(i)?i>0?kt.E:kt.W:t>0?i>0?kt.SE:kt.SW:i>0?kt.NE:kt.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=cf[kt.inv(t)];n.tx=e,n.ty=r,i.append(n)}};class _i{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new _i(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}_i.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const xh=class{constructor(){this.worldTransform=new Lt,this.localTransform=new Lt,this.position=new _i(this.onChange,this,0,0),this.scale=new _i(this.onChange,this,1,1),this.pivot=new _i(this.onChange,this,0,0),this.skew=new _i(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};xh.IDENTITY=new xh;let gl=xh;gl.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var pv=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,gv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function uc(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function Sa(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function df(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Sa(2*t);case"bvec3":return Sa(3*t);case"bvec4":return Sa(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Wr=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],mv={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},yv={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function vv(i,t){var r;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in i.uniforms){const s=t[n];if(!s){((r=i.uniforms[n])==null?void 0:r.group)===!0&&(i.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=i.uniforms[n];let a=!1;for(let h=0;h<Wr.length;h++)if(Wr[h].test(s,o)){e.push(Wr[h].code(n,o)),a=!0;break}if(!a){const h=(s.size===1&&!s.isArray?mv:yv)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const ff={};let Tr=ff;function _v(){if(Tr===ff||Tr!=null&&Tr.isContextLost()){const i=q.ADAPTER.createCanvas();let t;q.PREFER_ENV>=yr.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Tr=t}return Tr}let ps;function xv(){if(!ps){ps=Te.MEDIUM;const i=_v();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(ps=t.precision?Te.HIGH:Te.MEDIUM)}}return ps}function cc(i,t){const e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),n=r.split(`
`),s={},o=n.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!s[l]?(s[l]=!0,!0):!1),a=[""];o.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);a[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function wv(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||cc(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||cc(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const bv={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function pf(i){return bv[i]}let gs=null;const dc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function gf(i,t){if(!gs){const e=Object.keys(dc);gs={};for(let r=0;r<e.length;++r){const n=e[r];gs[i[n]]=dc[n]}}return gs[t]}function fc(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Te.HIGH&&e!==Te.HIGH&&(r=Te.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Te.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let gn;function Ev(){if(typeof gn=="boolean")return gn;try{gn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{gn=!1}return gn}let Av=0;const ms={},wh=class Br{constructor(t,e,r="pixi-shader",n={}){this.extra={},this.id=Av++,this.vertexSrc=t||Br.defaultVertexSrc,this.fragmentSrc=e||Br.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),ms[r]?(ms[r]++,r+=`-${ms[r]}`):ms[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=fc(this.vertexSrc,Br.defaultVertexPrecision,Te.HIGH),this.fragmentSrc=fc(this.fragmentSrc,Br.defaultFragmentPrecision,xv())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return gv}static get defaultFragmentSrc(){return pv}static from(t,e,r){const n=t+e;let s=sc[n];return s||(sc[n]=s=new Br(t,e,r)),s}};wh.defaultVertexPrecision=Te.HIGH,wh.defaultFragmentPrecision=vi.apple.device?Te.HIGH:Te.MEDIUM;let xi=wh,Sv=0;class Ge{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Sv++,this.static=!!e,this.ubo=!!r,t instanceof zt?(this.buffer=t,this.buffer.type=ti.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new zt(new Float32Array(1)),this.buffer.type=ti.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new Ge(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new Ge(t,e,r)}static uboFrom(t,e){return new Ge(t,e??!0,!0)}}class ei{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Ge?this.uniformGroup=e:this.uniformGroup=new Ge(e):this.uniformGroup=new Ge({}),this.disposeRunner=new Ue("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group===!0&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=xi.from(t,e);return new ei(n,r)}}class Tv{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;this.defaultGroupCache[t]=Ge.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new xi(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Lt,default:this.defaultGroupCache[t]};return new ei(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class bh{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Iv(){return!vi.apple.device}function Cv(i){let t=!0;const e=q.ADAPTER.getNavigator();if(vi.tablet||vi.phone){if(vi.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(vi.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class Oo{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Mv=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Pv=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const bn=class Be extends Oo{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=uf,this.vertexSize=6,this.state=oi.for2d(),this.size=Be.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Cv(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Iv(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return _t("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Pv}static get defaultFragmentTemplate(){return Mv}setShaderGenerator({vertex:t=Be.defaultVertexSrc,fragment:e=Be.defaultFragmentTemplate}={}){this.shaderGenerator=new Tv(t,e)}contextChange(){const t=this.renderer.gl;q.PREFER_ENV===yr.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Be.defaultMaxTextures),this.maxTextures=nv(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Be,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new vh);for(;e.length<n;)e.push(new bh);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Be._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++mt._globalBatch,h=0,l=r[0],u=0;n.copyBoundTextures(s,e);for(let c=0;c<this._bufferSize;++c){const d=t[c];t[c]=null,d._batchEnabled!==a&&(l.count>=e&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++a),d._batchEnabled=a,d.touched=o,l.elements[l.count++]=d)}l.count>0&&(n.boundArray(l,s,a,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let c=0;c<s.length;c++)s[c]=null;mt._globalBatch=a}buildDrawCalls(t,e,r){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:o,vertexSize:a}=this,h=Be._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let f=e;f<r;++f){const p=n[f],g=p._texture.baseTexture,m=of[g.alphaMode?1:0][p.blendMode];n[f]=null,e<f&&d.blend!==m&&(d.size=c-d.start,e=f,d=h[++l],d.texArray=t,d.start=c),this.packInterleavedGeometry(p,s,o,u,c),u+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=m}e<r&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Be.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,n=Be._drawCallPool;let s=null;for(let o=0;o<t;o++){const{texArray:a,type:h,size:l,start:u,blend:c}=n[o];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Be.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=io(Math.ceil(t/8)),r=rc(e),n=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new gh(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=io(Math.ceil(t/12)),r=rc(e),n=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._iBuffers[r];return s||(this._iBuffers[r]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,r,n,s){const{uint32View:o,float32View:a}=e,h=n/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=Bt.shared.setValue(t._tintRGB).toPremultiplied(f,t._texture.baseTexture.alphaMode>0);for(let g=0;g<c.length;g+=2)a[n++]=c[g],a[n++]=c[g+1],a[n++]=l[g],a[n++]=l[g+1],o[n++]=p,a[n++]=d;for(let g=0;g<u.length;g++)r[s++]=h+u[g]}};bn.defaultBatchSize=4096,bn.extension={name:"batch",type:W.RendererPlugin},bn._drawCallPool=[],bn._textureArrayPool=[];let er=bn;J.add(er);var Rv=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Dv=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Eh=class En extends ei{constructor(t,e,r){const n=xi.from(t||En.defaultVertexSrc,e||En.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=En.defaultResolution,this.multisample=En.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new oi}apply(t,e,r,n,s){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Dv}static get defaultFragmentSrc(){return Rv}};Eh.defaultResolution=1,Eh.defaultMultisample=jt.NONE;let fe=Eh;class so{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Bt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,s=r??e;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}so.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},so.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"background"};J.add(so);class mf{constructor(t){this.renderer=t,this.emptyRenderer=new Oo(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:s,ids:o,count:a}=t;let h=0;for(let l=0;l<a;l++){const u=s[l],c=u._batchLocation;if(c>=0&&c<n&&e[c]===u){o[l]=c;continue}for(;h<n;){const d=e[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}o[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}mf.extension={type:W.RendererSystem,name:"batch"};J.add(mf);let pc=0;class oo{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=pc++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=pc++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(q.PREFER_ENV>=yr.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}oo.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},oo.extension={type:W.RendererSystem,name:"context"};J.add(oo);class Ah{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ue("disposeFramebuffer"),this.multisample=jt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new mt(null,{scaleMode:yi.NEAREST,resolution:1,mipmap:ni.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new mt(null,{scaleMode:yi.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ni.OFF,format:O.DEPTH_COMPONENT,type:rt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class yf extends mt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:r,scaleMode:n,resolution:s}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=jt.NONE),super(null,t),this.mipmap=ni.OFF,this.valid=!0,this._clear=new Bt([0,0,0,0]),this.framebuffer=new Ah(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Hi extends Gn{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(r,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=ev(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,n){const s=t.gl,o=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ve.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&r.width===o&&r.height===a?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,n):(r.width=o,r.height=a,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class vf extends Hi{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Hi.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??q.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ve.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const o in s){const a=s[o];if(a!==r&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class ml{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,s=e.height;if(r){const o=t.width/2/n,a=t.height/2/s,h=t.x/n+o,l=t.y/s+a;r=kt.add(r,kt.NW),this.x0=h+o*kt.uX(r),this.y0=l+a*kt.uY(r),r=kt.add(r,2),this.x1=h+o*kt.uX(r),this.y1=l+a*kt.uY(r),r=kt.add(r,2),this.x2=h+o*kt.uX(r),this.y2=l+a*kt.uY(r),r=kt.add(r,2),this.x3=h+o*kt.uX(r),this.y3=l+a*kt.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}ml.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const gc=new ml;function ys(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class Q extends Vn{constructor(t,e,r,n,s,o,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new ft(0,0,1,1)),t instanceof Q&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=gc,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new ot(o.x,o.y):new ot(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&Ye[e.url]&&Q.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Q.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Q(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===gc&&(this._uvs=new ml),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=q.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof mt){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${dr()}`,mt.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${dr()}`}s=t._pixiId}let o=Ye[s];if(n&&r&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(t instanceof mt)?(e.resolution||(e.resolution=Ai(t)),o=new Q(new mt(t,e)),o.baseTexture.cacheId=s,mt.addToCache(o.baseTexture,s),Q.addToCache(o,s)):!o&&t instanceof mt&&(o=new Q(t),Q.addToCache(o,s)),o}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=Q.from(t,Object.assign({resourceOptions:r},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,r,n){return new Q(mt.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const s=new mt(t,Object.assign({scaleMode:mt.defaultOptions.scaleMode,resolution:Ai(e)},n)),{resource:o}=s;o instanceof vf&&(o.url=e);const a=new Q(s);return r||(r=e),mt.addToCache(a.baseTexture,r),Q.addToCache(a,r),r!==e&&(mt.addToCache(a.baseTexture,e),Q.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(h=>{a.baseTexture.once("loaded",()=>h(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ye[e]&&Ye[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ye[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Ye[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ye[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ye[t.textureCacheIds[e]]===t&&delete Ye[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:s}=t,o=e+n>this.baseTexture.width,a=r+s>this.baseTexture.height;if(o||a){const h=o&&a?"and":"or",l=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,u=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Q._EMPTY||(Q._EMPTY=new Q(new mt),ys(Q._EMPTY),ys(Q._EMPTY.baseTexture)),Q._EMPTY}static get WHITE(){if(!Q._WHITE){const t=q.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Q._WHITE=new Q(mt.from(t)),ys(Q._WHITE),ys(Q._WHITE.baseTexture)}return Q._WHITE}}class _r extends Q{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,o=Math.round(e*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new _r(new yf(t))}}class _f{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=jt.NONE){const n=new yf(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new _r(n)}getOptimalTexture(t,e,r=1,n=jt.NONE){let s;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=io(t),e=io(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(r),o}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||jt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}_f.SCREEN_KEY=-1;let Nv=class extends $i{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};class xf extends $i{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new zt(this.vertices),this.uvBuffer=new zt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Bv{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=jt.NONE,this.sourceFrame=new ft,this.destinationFrame=new ft,this.bindingSourceFrame=new ft,this.bindingDestinationFrame=new ft,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const vs=[new ot,new ot,new ot,new ot],Ta=new Lt;class wf{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new _f,this.statePool=[],this.quad=new Nv,this.quadUv=new xf,this.tempRect=new ft,this.activeState={},this.globalUniforms=new Ge({outputFrame:new ft,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new Bv,o=r.renderTexture;let a,h;if(o.current){const m=o.current;a=m.resolution,h=m.multisample}else a=r.resolution,h=r.multisample;let l=e[0].resolution||a,u=e[0].multisample??h,c=e[0].padding,d=e[0].autoFit,f=e[0].legacy??!0;for(let m=1;m<e.length;m++){const y=e[m];l=Math.min(l,y.resolution||a),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,d=d&&y.autoFit,f=f||(y.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=l,s.multisample=u,s.legacy=f,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(c);const p=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(Ta.copyFrom(r.projection.transform).invert(),p),d?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,u),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=s.sourceFrame.width,g.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,g),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){const l=n.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,Ze.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,Ze.CLEAR,e);const d=l;l=u,u=d}r[c].apply(this,l,h.renderTexture,Ze.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Ze.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,r.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===Ze.CLEAR||e===Ze.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Je.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Je.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:s}=e._texture,o=t.set(n.width,0,0,n.height,r.x,r.y),a=e.worldTransform.copyTo(Lt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=jt.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||jt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=vs[0],n=vs[1],s=vs[2],o=vs[3];r.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(s,s),t.apply(o,o);const a=Math.min(r.x,n.x,s.x,o.x),h=Math.min(r.y,n.y,s.y,o.y),l=Math.max(r.x,n.x,s.x,o.x),u=Math.max(r.y,n.y,s.y,o.y);e.x=a,e.y=h,e.width=l-a,e.height=u-h}roundFrame(t,e,r,n,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a:o,b:a,c:h,d:l}=s;if((Math.abs(a)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?Ta.copyFrom(s):Ta.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}wf.extension={type:W.RendererSystem,name:"filter"};J.add(wf);class Lv{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=jt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Ov=new ft;class bf{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ah(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ft,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;q.PREFER_ENV===yr.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>r,a=e.height>>r,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,a)}else{const o=t.width>>r,a=t.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(s.width!==r||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,s=Ka.COLOR|Ka.DEPTH){const{gl:o}=this;o.clearColor(t,e,r,n),o.clear(s)}initFramebuffer(t){const{gl:e}=this,r=new Lv(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=n[o],h=a.parentTextureArray||a;this.renderer.texture.bind(h,0),o===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let o=s.length;r.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let h=0;h<o;h++){const l=s[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+h))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,n.stencil)}else n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=jt.NONE;if(t<=1||e===null)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return r===1&&(r=jt.NONE),r}blit(t,e,r){const{current:n,renderer:s,gl:o,CONTEXT_UID:a}=this;if(s.context.webGLVersion!==2||!n)return;const h=n.glFramebuffers[a];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=n.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new Ah(n.width,n.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=Ov,e.width=n.width,e.height=n.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,h.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,l?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,n=t.height,s=this.gl,o=e.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o);let a,h;this.renderer.context.webGLVersion===1?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH_STENCIL):t.depth?(a=s.DEPTH_STENCIL_ATTACHMENT,h=s.DEPTH24_STENCIL8):(a=s.STENCIL_ATTACHMENT,h=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,h,r,n):s.renderbufferStorage(s.RENDERBUFFER,h,r,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,a,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ft}destroy(){this.renderer=null}}bf.extension={type:W.RendererSystem,name:"framebuffer"};J.add(bf);const Ia={5126:4,5123:2,5121:1};class Ef{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;q.PREFER_ENV===yr.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=n=>r.bindVertexArrayOES(n),t.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(n,s)=>r.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,o,a,h)=>r.drawElementsInstancedANGLE(n,s,o,a,h),t.drawArraysInstanced=(n,s,o,a)=>r.drawArraysInstancedANGLE(n,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const s in n)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,s=["g",t.id];for(const o in r)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const h=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[a.id]=u,u;const c=t.buffers,d=t.attributes,f={},p={};for(const g in c)f[g]=0,p[g]=0;for(const g in d)!d[g].size&&a.attributeData[g]?d[g].size=a.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[g].buffer]+=d[g].size*Ia[d[g].type];for(const g in d){const m=d[g],y=m.size;m.stride===void 0&&(f[m.buffer]===y*Ia[m.type]?m.stride=0:m.stride=f[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=y*Ia[m.type])}u=n.createVertexArray(),n.bindVertexArray(u);for(let g=0;g<c.length;g++){const m=c[g];o.bind(m),r&&m._glBuffers[s].refCount++}return this.activateVao(t,a),l[a.id]=u,l[h]=u,n.bindVertexArray(null),o.unbind(ti.ARRAY_BUFFER),u}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!r){if(o)for(let h=0;h<s.length;h++){const l=s[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&o.dispose(s[h],e))}if(!e){for(const h in r)if(h[0]==="g"){const l=r[h];this._activeVao===l&&this.unbind(),n.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let h=null;for(const l in a){const u=a[l],c=o[u.buffer],d=c._glBuffers[n];if(e.attributeData[l]){h!==d&&(s.bind(c),h=d);const f=e.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,h=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,h,(r||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,h,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,r,e||o.getSize(),n||1):s.drawArrays(t,r,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Ef.extension={type:W.RendererSystem,name:"geometry"};J.add(Ef);const mc=new Lt;class Af{constructor(t,e){this._texture=t,this.mapCoord=new Lt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],o=t[n+1];e[n]=s*r.a+o*r.c+r.tx,e[n+1]=s*r.b+o*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,s=e.trim;s&&(mc.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(mc));const o=e.baseTexture,a=this.uClampFrame,h=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+h+l)/o.width,a[1]=(e._frame.y+h+l)/o.height,a[2]=(e._frame.x+e._frame.width-h+l)/o.width,a[3]=(e._frame.y+e._frame.height-h+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var kv=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Fv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Uv extends fe{constructor(t,e,r){let n=null;typeof t!="string"&&e===void 0&&r===void 0&&(n=t,t=void 0,e=void 0,r=void 0),super(t||Fv,e||kv,r),this.maskSprite=n,this.maskMatrix=new Lt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Af(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class Gv{constructor(t=null){this.type=qt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=fe.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=qt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Sf{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const s=this.maskDataPool.pop()||new Gv;s.pooled=!0,s.maskObject=e,r=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==qt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case qt.SCISSOR:this.renderer.scissor.push(r);break;case qt.STENCIL:this.renderer.stencil.push(r);break;case qt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case qt.COLOR:this.pushColorMask(r);break}r.type===qt.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case qt.SCISSOR:this.renderer.scissor.pop(e);break;case qt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case qt.SPRITE:this.popSpriteMask(e);break;case qt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===qt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=qt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=qt.SCISSOR:t.type=qt.STENCIL:t.type=qt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new Uv])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Sf.extension={type:W.RendererSystem,name:"mask"};J.add(Sf);class Tf{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const yc=new Lt,vc=[],If=class Gs extends Tf{constructor(t){super(t),this.glConst=q.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:n}=this,s=n.renderTexture,o=r.getBounds(!0,vc.pop()??new ft);this.roundFrameToPixels(o,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:n,d:s}=t;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Gs.isMatrixRotated(e.worldTransform)||Gs.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,n,s){Gs.isMatrixRotated(s)||(s=s?yc.copyFrom(s):yc.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&vc.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};If.extension={type:W.RendererSystem,name:"scissor"};let $v=If;J.add($v);class Cf extends Tf{constructor(t){super(t),this.glConst=q.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,r.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(r._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Cf.extension={type:W.RendererSystem,name:"stencil"};J.add(Cf);class Mf{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return _t("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return _t("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return _t("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Mf.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_plugin"};J.add(Mf);class Pf{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Lt,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}Pf.extension={type:W.RendererSystem,name:"projection"};J.add(Pf);const Hv=new gl,_c=new ft;class Rf{constructor(t){this.renderer=t,this._tempMatrix=new Lt}generateTexture(t,e){const{region:r,...n}=e||{},s=(r==null?void 0:r.copyTo(_c))||t.getLocalBounds(_c,!0),o=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/o),s.height=Math.max(s.height,1/o),n.width=s.width,n.height=s.height,n.resolution=o,n.multisample??(n.multisample=this.renderer.multisample);const a=_r.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const h=t.transform;return t.transform=Hv,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}Rf.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"textureGenerator"};J.add(Rf);const qi=new ft,mn=new ft;class Df{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ft,this.destinationFrame=new ft,this.viewportFrame=new ft}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;this.current=t;let s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(qi.width=t.frame.width,qi.height=t.frame.height,e=qi),r||(mn.x=t.frame.x,mn.y=t.frame.y,mn.width=e.width,mn.height=e.height,r=mn),o=s.framebuffer):(a=n.resolution,e||(qi.width=n._view.screen.width,qi.height=n._view.screen.height,e=qi),r||(r=qi,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*a,h.y=r.y*a,h.width=r.width*a,h.height=r.height*a,t||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(o,h),this.renderer.projection.update(r,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=Bt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Df.extension={type:W.RendererSystem,name:"renderTexture"};J.add(Df);class zv{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Wv(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(i,n);if(s.name.startsWith("gl_"))continue;const o=gf(t,s.type),a={type:o,name:s.name,size:pf(o),location:t.getAttribLocation(i,s.name)};e[s.name]=a}return e}function Xv(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const s=t.getActiveUniform(i,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),h=gf(t,s.type);e[o]={name:o,index:n,type:h,size:s.size,isArray:a,value:df(h,s.size)}}return e}function Vv(i,t){var a;const e=uc(i,i.VERTEX_SHADER,t.vertexSrc),r=uc(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,r);const s=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(s&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||wv(i,n,e,r),t.attributeData=Wv(n,i),t.uniformData=Xv(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((l,u)=>l>u?1:-1);for(let l=0;l<h.length;l++)t.attributeData[h[l]].location=l,i.bindAttribLocation(n,l,h[l]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(r);const o={};for(const h in t.uniformData){const l=t.uniformData[h];o[h]={location:i.getUniformLocation(n,h),value:df(l.type,l.size)}}return new zv(n,o)}function jv(i,t,e,r,n){e.buffer.update(n)}const Yv={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Nf={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function qv(i){const t=i.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,r=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(e=Nf[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,r%e!==0&&r<16){const a=r%e%16;r+=a,n+=a}r+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,r=e):(o.offset=n,r+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function Kv(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,n)=>r.index-n.index),e}function Zv(i,t){if(!i.autoManage)return{size:0,syncFunc:jv};const e=Kv(i.uniforms,t),{uboElements:r,size:n}=qv(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){const a=r[o],h=i.uniforms[a.data.name],l=a.data.name;let u=!1;for(let c=0;c<Wr.length;c++){const d=Wr[c];if(d.codeUbo&&d.test(a.data,h)){s.push(`offset = ${a.offset/4};`,Wr[c].codeUbo(a.data.name,h)),u=!0;break}}if(!u)if(a.data.size>1){const c=pf(a.data.type),d=Math.max(Nf[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=Yv[a.data.type];s.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${a.offset/4};
                ${c};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let Qv=0;const _s={textureCount:0,uboCount:0};class Bf{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Qv++}systemCheck(){if(!Ev())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(_s.textureCount=0,_s.uboCount=0,this.syncUniformGroup(t.uniformGroup,_s)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=vv(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,_s,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=Zv(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(a.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,s=[`${r}-`];for(const o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=Vv(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Bf.extension={type:W.RendererSystem,name:"shader"};J.add(Bf);class ao{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.3.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}ao.defaultOptions={hello:!1},ao.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"startup"};J.add(ao);function Jv(i,t=[]){return t[ut.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.ADD]=[i.ONE,i.ONE],t[ut.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.NONE]=[0,0],t[ut.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[ut.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ut.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[ut.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[ut.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ut.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[ut.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[ut.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[ut.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[ut.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ut.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const t_=0,e_=1,i_=2,r_=3,n_=4,s_=5,Lf=class Sh{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ut.NONE,this._blendEq=!1,this.map=[],this.map[t_]=this.setBlend,this.map[e_]=this.setOffset,this.map[i_]=this.setCullFace,this.map[r_]=this.setDepthTest,this.map[n_]=this.setFrontFace,this.map[s_]=this.setDepthMask,this.checks=[],this.defaultState=new oi,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Jv(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Sh.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Sh.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Lf.extension={type:W.RendererSystem,name:"state"};let o_=Lf;J.add(o_);class a_ extends Vn{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),r=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Ue(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=r.find(o=>this._systemsHash[o]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const An=class $s{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=$s.defaultMaxIdle,this.checkCountMax=$s.defaultCheckCountMax,this.mode=$s.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==sl.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,r=!0)}if(r){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};An.defaultMode=sl.AUTO,An.defaultMaxIdle=60*60,An.defaultCheckCountMax=60*10,An.extension={type:W.RendererSystem,name:"textureGC"};let ir=An;J.add(ir);class Ca{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=rt.UNSIGNED_BYTE,this.internalFormat=O.RGBA,this.samplerType=0}}function h_(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:Y.FLOAT,[i.RGBA]:Y.FLOAT,[i.ALPHA]:Y.FLOAT,[i.LUMINANCE]:Y.FLOAT,[i.LUMINANCE_ALPHA]:Y.FLOAT,[i.R8]:Y.FLOAT,[i.R8_SNORM]:Y.FLOAT,[i.RG8]:Y.FLOAT,[i.RG8_SNORM]:Y.FLOAT,[i.RGB8]:Y.FLOAT,[i.RGB8_SNORM]:Y.FLOAT,[i.RGB565]:Y.FLOAT,[i.RGBA4]:Y.FLOAT,[i.RGB5_A1]:Y.FLOAT,[i.RGBA8]:Y.FLOAT,[i.RGBA8_SNORM]:Y.FLOAT,[i.RGB10_A2]:Y.FLOAT,[i.RGB10_A2UI]:Y.FLOAT,[i.SRGB8]:Y.FLOAT,[i.SRGB8_ALPHA8]:Y.FLOAT,[i.R16F]:Y.FLOAT,[i.RG16F]:Y.FLOAT,[i.RGB16F]:Y.FLOAT,[i.RGBA16F]:Y.FLOAT,[i.R32F]:Y.FLOAT,[i.RG32F]:Y.FLOAT,[i.RGB32F]:Y.FLOAT,[i.RGBA32F]:Y.FLOAT,[i.R11F_G11F_B10F]:Y.FLOAT,[i.RGB9_E5]:Y.FLOAT,[i.R8I]:Y.INT,[i.R8UI]:Y.UINT,[i.R16I]:Y.INT,[i.R16UI]:Y.UINT,[i.R32I]:Y.INT,[i.R32UI]:Y.UINT,[i.RG8I]:Y.INT,[i.RG8UI]:Y.UINT,[i.RG16I]:Y.INT,[i.RG16UI]:Y.UINT,[i.RG32I]:Y.INT,[i.RG32UI]:Y.UINT,[i.RGB8I]:Y.INT,[i.RGB8UI]:Y.UINT,[i.RGB16I]:Y.INT,[i.RGB16UI]:Y.UINT,[i.RGB32I]:Y.INT,[i.RGB32UI]:Y.UINT,[i.RGBA8I]:Y.INT,[i.RGBA8UI]:Y.UINT,[i.RGBA16I]:Y.INT,[i.RGBA16UI]:Y.UINT,[i.RGBA32I]:Y.INT,[i.RGBA32UI]:Y.UINT,[i.DEPTH_COMPONENT16]:Y.FLOAT,[i.DEPTH_COMPONENT24]:Y.FLOAT,[i.DEPTH_COMPONENT32F]:Y.FLOAT,[i.DEPTH_STENCIL]:Y.FLOAT,[i.DEPTH24_STENCIL8]:Y.FLOAT,[i.DEPTH32F_STENCIL8]:Y.FLOAT}:t={[i.RGB]:Y.FLOAT,[i.RGBA]:Y.FLOAT,[i.ALPHA]:Y.FLOAT,[i.LUMINANCE]:Y.FLOAT,[i.LUMINANCE_ALPHA]:Y.FLOAT,[i.DEPTH_STENCIL]:Y.FLOAT},t}function l_(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[rt.UNSIGNED_BYTE]:{[O.RGBA]:i.RGBA8,[O.RGB]:i.RGB8,[O.RG]:i.RG8,[O.RED]:i.R8,[O.RGBA_INTEGER]:i.RGBA8UI,[O.RGB_INTEGER]:i.RGB8UI,[O.RG_INTEGER]:i.RG8UI,[O.RED_INTEGER]:i.R8UI,[O.ALPHA]:i.ALPHA,[O.LUMINANCE]:i.LUMINANCE,[O.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[rt.BYTE]:{[O.RGBA]:i.RGBA8_SNORM,[O.RGB]:i.RGB8_SNORM,[O.RG]:i.RG8_SNORM,[O.RED]:i.R8_SNORM,[O.RGBA_INTEGER]:i.RGBA8I,[O.RGB_INTEGER]:i.RGB8I,[O.RG_INTEGER]:i.RG8I,[O.RED_INTEGER]:i.R8I},[rt.UNSIGNED_SHORT]:{[O.RGBA_INTEGER]:i.RGBA16UI,[O.RGB_INTEGER]:i.RGB16UI,[O.RG_INTEGER]:i.RG16UI,[O.RED_INTEGER]:i.R16UI,[O.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[rt.SHORT]:{[O.RGBA_INTEGER]:i.RGBA16I,[O.RGB_INTEGER]:i.RGB16I,[O.RG_INTEGER]:i.RG16I,[O.RED_INTEGER]:i.R16I},[rt.UNSIGNED_INT]:{[O.RGBA_INTEGER]:i.RGBA32UI,[O.RGB_INTEGER]:i.RGB32UI,[O.RG_INTEGER]:i.RG32UI,[O.RED_INTEGER]:i.R32UI,[O.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[rt.INT]:{[O.RGBA_INTEGER]:i.RGBA32I,[O.RGB_INTEGER]:i.RGB32I,[O.RG_INTEGER]:i.RG32I,[O.RED_INTEGER]:i.R32I},[rt.FLOAT]:{[O.RGBA]:i.RGBA32F,[O.RGB]:i.RGB32F,[O.RG]:i.RG32F,[O.RED]:i.R32F,[O.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[rt.HALF_FLOAT]:{[O.RGBA]:i.RGBA16F,[O.RGB]:i.RGB16F,[O.RG]:i.RG16F,[O.RED]:i.R16F},[rt.UNSIGNED_SHORT_5_6_5]:{[O.RGB]:i.RGB565},[rt.UNSIGNED_SHORT_4_4_4_4]:{[O.RGBA]:i.RGBA4},[rt.UNSIGNED_SHORT_5_5_5_1]:{[O.RGBA]:i.RGB5_A1},[rt.UNSIGNED_INT_2_10_10_10_REV]:{[O.RGBA]:i.RGB10_A2,[O.RGBA_INTEGER]:i.RGB10_A2UI},[rt.UNSIGNED_INT_10F_11F_11F_REV]:{[O.RGB]:i.R11F_G11F_B10F},[rt.UNSIGNED_INT_5_9_9_9_REV]:{[O.RGB]:i.RGB9_E5},[rt.UNSIGNED_INT_24_8]:{[O.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[rt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[O.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[rt.UNSIGNED_BYTE]:{[O.RGBA]:i.RGBA,[O.RGB]:i.RGB,[O.ALPHA]:i.ALPHA,[O.LUMINANCE]:i.LUMINANCE,[O.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[rt.UNSIGNED_SHORT_5_6_5]:{[O.RGB]:i.RGB},[rt.UNSIGNED_SHORT_4_4_4_4]:{[O.RGBA]:i.RGBA},[rt.UNSIGNED_SHORT_5_5_5_1]:{[O.RGBA]:i.RGBA}},t}class Of{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new mt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=l_(t),this.samplerTypes=h_(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new Ca(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ca(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let s=t-1;s>=0;--s){const o=e[s];o&&o._glTextures[n].samplerType!==Y.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new Ca(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r;e.internalFormat=((r=this.internalFormats[t.type])==null?void 0:r[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??Y.FLOAT,this.webGLVersion===2&&t.type===rt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),(n=t.resource)==null?void 0:n.upload(r,t,e))e.samplerType!==Y.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,o=t.realHeight,a=r.gl;(e.width!==s||e.height!==o||e.dirtyId<0)&&(e.width=s,e.height=o,a.texImage2D(t.target,0,e.internalFormat,s,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&zr(this.managedTextures,n,1)}}updateTextureStyle(t){var r;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===ni.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Gi.CLAMP:e.wrapMode=t.wrapMode,(r=t.resource)!=null&&r.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==ni.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===yi.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===yi.LINEAR){const s=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===yi.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===yi.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Of.extension={type:W.RendererSystem,name:"texture"};J.add(Of);class kf{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(r.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const h=a._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&s.dispose(a,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}kf.extension={type:W.RendererSystem,name:"transformFeedback"};J.add(kf);class ho{constructor(t){this.renderer=t}init(t){this.screen=new ft(0,0,t.width,t.height),this.element=t.view||q.ADAPTER.createCanvas(),this.resolution=t.resolution||q.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ho.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ho.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_view"};J.add(ho);q.PREFER_ENV=yr.WEBGL2;q.STRICT_TEXTURE_CACHE=!1;q.RENDER_OPTIONS={...oo.defaultOptions,...so.defaultOptions,...ho.defaultOptions,...ao.defaultOptions};Object.defineProperties(q,{WRAP_MODE:{get(){return mt.defaultOptions.wrapMode},set(i){_t("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),mt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return mt.defaultOptions.scaleMode},set(i){_t("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),mt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return mt.defaultOptions.mipmap},set(i){_t("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),mt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return mt.defaultOptions.anisotropicLevel},set(i){_t("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),mt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return _t("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),fe.defaultResolution},set(i){fe.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return _t("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),fe.defaultMultisample},set(i){fe.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return er.defaultMaxTextures},set(i){_t("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),er.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return er.defaultBatchSize},set(i){_t("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),er.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return er.canUploadSameBuffer},set(i){_t("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),er.canUploadSameBuffer=i}},GC_MODE:{get(){return ir.defaultMode},set(i){_t("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ir.defaultMode=i}},GC_MAX_IDLE:{get(){return ir.defaultMaxIdle},set(i){_t("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ir.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return ir.defaultCheckCountMax},set(i){_t("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ir.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return xi.defaultVertexPrecision},set(i){_t("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),xi.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return xi.defaultFragmentPrecision},set(i){_t("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),xi.defaultFragmentPrecision=i}}});var fr=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(fr||{});class Ma{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Ff=class we{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Ma(null,null,1/0),this.deltaMS=1/we.targetFPMS,this.elapsedMS=1/we.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=fr.NORMAL){return this._addListener(new Ma(t,e,r))}addOnce(t,e,r=fr.NORMAL){return this._addListener(new Ma(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*we.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,we.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!we._shared){const t=we._shared=new we;t.autoStart=!0,t._protected=!0}return we._shared}static get system(){if(!we._system){const t=we._system=new we;t.autoStart=!0,t._protected=!0}return we._system}};Ff.targetFPMS=.06;let _e=Ff;Object.defineProperties(q,{TARGET_FPMS:{get(){return _e.targetFPMS},set(i){_t("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),_e.targetFPMS=i}}});class Uf{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,fr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?_e.shared:new _e,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Uf.extension=W.Application;J.add(Uf);const Gf=[];J.handleByList(W.Renderer,Gf);function u_(i){for(const t of Gf)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var c_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,d_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const f_=c_,$f=d_;class Hf{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=jt.HIGH?this.multisample=jt.HIGH:e>=jt.MEDIUM?this.multisample=jt.MEDIUM:e>=jt.LOW?this.multisample=jt.LOW:this.multisample=jt.NONE}destroy(){}}Hf.extension={type:W.RendererSystem,name:"_multisample"};J.add(Hf);class p_{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class zf{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:s}=this;r=r||0;const o=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,o.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new p_(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}zf.extension={type:W.RendererSystem,name:"buffer"};J.add(zf);class Wf{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,s,o,a;if(e&&(n=e.renderTexture,s=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(n||(this.lastObjectRendered=t),!a){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Wf.extension={type:W.RendererSystem,name:"objectRenderer"};J.add(Wf);const Hs=class Th extends a_{constructor(t){super(),this.type=Nd.WEBGL,t=Object.assign({},q.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ge({projectionMatrix:new Lt},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Th.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(_t("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Th.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:k0()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return _t("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return _t("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return _t("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return _t("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){_t("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return _t("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){_t("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return _t("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Hs.extension={type:W.Renderer,priority:1},Hs.__plugins={},Hs.__systems={};let yl=Hs;J.handleByMap(W.RendererPlugin,yl.__plugins);J.handleByMap(W.RendererSystem,yl.__systems);J.add(yl);class Xf extends Gn{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const o=new mt;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Gn?this.addResourceAt(t[r],r):this.addResourceAt(lf(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class g_ extends Xf{constructor(t,e){const{width:r,height:n}=e||{};let s,o;Array.isArray(t)?(s=t,o=t.length):o=t,super(o,{width:r,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Gr.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:s,items:o}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let h=0;h<n;h++){const l=o[h];s[h]<l.dirtyId&&(s[h]=l.dirtyId,l.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}}class m_ extends Hi{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Vf=class Sn extends Xf{constructor(t,e){const{width:r,height:n,autoLoad:s,linkBaseTexture:o}=e||{};if(t&&t.length!==Sn.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:n});for(let a=0;a<Sn.SIDES;a++)this.items[a].target=Gr.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=Gr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Gr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const n=this.itemDirtyIds;for(let s=0;s<Sn.SIDES;s++){const o=this.items[s];(n[s]<o.dirtyId||r.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,r),n[s]=o.dirtyId):n[s]<-1&&(t.gl.texImage2D(o.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),n[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Sn.SIDES}};Vf.SIDES=6;let y_=Vf;class Ur extends Hi{constructor(t,e){e=e||{};let r,n,s;typeof t=="string"?(r=Ur.EMPTY,n=t,s=!0):(r=t,n=null,s=!1),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await q.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ve.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Ur._EMPTY=Ur._EMPTY??q.ADAPTER.createCanvas(0,0),Ur._EMPTY}}const Ih=class zs extends Hi{constructor(t,e){e=e||{},super(q.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},zs.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Hi.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*e,s=this._overrideHeight||this._overrideWidth/e*r),n=Math.round(n),s=Math.round(s);const o=this.source;o.width=n,o.height=s,o._pixiId=`canvas_${dr()}`,o.getContext("2d").drawImage(t,0,0,e,r,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(t){const e=zs.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&zs.SVG_XML.test(t)}};Ih.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ih.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Ch=Ih;const Mh=class Ph extends Hi{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const n=t[0].src||t[0];Hi.crossOrigin(r,n,e.crossorigin);for(let s=0;s<t.length;++s){const o=document.createElement("source");let{src:a,mime:h}=t[s];if(a=a||t[s],a.startsWith("data:"))h=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const l=a.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Ph.MIME_TYPES[u]||`video/${u}`}o.src=a,h&&(o.type=h),r.appendChild(o)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=_e.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(_e.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(_e.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(_e.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Ph.TYPES.includes(e)}};Mh.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Mh.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let jf=Mh;mh.push(Ur,vf,m_,jf,Ch,No,y_,g_);class lo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?ft.EMPTY:(t=t||new ft(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:s,d:o,tx:a,ty:h}=t,l=r*e.x+s*e.y+a,u=n*e.x+o*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s}addFrame(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)}addFrameMatrix(t,e,r,n,s){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,g=this.maxY,m=o*e+h*r+u,y=a*e+l*r+c;d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*n+h*r+u,y=a*n+l*r+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*e+h*s+u,y=a*e+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,m=o*n+h*s+u,y=a*n+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,g=y>g?y:g,this.minX=d,this.minY=f,this.maxX=p,this.maxY=g}addVertexData(t,e,r){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];n=l<n?l:n,s=u<s?u:s,o=l>o?l:o,a=u>a?u:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,s=0,o=s){const a=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,d=t.ty;let f=this.minX,p=this.minY,g=this.maxX,m=this.maxY;for(let y=r;y<n;y+=2){const _=e[y],v=e[y+1],x=a*_+l*v+c,E=u*v+h*_+d;f=Math.min(f,x-s),g=Math.max(g,x+s),p=Math.min(p,E-o),m=Math.max(m,E+o)}this.minX=f,this.minY=p,this.maxX=g,this.maxY=m}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=o){const a=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=n<h?n:h,this.maxX=s>l?s:l,this.maxY=o>u?o:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,s,o){t-=s,e-=o,r+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Ut extends Vn{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new gl,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new lo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(Ut.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new ft),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new ft),t=this._localBoundsRect),this._localBounds||(this._localBounds=new lo);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,s=0,o=0,a=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new v_),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*cv}set angle(t){this.transform.rotation=t*dv}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class v_ extends Ut{constructor(){super(...arguments),this.sortDirty=null}}Ut.prototype.displayObjectUpdateTransform=Ut.prototype.updateTransform;const __=new Lt;function x_(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const Yf=class Rh extends Ut{constructor(){super(),this.children=[],this.sortableChildren=Rh.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);zr(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,zr(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,zr(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e,s=n-r;let o;if(s>0&&s<=n){o=this.children.splice(r,s);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(x_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const o=this.children[n];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==Rh.prototype._render&&(r=this.getBounds(!0));const s=t.projection.transform;if(s&&(n?(n=__.copyFrom(n),n.prepend(s)):n=s),r&&e.intersects(r,n))this._render(t);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const h=this.children[o],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let r=0,n=this.children.length;r<n;++r)this.children[r].render(t)}}renderAdvanced(t){var s,o,a;const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<e.length;h++)e[h].enabled&&this._enabledFilters.push(e[h])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==qt.NONE));if(n&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let h=0,l=this.children.length;h<l;++h)this.children[h].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,r=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<r.length;++n)r[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Yf.defaultSortableChildren=!1;let ie=Yf;ie.prototype.containerUpdateTransform=ie.prototype.updateTransform;Object.defineProperties(q,{SORTABLE_CHILDREN:{get(){return ie.defaultSortableChildren},set(i){_t("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ie.defaultSortableChildren=i}}});const yn=new ot,w_=new Uint16Array([0,1,2,0,2,3]);class bi extends ie{constructor(t){super(),this._anchor=new _i(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Bt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ut.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Q.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=w_,this.pluginName="batch",this.isSprite=!0,this._roundPixels=q.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Oi(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Oi(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,d=this._anchor;let f=0,p=0,g=0,m=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,m=u.y-d._y*c.height,g=m+u.height):(p=-d._x*c.width,f=p+c.width,m=-d._y*c.height,g=m+c.height),l[0]=r*p+s*m+a,l[1]=o*m+n*p+h,l[2]=r*f+s*m+a,l[3]=o*m+n*f+h,l[4]=r*f+s*g+a,l[5]=o*g+n*f+h,l[6]=r*p+s*g+a,l[7]=o*g+n*p+h,this._roundPixels){const y=q.RESOLUTION;for(let _=0;_<l.length;++_)l[_]=Math.round(l[_]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,u=s.tx,c=s.ty,d=-n._x*r.width,f=d+r.width,p=-n._y*r.height,g=p+r.height;if(e[0]=o*d+h*p+u,e[1]=l*p+a*d+c,e[2]=o*f+h*p+u,e[3]=l*p+a*f+c,e[4]=o*f+h*g+u,e[5]=l*g+a*f+c,e[6]=o*d+h*g+u,e[7]=l*g+a*d+c,this._roundPixels){const m=q.RESOLUTION;for(let y=0;y<e.length;++y)e[y]=Math.round(e[y]*m)/m}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new lo),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new ft),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,yn);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return yn.x>=n&&yn.x<n+e&&(s=-r*this.anchor.y,yn.y>=s&&yn.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof Q?t:Q.from(t,e);return new bi(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Oi(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Oi(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Q.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const qf=new Lt;Ut.prototype._cacheAsBitmap=!1;Ut.prototype._cacheData=null;Ut.prototype._cacheAsBitmapResolution=null;Ut.prototype._cacheAsBitmapMultisample=null;class b_{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Ut.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new b_),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Ut.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};Ut.prototype._initCachedDisplayObject=function(i){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const t=this.alpha;this.alpha=1,i.batch.flush();const e=this.getLocalBounds(new ft,!0);if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;e.pad(p)}const r=this.cacheAsBitmapResolution||i.resolution;e.ceil(r),e.width=Math.max(e.width,1/r),e.height=Math.max(e.height,1/r);const n=i.renderTexture.current,s=i.renderTexture.sourceFrame.clone(),o=i.renderTexture.destinationFrame.clone(),a=i.projection.transform,h=_r.create({width:e.width,height:e.height,resolution:r,multisample:this.cacheAsBitmapMultisample??i.multisample}),l=`cacheAsBitmap_${dr()}`;this._cacheData.textureCacheId=l,mt.addToCache(h.baseTexture,l),Q.addToCache(h,l);const u=this.transform.localTransform.copyTo(qf).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=a,i.renderTexture.bind(n,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const c=new bi(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)};Ut.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};Ut.prototype._initCachedDisplayObjectCanvas=function(i){var u;if((u=this._cacheData)!=null&&u.sprite)return;const t=this.getLocalBounds(new ft,!0),e=this.alpha;this.alpha=1;const r=i.canvasContext.activeContext,n=i._projTransform,s=this.cacheAsBitmapResolution||i.resolution;t.ceil(s),t.width=Math.max(t.width,1/s),t.height=Math.max(t.height,1/s);const o=_r.create({width:t.width,height:t.height,resolution:s}),a=`cacheAsBitmap_${dr()}`;this._cacheData.textureCacheId=a,mt.addToCache(o.baseTexture,a),Q.addToCache(o,a);const h=qf;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new bi(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(t.x/t.width),l.anchor.y=-(t.y/t.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};Ut.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Ut.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Ut.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,mt.removeFromCache(this._cacheData.textureCacheId),Q.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Ut.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};Ut.prototype.name=null;ie.prototype.getChildByName=function(i,t){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===i)return this.children[e];if(t)for(let e=0,r=this.children.length;e<r;e++){const n=this.children[e];if(!n.getChildByName)continue;const s=n.getChildByName(i,!0);if(s)return s}return null};Ut.prototype.getGlobalPosition=function(i=new ot,t=!1){return this.parent?this.parent.toGlobal(this.position,i,t):(i.x=this.position.x,i.y=this.position.y),i};var E_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class A_ extends fe{constructor(t=1){super(f_,E_,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const S_={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},T_=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function I_(i){const t=S_[i],e=t.length;let r=T_,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<i;a++){let h=s.replace("%index%",a.toString());o=a,a>=e&&(o=i-a-1),h=h.replace("%value%",t[o].toString()),n+=h,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}const C_=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function M_(i,t){const e=Math.ceil(i/2);let r=C_,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<i;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),n+=a,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}class Dh extends fe{constructor(t,e=8,r=4,n=fe.defaultResolution,s=5){const o=M_(s,t),a=I_(s);super(o,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,n);else{const s=t.getFilterTexture(),o=t.renderer;let a=e,h=s;this.state.blend=!1,t.applyFilter(this,a,h,Ze.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(a,Ze.BLIT),this.uniforms.uSampler=h;const u=h;h=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,r,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class P_ extends fe{constructor(t=8,e=4,r=fe.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Dh(!0,t,e,r,n),this.blurYFilter=new Dh(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Ze.CLEAR),this.blurYFilter.apply(t,a,r,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var R_=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Nh extends fe{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super($f,R_,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,s]=Bt.shared.setValue(t).toArray(),o=[r,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),s=Math.sqrt,o=1/3,a=s(o),h=r+(1-r)*o,l=o*(1-r)-a*n,u=o*(1-r)+a*n,c=o*(1-r)+a*n,d=r+o*(1-r),f=o*(1-r)-a*n,p=o*(1-r)-a*n,g=o*(1-r)+a*n,m=r+o*(1-r),y=[h,l,u,0,0,c,d,f,0,0,p,g,m,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),s=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=t*2/3+1,n=(r-1)*-.5,s=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,n,s){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const o=Bt.shared,[a,h,l]=o.setValue(r).toArray(),[u,c,d]=o.setValue(n).toArray(),f=[.3,.59,.11,0,0,a,h,l,t,0,u,c,d,e,0,a-u,h-c,l-d,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Nh.prototype.grayscale=Nh.prototype.greyscale;var D_=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,N_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class B_ extends fe{constructor(t,e){const r=new Lt;t.renderable=!1,super(N_,D_,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new ot(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var L_=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,O_=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class k_ extends fe{constructor(){super(O_,L_)}}var F_=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class U_ extends fe{constructor(t=.5,e=Math.random()){super($f,F_,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const xc={AlphaFilter:A_,BlurFilter:P_,BlurFilterPass:Dh,ColorMatrixFilter:Nh,DisplacementFilter:B_,FXAAFilter:k_,NoiseFilter:U_};Object.entries(xc).forEach(([i,t])=>{Object.defineProperty(xc,i,{get(){return _t("7.1.0",`filters.${i} has moved to ${i}`),t}})});class G_{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(_e.system.add(this.tickerUpdate,this,fr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(_e.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Bi=new G_;class qn{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=qn.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ot,this.page=new ot,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class uo extends qn{constructor(){super(...arguments),this.client=new ot,this.movement=new ot,this.offset=new ot,this.global=new ot,this.screen=new ot}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,s,o,a,h,l,u,c,d,f,p,g){throw new Error("Method not implemented.")}}class Le extends uo{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Xr extends uo{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Xr.DOM_DELTA_PIXEL=0,Xr.DOM_DELTA_LINE=1,Xr.DOM_DELTA_PAGE=2;const $_=2048,H_=new ot,Pa=new ot;class z_{constructor(t){this.dispatch=new Vn,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,n)=>r.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Bi.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,H_.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=r.length-1;n<s;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let s=r.length-1;s>=0;s--)n.forEach(o=>{t.currentTarget=r[s],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let r=0;r<$_&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,s,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Bi.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,r,n,s,o||s(t,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const h=this._isInteractive(e),l=t.isInteractive();return h&&l&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:h&&!s(t,r)&&n(t,r)?l?[t]:[]:null}hitTestRecursive(t,e,r,n,s){if(this._interactivePrune(t)||s(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Bi.pauseUpdate=!1),t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const u=h[l],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,r,n,s);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=t.isInteractive();return(c.length>0||d)&&c.push(t),c}}}const o=this._isInteractive(e),a=t.isInteractive();return o&&n(t,r)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var r;if(t.hitArea&&(t.worldTransform.applyInverse(e,Pa),!t.hitArea.contains(Pa.x,Pa.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((r=n.containsPoint)!=null&&r.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var s,o;e=e??t.type;const r=`on${e}`;(o=(s=t.currentTarget)[r])==null||o.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Le)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var h,l;if(!(t instanceof Le)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((h=n.overTargets)==null?void 0:h.length)>0&&s!==e.target){const u=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,u,s);if(this.dispatchEvent(c,"pointerout"),r&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}if(s!==e.target){const u=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(e,u);this.dispatchEvent(c,"pointerover"),r&&this.dispatchEvent(c,"mouseover");let d=s==null?void 0:s.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(e,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==s&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Le)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(o=r.target)==null?void 0:o.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Le)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Le)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=s;if(s&&!r.composedPath().includes(s)){let a=s;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.notifyTarget(r,h?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const h=n.clicksByButton[t.button];if(h.target===a.target&&e-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=a.target,h.timeStamp=e,a.detail=h.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Le)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let s=r;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Xr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Le);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Xr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Le);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Le&&e instanceof Le&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof uo&&e instanceof uo&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,s=r.length;n<s&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const W_=1,X_={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Bh=class Lh{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new z_(null),Bi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Le(null),this.rootWheelEvent=new Xr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Lh.defaultEventFeatures},{set:(e,r,n)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[r]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,Lh._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,n=e.length;r<n;r++){const s=e[r],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Bi.pointerMoved();const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,o=n.length;s<o;s++){const a=this.bootstrapEvent(this.rootPointerEvent,n[s]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Bi.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Bi.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Bi.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(r-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const s=t.changedTouches[r];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=W_),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=X_[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Bh.extension={name:"events",type:[W.RendererSystem,W.CanvasRendererSystem]},Bh.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Oh=Bh;J.add(Oh);function wc(i){return i==="dynamic"||i==="static"}const V_={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??wc(Oh.defaultEventMode)},set interactive(i){_t("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Oh.defaultEventMode},set eventMode(i){this._internalInteractive=wc(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,n)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof qn))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};Ut.mixin(V_);const j_={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ut.mixin(j_);const Y_=9,xs=100,q_=0,K_=0,bc=2,Ec=1,Z_=-1e3,Q_=-1e3,J_=2;class Kf{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(vi.tablet||vi.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${xs}px`,e.style.height=`${xs}px`,e.style.position="absolute",e.style.top=`${q_}px`,e.style.left=`${K_}px`,e.style.zIndex=bc.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Ec}px`,t.style.height=`${Ec}px`,t.style.position="absolute",t.style.top=`${Z_}px`,t.style.left=`${Q_}px`,t.style.zIndex=J_.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(vi.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:h}=this.renderer,l=n/o*h,u=s/a*h;let c=this.div;c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.width=`${o}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,zr(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const g=f.worldTransform;f.hitArea?(c.style.left=`${(g.tx+p.x*g.a)*l}px`,c.style.top=`${(g.ty+p.y*g.d)*u}px`,c.style.width=`${p.width*g.a*l}px`,c.style.height=`${p.height*g.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*l}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*l}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${xs}px`,e.style.height=`${xs}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=bc.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new qn(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>n.dispatchEvent(s,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Y_&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Kf.extension={name:"accessibility",type:[W.RendererPlugin,W.CanvasRendererPlugin]};J.add(Kf);const Zf=class kh{constructor(t){this.stage=new ie,t=Object.assign({forceCanvas:!1},t),this.renderer=u_(t),kh._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const r=kh._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Zf._plugins=[];let Qf=Zf;J.handleByList(W.Application,Qf._plugins);class Jf{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,r=s}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Jf.extension=W.Application;J.add(Jf);const Ac={loader:W.LoadParser,resolver:W.ResolveParser,cache:W.CacheParser,detection:W.DetectionParser};J.handle(W.Asset,i=>{const t=i.ref;Object.entries(Ac).filter(([e])=>!!t[e]).forEach(([e,r])=>J.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Ac).filter(e=>!!t[e]).forEach(e=>J.remove(t[e]))});class tx{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function sn(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function Wi(i,t){const e=i.split("?")[0],r=Zt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const ke=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i),Fh=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i};function tp(i,t,e,r,n){const s=t[e];for(let o=0;o<s.length;o++){const a=s[o];e<t.length-1?tp(i.replace(r[e],a),t,e+1,r,n):n.push(i.replace(r[e],a))}}function ex(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),tp(i,n,0,e,r)}else r.push(i);return r}const co=i=>!Array.isArray(i);class ix{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=ke(t);let n;for(let a=0;a<this.parsers.length;a++){const h=this.parsers[a];if(h.test(e)){n=h.getCacheableAssets(r,e);break}}n||(n={},r.forEach(a=>{n[a]=e}));const s=Object.keys(n),o={cacheKeys:s,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof Q){const a=e;r.forEach(h=>{a.baseTexture!==Q.EMPTY.baseTexture&&mt.addToCache(a.baseTexture,h),Q.addToCache(a,h)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const nr=new ix;class rx{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var o,a;let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((o=l.test)!=null&&o.call(l,t,e,this))){s=l;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),r.parser=s;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,n,e,this))&&(n=await l.parse(n,e,this)||n,r.parser=l)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},s=co(t),o=ke(t,l=>({alias:[l],src:l})),a=o.length,h=o.map(async l=>{const u=Zt.toAbsolute(l.src);if(!n[l.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,l)),n[l.src]=await this.promiseCache[u].promise,e&&e(++r/a)}catch(c){throw delete this.promiseCache[u],delete n[l.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(h),s?n[o[0].src]:n}async unload(t){const e=ke(t,r=>({alias:[r],src:r})).map(async r=>{var o,a;const n=Zt.toAbsolute(r.src),s=this.promiseCache[n];if(s){const h=await s.promise;delete this.promiseCache[n],(a=(o=s.parser)==null?void 0:o.unload)==null||a.call(o,h,r,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var $e=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))($e||{});const nx=".json",sx="application/json",ox={extension:{type:W.LoadParser,priority:$e.Low},name:"loadJson",test(i){return sn(i,sx)||Wi(i,nx)},async load(i){return await(await q.ADAPTER.fetch(i)).json()}};J.add(ox);const ax=".txt",hx="text/plain",lx={name:"loadTxt",extension:{type:W.LoadParser,priority:$e.Low},test(i){return sn(i,hx)||Wi(i,ax)},async load(i){return await(await q.ADAPTER.fetch(i)).text()}};J.add(lx);const ux=["normal","bold","100","200","300","400","500","600","700","800","900"],cx=[".ttf",".otf",".woff",".woff2"],dx=["font/ttf","font/otf","font/woff","font/woff2"],fx=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function px(i){const t=Zt.extname(i),e=Zt.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let r=e.length>0;for(const s of e)if(!s.match(fx)){r=!1;break}let n=e.join(" ");return r||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const gx=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function mx(i){return gx.test(i)?i:encodeURI(i)}const yx={extension:{type:W.LoadParser,priority:$e.Low},name:"loadWebFont",test(i){return sn(i,dx)||Wi(i,cx)},async load(i,t){var r,n,s;const e=q.ADAPTER.getFontFaceSet();if(e){const o=[],a=((r=t.data)==null?void 0:r.family)??px(i),h=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(u=>ux.includes(u)))??["normal"],l=t.data??{};for(let u=0;u<h.length;u++){const c=h[u],d=new FontFace(a,`url(${mx(i)})`,{...l,weight:c});await d.load(),e.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>q.ADAPTER.getFontFaceSet().delete(t))}};J.add(yx);let Sc=0,Ra;const vx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",_x={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${vx}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},xx={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Da;class wx{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([_x.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",n=>{r.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Ra===void 0&&(Ra=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Ra&&(Da||(Da=URL.createObjectURL(new Blob([xx.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Da),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[Sc]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Sc++,id:r})}}const Tc=new wx;function Kn(i,t,e){i.resource.internal=!0;const r=new Q(i),n=()=>{delete t.promiseCache[e],nr.has(e)&&nr.remove(e)};return r.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),r}const bx=[".jpeg",".jpg",".png",".webp",".avif"],Ex=["image/jpeg","image/png","image/webp","image/avif"];async function Ax(i){const t=await q.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ko={name:"loadTextures",extension:{type:W.LoadParser,priority:$e.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return sn(i,Ex)||Wi(i,bx)},async load(i,t,e){var a;const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;r?this.config.preferWorkers&&await Tc.isImageBitmapSupported()?n=await Tc.loadImageBitmap(i):n=await Ax(i):n=await new Promise((h,l)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=i,u.complete?h(u):(u.onload=()=>h(u),u.onerror=c=>l(c))});const s={...t.data};s.resolution??(s.resolution=Ai(i)),r&&((a=s.resourceOptions)==null?void 0:a.ownsImageBitmap)===void 0&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const o=new mt(n,s);return o.resource.src=i,Kn(o,e,i)},unload(i){i.destroy(!0)}};J.add(ko);const Sx=".svg",Tx="image/svg+xml",Ix={extension:{type:W.LoadParser,priority:$e.High},name:"loadSVG",test(i){return sn(i,Tx)||Wi(i,Sx)},async testParse(i){return Ch.test(i)},async parse(i,t,e){var s;const r=new Ch(i,(s=t==null?void 0:t.data)==null?void 0:s.resourceOptions);await r.load();const n=new mt(r,{resolution:Ai(i),...t==null?void 0:t.data});return n.resource.src=t.src,Kn(n,e,t.src)},async load(i,t){return(await q.ADAPTER.fetch(i)).text()},unload:ko.unload};J.add(Ix);const Cx=[".mp4",".m4v",".webm",".ogv"],Mx=["video/mp4","video/webm","video/ogg"],Px={name:"loadVideo",extension:{type:W.LoadParser,priority:$e.High},config:{defaultAutoPlay:!0},test(i){return sn(i,Mx)||Wi(i,Cx)},async load(i,t,e){var o;let r;const n=await(await q.ADAPTER.fetch(i)).blob(),s=URL.createObjectURL(n);try{const a={autoPlay:this.config.defaultAutoPlay,...(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions},h=new jf(s,a);await h.load();const l=new mt(h,{alphaMode:await O0(),resolution:Ai(i),...t==null?void 0:t.data});l.resource.src=i,r=Kn(l,e,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(s)})}catch(a){throw URL.revokeObjectURL(s),a}return r},unload(i){i.destroy(!0)}};J.add(Px);class Rx{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,name:r,src:n,srcs:s}=t;return ke(e||r||n||s,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>(a==null?void 0:a.src)??(a==null?void 0:a.srcs)??a):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(n=>{const s=n.src??n.srcs,o=n.alias??n.name;let a;if(typeof o=="string"){const h=this._createBundleAssetId(t,o);r.push(h),a=[o,h]}else{const h=o.map(l=>this._createBundleAssetId(t,l));r.push(...h),a=[...o,...h]}this.add({...n,alias:a,src:s})}):Object.keys(e).forEach(n=>{const s=[n,this._createBundleAssetId(t,n)];if(typeof e[n]=="string")this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const o=e[n],a=o.src??o.srcs;this.add({...o,alias:s,src:Array.isArray(a)?a:[a]})}r.push(...s)}),this._bundles[t]=r}add(t,e,r,n,s){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(_t("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:r,format:n,loadParser:s})):Array.isArray(t)?o.push(...t):o.push(t);let a;a=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},ke(o).forEach(h=>{const{src:l,srcs:u}=h;let{data:c,format:d,loadParser:f}=h;const p=ke(l||u).map(y=>typeof y=="string"?ex(y):Array.isArray(y)?y:[y]),g=this.getAlias(h);Array.isArray(g)?g.forEach(a):a(g);const m=[];p.forEach(y=>{y.forEach(_=>{let v={};if(typeof _!="object"){v.src=_;for(let x=0;x<this._parsers.length;x++){const E=this._parsers[x];if(E.test(_)){v=E.parse(_);break}}}else c=_.data??c,d=_.format??d,f=_.loadParser??f,v={...v,..._};if(!g)throw new Error(`[Resolver] alias is undefined for this asset: ${v.src}`);v=this.buildResolvedAsset(v,{aliases:g,data:c,format:d,loadParser:f}),m.push(v)})}),g.forEach(y=>{this._assetMap[y]=m})})}resolveBundle(t){const e=co(t);t=ke(t);const r={};return t.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(n,h)]=l}r[n]=a}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=co(t);t=ke(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=s[0],a=this._getPreferredOrder(s);a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const u=s.filter(c=>c[h]?c[h]===l:!1);u.length&&(s=u)})}),this._resolverHash[n]=s[0]??o}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});r[n]=this._resolverHash[n]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:r,data:n,loadParser:s,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=Zt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=o??Zt.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class Dx{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Rx,this.loader=new rx,this.cache=nr,this._backgroundLoader=new tx(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((s=t.texturePreference)==null?void 0:s.resolution)??1,r=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,n,s){this.resolver.add(t,e,r,n,s)}async load(t,e){this._initialized||await this.init();const r=co(t),n=ke(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,e);return r?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},o=Object.keys(n);let a=0,h=0;const l=()=>{e==null||e(++a/h)},u=o.map(c=>{const d=n[c];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{s[c]=f})});return await Promise.all(u),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return nr.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=nr.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const o={};return r.forEach((a,h)=>{const l=s[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[n[h]]=l,nr.set(u,l)}),o}async unload(t){this._initialized||await this.init();const e=ke(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=ke(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{nr.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,n)=>e.indexOf(r)===n),e}get detections(){return this._detections}get preferWorkers(){return ko.config.preferWorkers}set preferWorkers(t){_t("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const ws=new Dx;J.handleByList(W.LoadParser,ws.loader.parsers).handleByList(W.ResolveParser,ws.resolver.parsers).handleByList(W.CacheParser,ws.cache.parsers).handleByList(W.DetectionParser,ws.detections);const Nx={extension:W.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof Q),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,s)=>{e[r+(s===0?"":s+1)]=n})}),e}};J.add(Nx);async function ep(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Bx={extension:{type:W.DetectionParser,priority:1},test:async()=>ep("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};J.add(Bx);const Lx={extension:{type:W.DetectionParser,priority:0},test:async()=>ep("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};J.add(Lx);const Ic=["png","jpg","jpeg"],Ox={extension:{type:W.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Ic],remove:async i=>i.filter(t=>!Ic.includes(t))};J.add(Ox);const kx="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function vl(i){return kx?!1:document.createElement("video").canPlayType(i)!==""}const Fx={extension:{type:W.DetectionParser,priority:0},test:async()=>vl("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")};J.add(Fx);const Ux={extension:{type:W.DetectionParser,priority:0},test:async()=>vl("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")};J.add(Ux);const Gx={extension:{type:W.DetectionParser,priority:0},test:async()=>vl("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")};J.add(Gx);const $x={extension:W.ResolveParser,test:ko.test,parse:i=>{var t;return{resolution:parseFloat(((t=q.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:Zt.extname(i).slice(1),src:i}}};J.add($x);var be=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(be||{});const fo={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let pi,Lr;function Cc(){Lr={s3tc:pi.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:pi.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:pi.getExtension("WEBGL_compressed_texture_etc"),etc1:pi.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:pi.getExtension("WEBGL_compressed_texture_pvrtc")||pi.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:pi.getExtension("WEBGL_compressed_texture_atc"),astc:pi.getExtension("WEBGL_compressed_texture_astc")}}const Hx={extension:{type:W.DetectionParser,priority:2},test:async()=>{const i=q.ADAPTER.createCanvas().getContext("webgl");return i?(pi=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{Lr||Cc();const t=[];for(const e in Lr)Lr[e]&&t.push(e);return[...t,...i]},remove:async i=>(Lr||Cc(),i.filter(t=>!(t in Lr)))};J.add(Hx);class zx extends No{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;typeof t=="string"?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new gh(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new gh(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class lr extends zx{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=lr._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||lr._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,o=this.levels;s<o;s++){const{levelID:a,levelWidth:h,levelHeight:l,levelBuffer:u}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,a,this.format,h,l,0,u)}return!0}onBlobLoaded(){this._levelBuffers=lr._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,n,s,o,a){const h=new Array(r);let l=t.byteOffset,u=o,c=a,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*fo[e];for(let g=0;g<r;g++)h[g]={levelID:g,levelWidth:r>1?u:d,levelHeight:r>1?c:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,u=u>>1||1,c=c>>1||1,d=u+n-1&~(n-1),f=c+s-1&~(s-1),p=d*f*fo[e];return h}}const Na=4,bs=124,Wx=32,Mc=20,Xx=542327876,Es={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Vx={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},As={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},jx=1,Yx=2,qx=4,Kx=64,Zx=512,Qx=131072,Jx=827611204,tw=861165636,ew=894720068,iw=808540228,rw=4,nw={[Jx]:be.COMPRESSED_RGBA_S3TC_DXT1_EXT,[tw]:be.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ew]:be.COMPRESSED_RGBA_S3TC_DXT5_EXT},sw={70:be.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:be.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:be.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:be.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:be.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:be.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:be.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:be.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:be.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function ow(i){const t=new Uint32Array(i);if(t[0]!==Xx)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(i,0,bs/Uint32Array.BYTES_PER_ELEMENT),r=e[Es.HEIGHT],n=e[Es.WIDTH],s=e[Es.MIPMAP_COUNT],o=new Uint32Array(i,Es.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Wx/Uint32Array.BYTES_PER_ELEMENT),a=o[jx];if(a&qx){const h=o[Vx.FOURCC];if(h!==iw){const _=nw[h],v=Na+bs,x=new Uint8Array(i,v);return[new lr(x,{format:_,width:n,height:r,levels:s})]}const l=Na+bs,u=new Uint32Array(t.buffer,l,Mc/Uint32Array.BYTES_PER_ELEMENT),c=u[As.DXGI_FORMAT],d=u[As.RESOURCE_DIMENSION],f=u[As.MISC_FLAG],p=u[As.ARRAY_SIZE],g=sw[c];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===rw)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const m=new Array,y=Na+bs+Mc;if(p===1)m.push(new Uint8Array(i,y));else{const _=fo[g];let v=0,x=n,E=r;for(let I=0;I<s;I++){const S=Math.max(1,x+3&-4),D=Math.max(1,E+3&-4),U=S*D*_;v+=U,x=x>>>1,E=E>>>1}let N=y;for(let I=0;I<p;I++)m.push(new Uint8Array(i,N,v)),N+=v}return m.map(_=>new lr(_,{format:g,width:n,height:r,levels:s}))}throw a&Kx?new Error("DDSParser does not support uncompressed texture data."):a&Zx?new Error("DDSParser does not supported YUV uncompressed texture data."):a&Qx?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&Yx?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Pc=[171,75,84,88,32,49,49,187,13,10,26,10],aw=67305985,De={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Uh=64,Rc={[rt.UNSIGNED_BYTE]:1,[rt.UNSIGNED_SHORT]:2,[rt.INT]:4,[rt.UNSIGNED_INT]:4,[rt.FLOAT]:4,[rt.HALF_FLOAT]:8},hw={[O.RGBA]:4,[O.RGB]:3,[O.RG]:2,[O.RED]:1,[O.LUMINANCE]:1,[O.LUMINANCE_ALPHA]:2,[O.ALPHA]:1},lw={[rt.UNSIGNED_SHORT_4_4_4_4]:2,[rt.UNSIGNED_SHORT_5_5_5_1]:2,[rt.UNSIGNED_SHORT_5_6_5]:2};function uw(i,t,e=!1){const r=new DataView(t);if(!cw(i,r))return null;const n=r.getUint32(De.ENDIANNESS,!0)===aw,s=r.getUint32(De.GL_TYPE,n),o=r.getUint32(De.GL_FORMAT,n),a=r.getUint32(De.GL_INTERNAL_FORMAT,n),h=r.getUint32(De.PIXEL_WIDTH,n),l=r.getUint32(De.PIXEL_HEIGHT,n)||1,u=r.getUint32(De.PIXEL_DEPTH,n)||1,c=r.getUint32(De.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=r.getUint32(De.NUMBER_OF_FACES,n),f=r.getUint32(De.NUMBER_OF_MIPMAP_LEVELS,n),p=r.getUint32(De.BYTES_OF_KEY_VALUE_DATA,n);if(l===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");const g=4,m=4,y=h+3&-4,_=l+3&-4,v=new Array(c);let x=h*l;s===0&&(x=y*_);let E;if(s!==0?Rc[s]?E=Rc[s]*hw[o]:E=lw[s]:E=fo[a],E===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const N=e?fw(r,p,n):null;let I=x*E,S=h,D=l,U=y,L=_,C=Uh+p;for(let b=0;b<f;b++){const R=r.getUint32(C,n);let tt=C+4;for(let et=0;et<c;et++){let Z=v[et];Z||(Z=v[et]=new Array(f)),Z[b]={levelID:b,levelWidth:f>1||s!==0?S:U,levelHeight:f>1||s!==0?D:L,levelBuffer:new Uint8Array(t,tt,I)},tt+=I}C+=R+4,C=C%4!==0?C+4-C%4:C,S=S>>1||1,D=D>>1||1,U=S+g-1&~(g-1),L=D+m-1&~(m-1),I=U*L*E}return s!==0?{uncompressed:v.map(b=>{let R=b[0].levelBuffer,tt=!1;return s===rt.FLOAT?R=new Float32Array(b[0].levelBuffer.buffer,b[0].levelBuffer.byteOffset,b[0].levelBuffer.byteLength/4):s===rt.UNSIGNED_INT?(tt=!0,R=new Uint32Array(b[0].levelBuffer.buffer,b[0].levelBuffer.byteOffset,b[0].levelBuffer.byteLength/4)):s===rt.INT&&(tt=!0,R=new Int32Array(b[0].levelBuffer.buffer,b[0].levelBuffer.byteOffset,b[0].levelBuffer.byteLength/4)),{resource:new No(R,{width:b[0].levelWidth,height:b[0].levelHeight}),type:s,format:tt?dw(o):o}}),kvData:N}:{compressed:v.map(b=>new lr(null,{format:a,width:h,height:l,levels:f,levelBuffers:b})),kvData:N}}function cw(i,t){for(let e=0;e<Pc.length;e++)if(t.getUint8(e)!==Pc[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function dw(i){switch(i){case O.RGBA:return O.RGBA_INTEGER;case O.RGB:return O.RGB_INTEGER;case O.RG:return O.RG_INTEGER;case O.RED:return O.RED_INTEGER;default:return i}}function fw(i,t,e){const r=new Map;let n=0;for(;n<t;){const s=i.getUint32(Uh+n,e),o=Uh+n+4,a=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&i.getUint8(o+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(i.buffer,o,h)),u=new DataView(i.buffer,o+h+1,s-h-1);r.set(l,u),n+=4+s+a}return r}const pw={extension:{type:W.LoadParser,priority:$e.High},name:"loadDDS",test(i){return Wi(i,".dds")},async load(i,t,e){const r=await(await q.ADAPTER.fetch(i)).arrayBuffer(),n=ow(r).map(s=>{const o=new mt(s,{mipmap:ni.OFF,alphaMode:ve.NO_PREMULTIPLIED_ALPHA,resolution:Ai(i),...t.data});return Kn(o,e,i)});return n.length===1?n[0]:n},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};J.add(pw);const gw={extension:{type:W.LoadParser,priority:$e.High},name:"loadKTX",test(i){return Wi(i,".ktx")},async load(i,t,e){const r=await(await q.ADAPTER.fetch(i)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:o}=uw(i,r),a=n??s,h={mipmap:ni.OFF,alphaMode:ve.NO_PREMULTIPLIED_ALPHA,resolution:Ai(i),...t.data},l=a.map(u=>{a===s&&Object.assign(h,{type:u.type,format:u.format});const c=u.resource??u,d=new mt(c,h);return d.ktxKeyValueData=o,Kn(d,e,i)});return l.length===1?l[0]:l},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};J.add(gw);const mw={extension:W.ResolveParser,test:i=>{const t=Zt.extname(i).slice(1);return["basis","ktx","dds"].includes(t)},parse:i=>{var e,r;const t=Zt.extname(i).slice(1);if(t==="ktx"){const n=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(n.some(s=>i.endsWith(s)))return{resolution:parseFloat(((e=q.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:n.find(s=>i.endsWith(s)),src:i}}return{resolution:parseFloat(((r=q.RETINA_PREFIX.exec(i))==null?void 0:r[1])??"1"),format:t,src:i}}};J.add(mw);const Ss=new ft,yw=4,ip=class Tn{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,n){const s=new Image;return s.src=await this.base64(t,e,r,n),s}async base64(t,e,r,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((o,a)=>{s.toBlob(h=>{if(!h){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(h)},e,r)});if(s.toDataURL!==void 0)return s.toDataURL(e,r);if(s.convertToBlob!==void 0){const o=await s.convertToBlob({type:e,quality:r});return new Promise((a,h)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=h,l.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);o&&Tn._flipY(r,n,s),a&&Tn._unpremultiplyAlpha(r);const h=new Q0(n,s,1),l=new ImageData(new Uint8ClampedArray(r.buffer),n,s);return h.context.putImageData(l,0,0),h.canvas}pixels(t,e){const{pixels:r,width:n,height:s,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,e);return o&&Tn._flipY(r,n,s),a&&Tn._unpremultiplyAlpha(r),r}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,s=!1,o=!1,a,h=!1;t&&(t instanceof _r?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),h=!0,e&&(Ss.width=e.width,Ss.height=e.height,e=Ss)));const l=r.gl;if(a){if(n=a.baseTexture.resolution,e=e??a.frame,s=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===O.RGBA,!h){r.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[r.CONTEXT_UID];f.blitFramebuffer&&r.framebuffer.bind(f.blitFramebuffer)}}else n=r.resolution,e||(e=Ss,e.width=r.width/n,e.height=r.height/n),s=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const u=Math.max(Math.round(e.width*n),1),c=Math.max(Math.round(e.height*n),1),d=new Uint8Array(yw*u*c);return l.readPixels(Math.round(e.x*n),Math.round(e.y*n),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:c,flipY:s,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const n=e<<2,s=r>>1,o=new Uint8Array(n);for(let a=0;a<s;a++){const h=a*n,l=(r-a-1)*n;o.set(t.subarray(h,h+n)),t.copyWithin(h,l,l+n),t.set(o,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const n=t[r+3];if(n!==0){const s=255.001/n;t[r]=t[r]*s+.5,t[r+1]=t[r+1]*s+.5,t[r+2]=t[r+2]*s+.5}}}};ip.extension={name:"extract",type:W.RendererSystem};let vw=ip;J.add(vw);const po={build(i){const t=i.points;let e,r,n,s,o,a;if(i.type===re.CIRC){const p=i.shape;e=p.x,r=p.y,o=a=p.radius,n=s=0}else if(i.type===re.ELIP){const p=i.shape;e=p.x,r=p.y,o=p.width,a=p.height,n=s=0}else{const p=i.shape,g=p.width/2,m=p.height/2;e=p.x+g,r=p.y+m,o=a=Math.max(0,Math.min(p.radius,Math.min(g,m))),n=g-o,s=m-a}if(!(o>=0&&a>=0&&n>=0&&s>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(n?4:0)+(s?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=r+s,t[2]=t[4]=e-n,t[5]=t[7]=r-s;return}let u=0,c=h*4+(n?2:0)+2,d=c,f=l;{const p=n+o,g=s,m=e+p,y=e-p,_=r+g;if(t[u++]=m,t[u++]=_,t[--c]=_,t[--c]=y,s){const v=r-g;t[d++]=y,t[d++]=v,t[--f]=v,t[--f]=m}}for(let p=1;p<h;p++){const g=Math.PI/2*(p/h),m=n+Math.cos(g)*o,y=s+Math.sin(g)*a,_=e+m,v=e-m,x=r+y,E=r-y;t[u++]=_,t[u++]=x,t[--c]=x,t[--c]=v,t[d++]=v,t[d++]=E,t[--f]=E,t[--f]=_}{const p=n,g=s+a,m=e+p,y=e-p,_=r+g,v=r-g;t[u++]=m,t[u++]=_,t[--f]=v,t[--f]=m,n&&(t[u++]=y,t[u++]=_,t[--f]=v,t[--f]=y)}},triangulate(i,t){const e=i.points,r=t.points,n=t.indices;if(e.length===0)return;let s=r.length/2;const o=s;let a,h;if(i.type!==re.RREC){const u=i.shape;a=u.x,h=u.y}else{const u=i.shape;a=u.x+u.width/2,h=u.y+u.height/2}const l=i.matrix;r.push(i.matrix?l.a*a+l.c*h+l.tx:a,i.matrix?l.b*a+l.d*h+l.ty:h),s++,r.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)r.push(e[u],e[u+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function Dc(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let n=0,s=i[e-2],o=i[e-1];n<e;n+=2){const a=i[n],h=i[n+1];r+=(a-s)*(h+o),s=a,o=h}if(!t&&r>0||t&&r<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const o=e-s-2,a=e-s-1,h=s,l=s+1;[i[o],i[h]]=[i[h],i[o]],[i[a],i[l]]=[i[l],i[a]]}}}const rp={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,n=t.points,s=t.indices;if(e.length>=6){Dc(e,!1);const o=[];for(let l=0;l<r.length;l++){const u=r[l];Dc(u.points,!0),o.push(e.length/2),e=e.concat(u.points)}const a=fm(e,o,2);if(!a)return;const h=n.length/2;for(let l=0;l<a.length;l+=3)s.push(a[l]+h),s.push(a[l+1]+h),s.push(a[l+2]+h);for(let l=0;l<e.length;l++)n.push(e[l])}}},_w={build(i){const t=i.shape,e=t.x,r=t.y,n=t.width,s=t.height,o=i.points;o.length=0,n>=0&&s>=0&&o.push(e,r,e+n,r,e+n,r+s,e,r+s)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},xw={build(i){po.build(i)},triangulate(i,t){po.triangulate(i,t)}};var Se=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(Se||{}),ki=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(ki||{});const Qr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Nc{static curveTo(t,e,r,n,s,o){const a=o[o.length-2],h=o[o.length-1]-e,l=a-t,u=n-e,c=r-t,d=Math.abs(h*c-l*u);if(d<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const f=h*h+l*l,p=u*u+c*c,g=h*u+l*c,m=s*Math.sqrt(f)/d,y=s*Math.sqrt(p)/d,_=m*g/f,v=y*g/p,x=m*c+y*l,E=m*u+y*h,N=l*(y+_),I=h*(y+_),S=c*(m+v),D=u*(m+v),U=Math.atan2(I-E,N-x),L=Math.atan2(D-E,S-x);return{cx:x+t,cy:E+e,radius:s,startAngle:U,endAngle:L,anticlockwise:l*u>c*h}}static arc(t,e,r,n,s,o,a,h,l){const u=a-o,c=Qr._segmentsCount(Math.abs(u)*s,Math.ceil(Math.abs(u)/no)*40),d=u/(c*2),f=d*2,p=Math.cos(d),g=Math.sin(d),m=c-1,y=m%1/m;for(let _=0;_<=m;++_){const v=_+y*_,x=d+o+f*v,E=Math.cos(x),N=-Math.sin(x);l.push((p*E+g*N)*s+r,(p*-N+g*E)*s+n)}}}class ww{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class _l{static curveLength(t,e,r,n,s,o,a,h){let l=0,u=0,c=0,d=0,f=0,p=0,g=0,m=0,y=0,_=0,v=0,x=t,E=e;for(let N=1;N<=10;++N)u=N/10,c=u*u,d=c*u,f=1-u,p=f*f,g=p*f,m=g*t+3*p*u*r+3*f*c*s+d*a,y=g*e+3*p*u*n+3*f*c*o+d*h,_=x-m,v=E-y,x=m,E=y,l+=Math.sqrt(_*_+v*v);return l}static curveTo(t,e,r,n,s,o,a){const h=a[a.length-2],l=a[a.length-1];a.length-=2;const u=Qr._segmentsCount(_l.curveLength(h,l,t,e,r,n,s,o));let c=0,d=0,f=0,p=0,g=0;a.push(h,l);for(let m=1,y=0;m<=u;++m)y=m/u,c=1-y,d=c*c,f=d*c,p=y*y,g=p*y,a.push(f*h+3*d*y*t+3*c*p*r+g*s,f*l+3*d*y*e+3*c*p*n+g*o)}}function Bc(i,t,e,r,n,s,o,a){const h=i-e*n,l=t-r*n,u=i+e*s,c=t+r*s;let d,f;o?(d=r,f=-e):(d=-r,f=e);const p=h+d,g=l+f,m=u+d,y=c+f;return a.push(p,g,m,y),2}function Ki(i,t,e,r,n,s,o,a){const h=e-i,l=r-t;let u=Math.atan2(h,l),c=Math.atan2(n-i,s-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),g=Math.sqrt(h*h+l*l),m=(15*p*Math.sqrt(g)/Math.PI>>0)+1,y=f/m;if(d+=y,a){o.push(i,t,e,r);for(let _=1,v=d;_<m;_++,v+=y)o.push(i,t,i+Math.sin(v)*g,t+Math.cos(v)*g);o.push(i,t,n,s)}else{o.push(e,r,i,t);for(let _=1,v=d;_<m;_++,v+=y)o.push(i+Math.sin(v)*g,t+Math.cos(v)*g,i,t);o.push(n,s,i,t)}return m*2}function bw(i,t){const e=i.shape;let r=i.points||e.points.slice();const n=t.closePointEps;if(r.length===0)return;const s=i.lineStyle,o=new ot(r[0],r[1]),a=new ot(r[r.length-2],r[r.length-1]),h=e.type!==re.POLY||e.closeStroke,l=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){r=r.slice(),l&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const Z=(o.x+a.x)*.5,at=(a.y+o.y)*.5;r.unshift(Z,at),r.push(Z,at)}const u=t.points,c=r.length/2;let d=r.length;const f=u.length/2,p=s.width/2,g=p*p,m=s.miterLimit*s.miterLimit;let y=r[0],_=r[1],v=r[2],x=r[3],E=0,N=0,I=-(_-x),S=y-v,D=0,U=0,L=Math.sqrt(I*I+S*S);I/=L,S/=L,I*=p,S*=p;const C=s.alignment,b=(1-C)*2,R=C*2;h||(s.cap===ki.ROUND?d+=Ki(y-I*(b-R)*.5,_-S*(b-R)*.5,y-I*b,_-S*b,y+I*R,_+S*R,u,!0)+2:s.cap===ki.SQUARE&&(d+=Bc(y,_,I,S,b,R,!0,u))),u.push(y-I*b,_-S*b,y+I*R,_+S*R);for(let Z=1;Z<c-1;++Z){y=r[(Z-1)*2],_=r[(Z-1)*2+1],v=r[Z*2],x=r[Z*2+1],E=r[(Z+1)*2],N=r[(Z+1)*2+1],I=-(_-x),S=y-v,L=Math.sqrt(I*I+S*S),I/=L,S/=L,I*=p,S*=p,D=-(x-N),U=v-E,L=Math.sqrt(D*D+U*U),D/=L,U/=L,D*=p,U*=p;const at=v-y,gt=_-x,k=v-E,F=N-x,ct=at*k+gt*F,bt=gt*k-F*at,yt=bt<0;if(Math.abs(bt)<.001*Math.abs(ct)){u.push(v-I*b,x-S*b,v+I*R,x+S*R),ct>=0&&(s.join===Se.ROUND?d+=Ki(v,x,v-I*b,x-S*b,v-D*b,x-U*b,u,!1)+4:d+=2,u.push(v-D*R,x-U*R,v+D*b,x+U*b));continue}const St=(-I+y)*(-S+x)-(-I+v)*(-S+_),Rt=(-D+E)*(-U+x)-(-D+v)*(-U+N),Gt=(at*Rt-k*St)/bt,$t=(F*St-gt*Rt)/bt,le=(Gt-v)*(Gt-v)+($t-x)*($t-x),Yt=v+(Gt-v)*b,Dt=x+($t-x)*b,Nt=v-(Gt-v)*R,It=x-($t-x)*R,ye=Math.min(at*at+gt*gt,k*k+F*F),A=yt?b:R,hi=ye+A*A*g,se=le<=hi;let li=s.join;if(li===Se.MITER&&le/g>m&&(li=Se.BEVEL),se)switch(li){case Se.MITER:{u.push(Yt,Dt,Nt,It);break}case Se.BEVEL:{yt?u.push(Yt,Dt,v+I*R,x+S*R,Yt,Dt,v+D*R,x+U*R):u.push(v-I*b,x-S*b,Nt,It,v-D*b,x-U*b,Nt,It),d+=2;break}case Se.ROUND:{yt?(u.push(Yt,Dt,v+I*R,x+S*R),d+=Ki(v,x,v+I*R,x+S*R,v+D*R,x+U*R,u,!0)+4,u.push(Yt,Dt,v+D*R,x+U*R)):(u.push(v-I*b,x-S*b,Nt,It),d+=Ki(v,x,v-I*b,x-S*b,v-D*b,x-U*b,u,!1)+4,u.push(v-D*b,x-U*b,Nt,It));break}}else{switch(u.push(v-I*b,x-S*b,v+I*R,x+S*R),li){case Se.MITER:{yt?u.push(Nt,It,Nt,It):u.push(Yt,Dt,Yt,Dt),d+=2;break}case Se.ROUND:{yt?d+=Ki(v,x,v+I*R,x+S*R,v+D*R,x+U*R,u,!0)+2:d+=Ki(v,x,v-I*b,x-S*b,v-D*b,x-U*b,u,!1)+2;break}}u.push(v-D*b,x-U*b,v+D*R,x+U*R),d+=2}}y=r[(c-2)*2],_=r[(c-2)*2+1],v=r[(c-1)*2],x=r[(c-1)*2+1],I=-(_-x),S=y-v,L=Math.sqrt(I*I+S*S),I/=L,S/=L,I*=p,S*=p,u.push(v-I*b,x-S*b,v+I*R,x+S*R),h||(s.cap===ki.ROUND?d+=Ki(v-I*(b-R)*.5,x-S*(b-R)*.5,v-I*b,x-S*b,v+I*R,x+S*R,u,!1)+2:s.cap===ki.SQUARE&&(d+=Bc(v,x,I,S,b,R,!1,u)));const tt=t.indices,et=Qr.epsilon*Qr.epsilon;for(let Z=f;Z<d+f-2;++Z)y=u[Z*2],_=u[Z*2+1],v=u[(Z+1)*2],x=u[(Z+1)*2+1],E=u[(Z+2)*2],N=u[(Z+2)*2+1],!(Math.abs(y*(x-N)+v*(N-_)+E*(_-x))<et)&&tt.push(Z,Z+1,Z+2)}function Ew(i,t){let e=0;const r=i.shape,n=i.points||r.points,s=r.type!==re.POLY||r.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,h=n.length/2,l=o.length/2;let u=l;for(o.push(n[0],n[1]),e=1;e<h;e++)o.push(n[e*2],n[e*2+1]),a.push(u,u+1),u++;s&&a.push(u,l)}function Lc(i,t){i.lineStyle.native?Ew(i,t):bw(i,t)}class xl{static curveLength(t,e,r,n,s,o){const a=t-2*r+s,h=e-2*n+o,l=2*r-2*t,u=2*n-2*e,c=4*(a*a+h*h),d=4*(a*l+h*u),f=l*l+u*u,p=2*Math.sqrt(c+d+f),g=Math.sqrt(c),m=2*c*g,y=2*Math.sqrt(f),_=d/g;return(m*p+g*d*(p-y)+(4*f*c-d*d)*Math.log((2*g+_+p)/(_+y)))/(4*m)}static curveTo(t,e,r,n,s){const o=s[s.length-2],a=s[s.length-1],h=Qr._segmentsCount(xl.curveLength(o,a,t,e,r,n));let l=0,u=0;for(let c=1;c<=h;++c){const d=c/h;l=o+(t-o)*d,u=a+(e-a)*d,s.push(l+(t+(r-t)*d-l)*d,u+(e+(n-e)*d-u)*d)}}}const Ba={[re.POLY]:rp,[re.CIRC]:po,[re.ELIP]:po,[re.RECT]:_w,[re.RREC]:xw},Oc=[],Ts=[];class go{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new go(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ir=new ot,np=class sp extends uf{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new lo,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ts.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Oc.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,n=null){const s=new go(t,e,r,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new go(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const n=e[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Ir):Ir.copyFrom(t),n.shape.contains(Ir.x,Ir.y))){let s=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(Ir.x,Ir.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let h=this.shapeIndex;h<e.length;h++){this.shapeIndex++;const l=e[h],u=l.fillStyle,c=l.lineStyle;Ba[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,g=this.indices.length,m=this.points.length/2;p.wrapMode=Gi.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-m;y!==0&&(r&&!this._compareStyles(n,f)&&(r.end(g,m),r=null),r||(r=Oc.pop()||new ww,r.begin(f,g,m),this.batches.push(r),n=f),this.addUvs(this.points,t,f.texture,m,y,f.matrix))}}const s=this.indices.length,o=this.points.length/2;if(r&&r.end(s,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const r=this.graphicsData[t],n=r.fillStyle,s=r.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const n=t[e];for(let s=0;s<n.size;s++){const o=n.start+s;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<sp.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++mt._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Ts.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let n=Ts.pop();n||(n=new vh,n.texArray=new bh),n.texArray.count=0,n.start=0,n.size=0,n.type=Je.TRIANGLES;let s=0,o=null,a=0,h=!1,l=Je.TRIANGLES,u=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,g=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,l=h?Je.LINES:Je.TRIANGLES,o=null,s=f,t++),o!==g&&(o=g,g._batchEnabled!==t&&(s===f&&(t++,s=0,n.size>0&&(n=Ts.pop(),n||(n=new vh,n.texArray=new bh),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=l),g.touched=1,g._batchEnabled=t,g._batchLocation=s,g.wrapMode=Gi.REPEAT,n.texArray.elements[n.texArray.count++]=g,s++)),n.size+=d.size,u+=d.size,a=g._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,a,d.attribSize,d.attribStart)}mt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,s=new ArrayBuffer(t.length*3*4),o=new Float32Array(s),a=new Uint32Array(s);let h=0;for(let l=0;l<t.length/2;l++)o[h++]=t[l*2],o[h++]=t[l*2+1],o[h++]=e[l*2],o[h++]=e[l*2+1],a[h++]=r[l],o[h++]=n[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?rp.triangulate(t,this):Ba[t.type].triangulate(t,this)}processLine(t){Lc(t,this);for(let e=0;e<t.holes.length;e++)Lc(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];Ba[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const n=t[r*2],s=t[r*2+1];t[r*2]=e.a*n+e.c*s+e.tx,t[r*2+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,r,n,s=0){const o=Bt.shared.setValue(e).toLittleEndianNumber(),a=Bt.shared.setValue(o).toPremultiplied(r);t.length=Math.max(t.length,s+n);for(let h=0;h<n;h++)t[s+h]=a}addTextureIds(t,e,r,n=0){t.length=Math.max(t.length,n+r);for(let s=0;s<r;s++)t[n+s]=e}addUvs(t,e,r,n,s,o=null){let a=0;const h=e.length,l=r.frame;for(;a<s;){let c=t[(n+a)*2],d=t[(n+a)*2+1];if(o){const f=o.a*c+o.c*d+o.tx;d=o.b*c+o.d*d+o.ty,c=f}a++,e.push(c/l.width,d/l.height)}const u=r.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,r,h,s)}adjustUvs(t,e,r,n){const s=e.baseTexture,o=1e-6,a=r+n*2,h=e.frame,l=h.width/s.width,u=h.height/s.height;let c=h.x/h.width,d=h.y/h.height,f=Math.floor(t[r]+o),p=Math.floor(t[r+1]+o);for(let g=r+2;g<a;g+=2)f=Math.min(f,Math.floor(t[g]+o)),p=Math.min(p,Math.floor(t[g+1]+o));c-=f,d-=p;for(let g=r;g<a;g+=2)t[g]=(t[g]+c)*l,t[g+1]=(t[g+1]+d)*u}};np.BATCHABLE_SIZE=100;let Aw=np;class Fo{constructor(){this.color=16777215,this.alpha=1,this.texture=Q.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Fo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Q.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class wl extends Fo{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ki.BUTT,this.join=Se.MITER,this.miterLimit=10}clone(){const t=new wl;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ki.BUTT,this.join=Se.MITER,this.miterLimit=10}}const La={},Gh=class Ws extends ie{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Fo,this._lineStyle=new wl,this._matrix=null,this._holeMode=!1,this.state=oi.for2d(),this._geometry=t||new Aw,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Bt(16777215),this.blendMode=ut.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ws(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,n=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:r,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Q.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ki.BUTT,join:Se.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new hr,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new hr,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],s=r[r.length-1];return(n!==t||s!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),xl.curveTo(t,e,r,n,s),this}bezierCurveTo(t,e,r,n,s,o){return this._initCurve(),_l.curveTo(t,e,r,n,s,o,this.currentPath.points),this}arcTo(t,e,r,n,s){this._initCurve(t,e);const o=this.currentPath.points,a=Nc.curveTo(t,e,r,n,s,o);if(a){const{cx:h,cy:l,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=a;this.arc(h,l,u,c,d,f)}return this}arc(t,e,r,n,s,o=!1){if(n===s)return this;if(!o&&s<=n?s+=no:o&&n<=s&&(n+=no),s-n===0)return this;const a=t+Math.cos(n)*r,h=e+Math.sin(n)*r,l=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-h);c<l&&d<l||u.push(a,h)}else this.moveTo(a,h),u=this.currentPath.points;return Nc.arc(a,h,t,e,r,n,s,o,u),this}beginFill(t=0,e){return this.beginTextureFill({texture:Q.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Bt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Q.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,n){return this.drawShape(new ft(t,e,r,n))}drawRoundedRect(t,e,r,n,s){return this.drawShape(new Lo(t,e,r,n,s))}drawCircle(t,e,r){return this.drawShape(new Yn(t,e,r))}drawEllipse(t,e,r,n){return this.drawShape(new Bo(t,e,r,n))}drawPolygon(...t){let e,r=!0;const n=t[0];n.points?(r=n.closeStroke,e=n.points):Array.isArray(t[0])?e=t[0]:e=t;const s=new hr(e);return s.closeStroke=r,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===re.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let n=0;n<r;n++){const s=t.batches[n],o=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),h=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),u={vertexData:a,blendMode:e,indices:l,uvs:h,_batchRGB:Bt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,n=this.worldAlpha,s=e.uniforms,o=r.drawCalls;s.translationMatrix=this.transform.worldTransform,Bt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let a=0,h=o.length;a<h;a++)this._renderDrawCallDirect(t,r.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:r,type:n,size:s,start:o}=e,a=r.count;for(let h=0;h<a;h++)t.texture.bind(r.elements[h],h);t.geometry.draw(n,s,o)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!La[r]){const{maxTextures:n}=t.plugins[r],s=new Int32Array(n);for(let h=0;h<n;h++)s[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Lt,default:Ge.from({uSamplers:s},!0)},a=t.plugins[r]._shader.program;La[r]=new ei(a,o)}e=La[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,r,n,s)}containsPoint(t){return this.worldTransform.applyInverse(t,Ws._TEMP_POINT),this._geometry.containsPoint(Ws._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Bt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<l.length;d+=2){const f=l[d],p=l[d+1];u[c++]=r*f+s*p+a,u[c++]=o*p+n*f+h}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};Gh.curves=Qr,Gh._TEMP_POINT=new ot;let mo=Gh;class Sw{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Oa=new ot,kc=new hr,op=class ap extends ie{constructor(t,e,r,n=Je.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||oi.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=q.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Je.TRIANGLES&&e.length<ap.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,u=n.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=e[d*2],p=e[d*2+1];c[d*2]=s*f+a*p+l,c[d*2+1]=o*f+h*p+u}if(this._roundPixels){const d=q.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Sw(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Oa);const e=this.geometry.getBuffer("aVertexPosition").data,r=kc.points,n=this.geometry.getIndex().data,s=n.length,o=this.drawMode===4?3:1;for(let a=0;a+2<s;a+=o){const h=n[a]*2,l=n[a+1]*2,u=n[a+2]*2;if(r[0]=e[h],r[1]=e[h+1],r[2]=e[l],r[3]=e[l+1],r[4]=e[u],r[5]=e[u+1],kc.contains(Oa.x,Oa.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};op.BATCHABLE_SIZE=100;let Fc=op;class Tw extends $i{constructor(t,e,r){super();const n=new zt(t),s=new zt(e,!0),o=new zt(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,rt.FLOAT).addAttribute("aTextureCoord",s,2,!1,rt.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Iw=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Cw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Uc extends ei{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:Lt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||xi.from(Cw,Iw),r),this._colorDirty=!1,this.uvMatrix=new Af(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Bt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Bt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Gc{constructor(t,e,r){this.geometry=new $i,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||rt.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new zt(K0(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new zt(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new zt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===rt.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===rt.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===rt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===rt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Mw=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Pw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class hp extends Oo{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Lt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:rt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ei.from(Pw,Mw,{}),this.state=oi.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,s=this.renderer;let o=e.length;if(o===0)return;o>r&&!t.autoResize&&(o=r);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const h=e[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=af(t.blendMode,l),s.state.set(this.state);const u=s.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Bt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=n,p+=1){let g=o-f;g>n&&(g=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const m=a[p];m.uploadDynamic(e,f,g);const y=t._bufferUpdateIDs[p]||0;d=d||m._updateID<y,d&&(m._updateID=t._updateID,m.uploadStatic(e,f,g)),s.geometry.bind(m.geometry),u.drawElements(u.TRIANGLES,g*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,s=t._properties;for(let o=0;o<r;o+=n)e.push(new Gc(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Gc(this.properties,r,e)}uploadVertices(t,e,r,n,s,o){let a=0,h=0,l=0,u=0;for(let c=0;c<r;++c){const d=t[e+c],f=d._texture,p=d.scale.x,g=d.scale.y,m=f.trim,y=f.orig;m?(h=m.x-d.anchor.x*y.width,a=h+m.width,u=m.y-d.anchor.y*y.height,l=u+m.height):(a=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),n[o]=h*p,n[o+1]=u*g,n[o+s]=a*p,n[o+s+1]=u*g,n[o+s*2]=a*p,n[o+s*2+1]=l*g,n[o+s*3]=h*p,n[o+s*3+1]=l*g,o+=s*4}}uploadPosition(t,e,r,n,s,o){for(let a=0;a<r;a++){const h=t[e+a].position;n[o]=h.x,n[o+1]=h.y,n[o+s]=h.x,n[o+s+1]=h.y,n[o+s*2]=h.x,n[o+s*2+1]=h.y,n[o+s*3]=h.x,n[o+s*3+1]=h.y,o+=s*4}}uploadRotation(t,e,r,n,s,o){for(let a=0;a<r;a++){const h=t[e+a].rotation;n[o]=h,n[o+s]=h,n[o+s*2]=h,n[o+s*3]=h,o+=s*4}}uploadUvs(t,e,r,n,s,o){for(let a=0;a<r;++a){const h=t[e+a]._texture._uvs;h?(n[o]=h.x0,n[o+1]=h.y0,n[o+s]=h.x1,n[o+s+1]=h.y1,n[o+s*2]=h.x2,n[o+s*2+1]=h.y2,n[o+s*3]=h.x3,n[o+s*3+1]=h.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(t,e,r,n,s,o){for(let a=0;a<r;++a){const h=t[e+a],l=Bt.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);n[o]=l,n[o+s]=l,n[o+s*2]=l,n[o+s*3]=l,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}hp.extension={name:"particle",type:W.RendererPlugin};J.add(hp);var Uo=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Uo||{});const Is={willReadFrequently:!0},qe=class it{static get experimentalLetterSpacingSupported(){let t=it._experimentalLetterSpacingSupported;if(t!==void 0){const e=q.ADAPTER.getCanvasRenderingContext2D().prototype;t=it._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,s,o,a,h,l){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t,e,r,n=it._canvas){r=r??e.wordWrap;const s=e.toFontString(),o=it.measureFont(s);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const a=n.getContext("2d",Is);a.font=s;const h=(r?it.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let u=0;for(let p=0;p<h.length;p++){const g=it._measureText(h[p],e.letterSpacing,a);l[p]=g,u=Math.max(u,g)}let c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const d=e.lineHeight||o.fontSize+e.strokeThickness;let f=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(h.length-1)*(d+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new it(t,e,c,f,h,l,d+e.leading,u,o)}static _measureText(t,e,r){let n=!1;it.experimentalLetterSpacingSupported&&(it.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let s=r.measureText(t).width;return s>0&&(n?s-=e:s+=(it.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,r=it._canvas){const n=r.getContext("2d",Is);let s=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,c=it.collapseSpaces(u),d=it.collapseNewlines(u);let f=!c;const p=e.wordWrapWidth+l,g=it.tokenize(t);for(let m=0;m<g.length;m++){let y=g[m];if(it.isNewline(y)){if(!d){a+=it.addLine(o),f=!c,o="",s=0;continue}y=" "}if(c){const v=it.isBreakingSpace(y),x=it.isBreakingSpace(o[o.length-1]);if(v&&x)continue}const _=it.getFromCache(y,l,h,n);if(_>p)if(o!==""&&(a+=it.addLine(o),o="",s=0),it.canBreakWords(y,e.breakWords)){const v=it.wordWrapSplit(y);for(let x=0;x<v.length;x++){let E=v[x],N=E,I=1;for(;v[x+I];){const D=v[x+I];if(!it.canBreakChars(N,D,y,x,e.breakWords))E+=D;else break;N=D,I++}x+=I-1;const S=it.getFromCache(E,l,h,n);S+s>p&&(a+=it.addLine(o),f=!1,o="",s=0),o+=E,s+=S}}else{o.length>0&&(a+=it.addLine(o),o="",s=0);const v=m===g.length-1;a+=it.addLine(y,!v),f=!1,o="",s=0}else _+s>p&&(f=!1,a+=it.addLine(o),o="",s=0),(o.length>0||!it.isBreakingSpace(y)||f)&&(o+=y,s+=_)}return a+=it.addLine(o,!1),a}static addLine(t,e=!0){return t=it.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,n){let s=r[t];return typeof s!="number"&&(s=it._measureText(t,e,n)+e,r[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!it.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:it._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:it._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],o=t[n+1];if(it.isBreakingSpace(s,o)||it.isNewline(s)){r!==""&&(e.push(r),r=""),e.push(s);continue}r+=s}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(t){return it.graphemeSegmenter(t)}static measureFont(t){if(it._fonts[t])return it._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=it._canvas,n=it._context;n.font=t;const s=it.METRICS_STRING+it.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width);let a=Math.ceil(n.measureText(it.BASELINE_SYMBOL).width);const h=Math.ceil(it.HEIGHT_MULTIPLIER*a);if(a=a*it.BASELINE_MULTIPLIER|0,o===0||h===0)return it._fonts[t]=e,e;r.width=o,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);const l=n.getImageData(0,0,o,h).data,u=l.length,c=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let g=0;g<c;g+=4)if(l[f+g]!==255){p=!0;break}if(!p)f+=c;else break}for(e.ascent=a-d,f=u-c,p=!1,d=h;d>a;--d){for(let g=0;g<c;g+=4)if(l[f+g]!==255){p=!0;break}if(!p)f-=c;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,it._fonts[t]=e,e}static clearMetrics(t=""){t?delete it._fonts[t]:it._fonts={}}static get _canvas(){var t;if(!it.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if((t=r.getContext("2d",Is))!=null&&t.measureText)return it.__canvas=r,r;e=q.ADAPTER.createCanvas()}catch{e=q.ADAPTER.createCanvas()}e.width=e.height=10,it.__canvas=e}return it.__canvas}static get _context(){return it.__context||(it.__context=it._canvas.getContext("2d",Is)),it.__context}};qe.METRICS_STRING="|q",qe.BASELINE_SYMBOL="M",qe.BASELINE_MULTIPLIER=1.4,qe.HEIGHT_MULTIPLIER=2,qe.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})(),qe.experimentalLetterSpacing=!1,qe._fonts={},qe._newlines=[10,13],qe._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let mi=qe;const Rw=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],lp=class In{constructor(t){this.styleID=0,this.reset(),Fa(this,t,t)}clone(){const t={};return Fa(t,this,In.defaultStyle),new In(t)}reset(){Fa(this,In.defaultStyle,In.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=ka(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=ka(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){Dw(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=ka(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Rw.includes(n)&&(n=`"${n}"`),e[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};lp.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Uo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Si=lp;function ka(i){const t=Bt.shared,e=r=>{const n=t.setValue(r);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(i)?i.map(e):e(i)}function Dw(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function Fa(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const Nw={texture:!0,children:!1,baseTexture:!0},up=class $h extends bi{constructor(t,e,r){let n=!1;r||(r=q.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const s=Q.from(r);s.orig=new ft,s.trim=new ft,super(s),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=$h.defaultResolution??q.RESOLUTION,this._autoResolution=$h.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return mi.experimentalLetterSpacing}static set experimentalLetterSpacing(t){_t("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),mi.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,n=mi.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,o=n.height,a=n.lines,h=n.lineHeight,l=n.lineWidths,u=n.maxLineWidth,c=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;let d,f;const p=e.dropShadow?2:1;for(let g=0;g<p;++g){const m=e.dropShadow&&g===0,y=m?Math.ceil(Math.max(1,o)+e.padding*2):0,_=y*this._resolution;if(m){r.fillStyle="black",r.strokeStyle="black";const x=e.dropShadowColor,E=e.dropShadowBlur*this._resolution,N=e.dropShadowDistance*this._resolution;r.shadowColor=Bt.shared.setValue(x).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=E,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*N,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*N+_}else r.fillStyle=this._generateFillStyle(e,a,n),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let v=(h-c.fontSize)/2;h-c.fontSize<0&&(v=0);for(let x=0;x<a.length;x++)d=e.strokeThickness/2,f=e.strokeThickness/2+x*h+c.ascent+v,e.align==="right"?d+=u-l[x]:e.align==="center"&&(d+=(u-l[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[x],d+e.padding,f+e.padding-y,!0),e.fill&&this.drawLetterSpacing(a[x],d+e.padding,f+e.padding-y)}this.updateTexture()}drawLetterSpacing(t,e,r,n=!1){const s=this._style.letterSpacing;let o=!1;if(mi.experimentalLetterSpacingSupported&&(mi.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r);return}let a=e;const h=mi.graphemeSegmenter(t);let l=this.context.measureText(t).width,u=0;for(let c=0;c<h.length;++c){const d=h[c];n?this.context.strokeText(d,a,r):this.context.fillText(d,a,r);let f="";for(let p=c+1;p<h.length;++p)f+=h[p];u=this.context.measureText(f).width,a+=l-u+s,l=u}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=tv(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,r=this._style,n=r.trim?0:r.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const n=t.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,h=this.canvas.width/this._resolution-o-a*2,l=this.canvas.height/this._resolution-o-a*2,u=n.slice(),c=t.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(n[0]),c.unshift(0),u.push(n[n.length-1]),c.push(1),t.fillGradientType===Uo.LINEAR_VERTICAL){s=this.context.createLinearGradient(h/2,a,h/2,l+a);const d=r.fontProperties.fontSize+t.strokeThickness;for(let f=0;f<e.length;f++){const p=r.lineHeight*(f-1)+d,g=r.lineHeight*f;let m=g;f>0&&p>g&&(m=(g+p)/2);const y=g+d,_=r.lineHeight*(f+1);let v=y;f+1<e.length&&_<y&&(v=(y+_)/2);const x=(v-m)/l;for(let E=0;E<u.length;E++){let N=0;typeof c[E]=="number"?N=c[E]:N=E/u.length;let I=Math.min(1,Math.max(0,m/l+N*x));I=Number(I.toFixed(5)),s.addColorStop(I,u[E])}}}else{s=this.context.createLinearGradient(a,l/2,h+a,l/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let g;typeof c[p]=="number"?g=c[p]:g=f/d,s.addColorStop(g,u[p]),f++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Nw,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Oi(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Oi(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Si?this._style=t:this._style=new Si(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};up.defaultAutoResolution=!0;let bl=up;class Bw{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Lw(i,t){var r;let e=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let n=0;n<i._textures.length;n++)if(i._textures[n]instanceof Q){const s=i._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function Ow(i,t){if(i.baseTexture instanceof mt){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function kw(i,t){if(i._texture&&i._texture instanceof Q){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Fw(i,t){return t instanceof bl?(t.updateText(!0),!0):!1}function Uw(i,t){if(t instanceof Si){const e=t.toFontString();return mi.measureFont(e),!0}return!1}function Gw(i,t){if(i instanceof bl){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function $w(i,t){return i instanceof Si?(t.includes(i)||t.push(i),!0):!1}const cp=class dp{constructor(t){this.limiter=new Bw(dp.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Gw),this.registerFindHook($w),this.registerFindHook(Lw),this.registerFindHook(Ow),this.registerFindHook(kw),this.registerUploadHook(Fw),this.registerUploadHook(Uw)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,_e.system.addOnce(this.tick,this,fr.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)_e.system.addOnce(this.tick,this,fr.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ie)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&_e.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};cp.uploadsPerFrame=4;let Hh=cp;Object.defineProperties(q,{UPLOADS_PER_FRAME:{get(){return Hh.uploadsPerFrame},set(i){_t("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Hh.uploadsPerFrame=i}}});function fp(i,t){return t instanceof mt?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function Hw(i,t){if(!(t instanceof mo))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let n=0;n<r.length;n++){const{texture:s}=r[n].style;s&&fp(i,s.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function zw(i,t){return i instanceof mo?(t.push(i),!0):!1}class pp extends Hh{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(zw),this.registerUploadHook(fp),this.registerUploadHook(Hw)}}pp.extension={name:"prepare",type:W.RendererSystem};J.add(pp);var Ww=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Xw=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Vw=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,$c=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,jw=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Cs=new Lt;class gp extends Oo{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new xf,this.state=oi.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ei.from($c,jw,e),this.shader=t.context.webGLVersion>1?ei.from(Xw,Ww,e):ei.from($c,Vw,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,r.invalidate();const a=t._texture,h=a.baseTexture,l=h.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix;let d=h.isPowerOfTwo&&a.frame.width===h.width&&a.frame.height===h.height;d&&(h._glTextures[e.CONTEXT_UID]?d=h.wrapMode!==Gi.CLAMP:h.wrapMode===Gi.CLAMP&&(h.wrapMode=Gi.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,g=a.height,m=t._width,y=t._height;Cs.set(u.a*p/m,u.b*p/y,u.c*g/m,u.d*g/y,u.tx/m,u.ty/y),Cs.invert(),d?Cs.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=Cs.toArray(!0),f.uniforms.uColor=Bt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=af(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}gp.extension={name:"tilingSprite",type:W.RendererPlugin};J.add(gp);const mp=class Cn{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof Q?t:null,this.baseTexture=t instanceof mt?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=Ai(t,null);return r===null&&(r=parseFloat(e??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Cn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=Cn.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],o=s.frame;if(o){let a=null,h=null;const l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,u=new ft(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?a=new ft(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new ft(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(h=new ft(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new Q(this.baseTexture,a,u,h,s.rotated?2:0,s.anchor,s.borders),Q.addToCache(this.textures[n],n.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Cn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Cn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};mp.BATCH_SIZE=1e3;let Hc=mp;const Yw=["jpg","png","jpeg","avif","webp"];function yp(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[n]=t.textures[n]}),!e){const n=Zt.dirname(i[0]);t.linkedSheets.forEach((s,o)=>{const a=yp([`${n}/${t.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(r,a)})}return r}const qw={extension:W.Asset,cache:{test:i=>i instanceof Hc,getCacheableAssets:(i,t)=>yp(i,t,!1)},resolver:{test:i=>{const t=i.split("?")[0].split("."),e=t.pop(),r=t.pop();return e==="json"&&Yw.includes(r)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=q.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:W.LoadParser,priority:$e.Normal},async testParse(i,t){return Zt.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var h,l;let r=Zt.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let n=r+i.meta.image;n=Fh(n,t.src);const s=(await e.load([n]))[n],o=new Hc(s.baseTexture,i,t.src);await o.parse();const a=(h=i==null?void 0:i.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(a)){const u=[];for(const d of a){if(typeof d!="string")continue;let f=r+d;(l=t.data)!=null&&l.ignoreMultiPack||(f=Fh(f,t.src),u.push(e.load({src:f,data:{ignoreMultiPack:!0}})))}const c=await Promise.all(u);o.linkedSheets=c,c.forEach(d=>{d.linkedSheets=[o].concat(o.linkedSheets.filter(f=>f!==d))})}return o},unload(i){i.destroy(!0)}}};J.add(qw);class yo{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Xs{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const o=e[s].match(/^[a-z]+/gm)[0],a=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in a){const u=a[l].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[c]=p}r[o].push(h)}const n=new yo;return r.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),r.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),r.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),r.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),r.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),r.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class zh{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new yo,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<r.length;l++)e.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(let l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(let l=0;l<s.length;l++)e.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(let l=0;l<o.length;l++){const u=o[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)e.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return e}}class Wh{static test(t){return typeof t=="string"&&t.includes("<font>")?zh.test(q.ADAPTER.parseXML(t)):!1}static parse(t){return zh.parse(q.ADAPTER.parseXML(t))}}const Ua=[Xs,zh,Wh];function Kw(i){for(let t=0;t<Ua.length;t++)if(Ua[t].test(i))return Ua[t];return null}function Zw(i,t,e,r,n,s){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const h=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=i.width/r-h-l*2,c=i.height/r-h-l*2,d=o.slice(),f=e.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let g=1;g<p;++g)f.push(g/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),e.fillGradientType===Uo.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,l,u/2,c+l);let p=0;const g=(s.fontProperties.fontSize+e.strokeThickness)/c;for(let m=0;m<n.length;m++){const y=s.lineHeight*m;for(let _=0;_<d.length;_++){let v=0;typeof f[_]=="number"?v=f[_]:v=_/d.length;const x=y/c+v*g;let E=Math.max(p,x);E=Math.min(E,1),a.addColorStop(E,d[_]),p=E}}}else{a=t.createLinearGradient(l,c/2,u+l,c/2);const p=d.length+1;let g=1;for(let m=0;m<d.length;m++){let y;typeof f[m]=="number"?y=f[m]:y=g/p,a.addColorStop(y,d[m]),g++}}return a}function Qw(i,t,e,r,n,s,o){const a=e.text,h=e.fontProperties;t.translate(r,n),t.scale(s,s);const l=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=Zw(i,t,o,s,[a],e),t.strokeStyle=o.stroke,o.dropShadow){const c=o.dropShadowColor,d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;t.shadowColor=Bt.shared.setValue(c).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,u+e.lineHeight-h.descent),o.fill&&t.fillText(a,l,u+e.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Vs(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function vp(i){return Array.from?Array.from(i):i.split("")}function Jw(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...vp(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Ri=class Ke{constructor(t,e,r){var u;const[n]=t.info,[s]=t.common,[o]=t.page,[a]=t.distanceField,h=Ai(o.file),l={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/h,this.chars={},this.pageTextures=l;for(let c=0;c<t.page.length;c++){const{id:d,file:f}=t.page[c];l[d]=e instanceof Array?e[c]:e[f],a!=null&&a.fieldType&&a.fieldType!=="none"&&(l[d].baseTexture.alphaMode=ve.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=ni.OFF)}for(let c=0;c<t.char.length;c++){const{id:d,page:f}=t.char[c];let{x:p,y:g,width:m,height:y,xoffset:_,yoffset:v,xadvance:x}=t.char[c];p/=h,g/=h,m/=h,y/=h,_/=h,v/=h,x/=h;const E=new ft(p+l[f].frame.x/h,g+l[f].frame.y/h,m,y);this.chars[d]={xOffset:_,yOffset:v,xAdvance:x,kerning:{},texture:new Q(l[f].baseTexture,E),page:f}}for(let c=0;c<t.kerning.length;c++){let{first:d,second:f,amount:p}=t.kerning[c];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let n;if(t instanceof yo)n=t;else{const o=Kw(t);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(t)}e instanceof Q&&(e=[e]);const s=new Ke(n,e,r);return Ke.available[s.font]=s,s}static uninstall(t){const e=Ke.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Ke.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},Ke.defaultOptions,r),u=Jw(n),c=e instanceof Si?e:new Si(e),d=a,f=new yo;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,g=0,m,y,_,v=0;const x=[];for(let N=0;N<u.length;N++){m||(m=q.ADAPTER.createCanvas(),m.width=a,m.height=h,y=m.getContext("2d"),_=new mt(m,{resolution:o,...l}),x.push(new Q(_)),f.page.push({id:x.length-1,file:""}));const I=u[N],S=mi.measureText(I,c,!1,m),D=S.width,U=Math.ceil(S.height),L=Math.ceil((c.fontStyle==="italic"?2:1)*D);if(g>=h-U*o){if(g===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${I}')`);--N,m=null,y=null,_=null,g=0,p=0,v=0;continue}if(v=Math.max(U+S.fontProperties.descent,v),L*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${I}')`);--N,g+=v*o,g=Math.ceil(g),p=0,v=0;continue}Qw(m,y,S,p,g,o,c);const C=Vs(S.text);f.char.push({id:C,page:x.length-1,x:p/o,y:g/o,width:L,height:U,xoffset:0,yoffset:0,xadvance:D-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(L+2*s)*o,p=Math.ceil(p)}if(!(r!=null&&r.skipKerning))for(let N=0,I=u.length;N<I;N++){const S=u[N];for(let D=0;D<I;D++){const U=u[D],L=y.measureText(S).width,C=y.measureText(U).width,b=y.measureText(S+U).width-(L+C);b&&f.kerning.push({first:Vs(S),second:Vs(U),amount:b})}}const E=new Ke(f,x,!0);return Ke.available[t]!==void 0&&Ke.uninstall(t),Ke.available[t]=E,E}};Ri.ALPHA=[["a","z"],["A","Z"]," "],Ri.NUMERIC=[["0","9"]],Ri.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ri.ASCII=[[" ","~"]],Ri.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ri.ALPHANUMERIC},Ri.available={};let Di=Ri;var tb=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,eb=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const zc=[],Wc=[],Xc=[],ib=class _p extends ie{constructor(t,e={}){super();const{align:r,tint:n,maxWidth:s,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},_p.styleDefaults,e);if(!Di.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new Bt(n),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new _i(()=>{this.dirty=!0},this,0,0),this._roundPixels=q.ROUND_PIXELS,this.dirty=!0,this._resolution=q.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var L;const t=Di.available[this._fontName],e=this.fontSize,r=e/t.size,n=new ot,s=[],o=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=vp(h),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?zc:Wc;let d=null,f=0,p=0,g=0,m=-1,y=0,_=0,v=0,x=0;for(let C=0;C<l.length;C++){const b=l[C],R=Vs(b);if(/(?:\s)/.test(b)&&(m=C,y=f,x++),b==="\r"||b===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++g,++_,n.x=0,n.y+=t.lineHeight,d=null,x=0;continue}const tt=t.chars[R];if(!tt)continue;d&&tt.kerning[d]&&(n.x+=tt.kerning[d]);const et=Xc.pop()||{texture:Q.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ot};et.texture=tt.texture,et.line=g,et.charCode=R,et.position.x=Math.round(n.x+tt.xOffset+this._letterSpacing/2),et.position.y=Math.round(n.y+tt.yOffset),et.prevSpaces=x,s.push(et),f=et.position.x+Math.max(tt.xAdvance-tt.xOffset,tt.texture.orig.width),n.x+=tt.xAdvance+this._letterSpacing,v=Math.max(v,tt.yOffset+tt.texture.height),d=R,m!==-1&&u>0&&n.x>u&&(++_,zr(s,1+m-_,1+C-m),C=m,m=-1,o.push(y),a.push(s.length>0?s[s.length-1].prevSpaces:0),p=Math.max(p,y),g++,n.x=0,n.y+=t.lineHeight,d=null,x=0)}const E=l[l.length-1];E!=="\r"&&E!==`
`&&(/(?:\s)/.test(E)&&(f=y),o.push(f),p=Math.max(p,f),a.push(-1));const N=[];for(let C=0;C<=g;C++){let b=0;this._align==="right"?b=p-o[C]:this._align==="center"?b=(p-o[C])/2:this._align==="justify"&&(b=a[C]<0?0:(p-o[C])/a[C]),N.push(b)}const I=s.length,S={},D=[],U=this._activePagesMeshData;c.push(...U);for(let C=0;C<I;C++){const b=s[C].texture,R=b.baseTexture.uid;if(!S[R]){let tt=c.pop();if(!tt){const Z=new Tw;let at,gt;t.distanceFieldType==="none"?(at=new Uc(Q.EMPTY),gt=ut.NORMAL):(at=new Uc(Q.EMPTY,{program:xi.from(eb,tb),uniforms:{uFWidth:0}}),gt=ut.NORMAL_NPM);const k=new Fc(Z,at);k.blendMode=gt,tt={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:k,vertices:null,uvs:null,indices:null}}tt.index=0,tt.indexCount=0,tt.vertexCount=0,tt.uvsCount=0,tt.total=0;const{_textureCache:et}=this;et[R]=et[R]||new Q(b.baseTexture),tt.mesh.texture=et[R],tt.mesh.tint=this._tintColor.value,D.push(tt),S[R]=tt}S[R].total++}for(let C=0;C<U.length;C++)D.includes(U[C])||this.removeChild(U[C].mesh);for(let C=0;C<D.length;C++)D[C].mesh.parent!==this&&this.addChild(D[C].mesh);this._activePagesMeshData=D;for(const C in S){const b=S[C],R=b.total;if(!(((L=b.indices)==null?void 0:L.length)>6*R)||b.vertices.length<Fc.BATCHABLE_SIZE*2)b.vertices=new Float32Array(4*2*R),b.uvs=new Float32Array(4*2*R),b.indices=new Uint16Array(6*R);else{const tt=b.total,et=b.vertices;for(let Z=tt*4*2;Z<et.length;Z++)et[Z]=0}b.mesh.size=6*R}for(let C=0;C<I;C++){const b=s[C];let R=b.position.x+N[b.line]*(this._align==="justify"?b.prevSpaces:1);this._roundPixels&&(R=Math.round(R));const tt=R*r,et=b.position.y*r,Z=b.texture,at=S[Z.baseTexture.uid],gt=Z.frame,k=Z._uvs,F=at.index++;at.indices[F*6+0]=0+F*4,at.indices[F*6+1]=1+F*4,at.indices[F*6+2]=2+F*4,at.indices[F*6+3]=0+F*4,at.indices[F*6+4]=2+F*4,at.indices[F*6+5]=3+F*4,at.vertices[F*8+0]=tt,at.vertices[F*8+1]=et,at.vertices[F*8+2]=tt+gt.width*r,at.vertices[F*8+3]=et,at.vertices[F*8+4]=tt+gt.width*r,at.vertices[F*8+5]=et+gt.height*r,at.vertices[F*8+6]=tt,at.vertices[F*8+7]=et+gt.height*r,at.uvs[F*8+0]=k.x0,at.uvs[F*8+1]=k.y0,at.uvs[F*8+2]=k.x1,at.uvs[F*8+3]=k.y1,at.uvs[F*8+4]=k.x2,at.uvs[F*8+5]=k.y2,at.uvs[F*8+6]=k.x3,at.uvs[F*8+7]=k.y3}this._textWidth=p*r,this._textHeight=(n.y+t.lineHeight)*r;for(const C in S){const b=S[C];if(this.anchor.x!==0||this.anchor.y!==0){let Z=0;const at=this._textWidth*this.anchor.x,gt=this._textHeight*this.anchor.y;for(let k=0;k<b.total;k++)b.vertices[Z++]-=at,b.vertices[Z++]-=gt,b.vertices[Z++]-=at,b.vertices[Z++]-=gt,b.vertices[Z++]-=at,b.vertices[Z++]-=gt,b.vertices[Z++]-=at,b.vertices[Z++]-=gt}this._maxLineHeight=v*r;const R=b.mesh.geometry.getBuffer("aVertexPosition"),tt=b.mesh.geometry.getBuffer("aTextureCoord"),et=b.mesh.geometry.getIndex();R.data=b.vertices,tt.data=b.uvs,et.data=b.indices,R.update(),tt.update(),et.update()}for(let C=0;C<s.length;C++)Xc.push(s[C]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:n}=Di.available[this._fontName];if(r!=="none"){const{a:s,b:o,c:a,d:h}=this.worldTransform,l=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=this.fontSize/n,f=t._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*e*d*f}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Di.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Di.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Di.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r=Di.available[this._fontName].distanceFieldType==="none"?zc:Wc;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=Q.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};ib.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const rb=[".xml",".fnt"],nb={extension:{type:W.LoadParser,priority:$e.Normal},name:"loadBitmapFont",test(i){return rb.includes(Zt.extname(i).toLowerCase())},async testParse(i){return Xs.test(i)||Wh.test(i)},async parse(i,t,e){const r=Xs.test(i)?Xs.parse(i):Wh.parse(i),{src:n}=t,{page:s}=r,o=[];for(let l=0;l<s.length;++l){const u=s[l].file;let c=Zt.join(Zt.dirname(n),u);c=Fh(c,n),o.push(c)}const a=await e.load(o),h=o.map(l=>a[l]);return Di.install(r,h,!0)},async load(i,t){return(await q.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};J.add(nb);const Xh=class Or extends Si{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Or(Object.keys(Or.defaultOptions).reduce((e,r)=>({...e,[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Or.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=Or;if(r[t]){const n=r[t];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return q.ADAPTER.fetch(t).then(n=>n.blob()).then(async n=>new Promise((s,o)=>{const a=URL.createObjectURL(n),h=new FileReader;h.onload=()=>s([a,h.result]),h.onerror=o,h.readAsDataURL(n)})).then(async([n,s])=>{const o=Object.assign({family:Zt.basename(t,Zt.extname(t)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);r[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(r=>!this._overrides.includes(r));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(r=>this._overrides.includes(r));e.length>0&&(this._overrides=this._overrides.filter(r=>!e.includes(r)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Y0(t)),typeof t=="number"?j0(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const s=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,Or.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=q.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Xh.availableFonts={},Xh.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Ga=Xh;const Ms=class kr extends bi{constructor(t="",e={}){super(Q.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,n=Q.from(r,{scaleMode:q.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new ft,n.trim=new ft,this.texture=n;const s="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(s,"svg"),h=document.createElementNS(s,"foreignObject"),l=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=kr.defaultMaxWidth,this.maxHeight=kr.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=r,this._loadImage=new Image,this._autoResolution=kr.defaultAutoResolution,this._resolution=kr.defaultResolution??q.RESOLUTION,this.text=t,this.style=e}measureText(t){var u,c;const{text:e,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:a}=s;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const h=Math.min(this.maxWidth,Math.ceil(o)),l=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(u=this._style)==null?void 0:u.toCSS(n)}),this._styleElement.textContent=(c=this._style)==null?void 0:c.toGlobalCSS()),{width:h+r.padding*2,height:l+r.padding*2}}async updateText(t=!0){const{style:e,_image:r,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:o}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,s)),r.height=n.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(h=>{n.onload=async()=>{if(a<this._updateID){h();return}await e.onBeforeDraw(),r.src=n.src,n.onload=null,n.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:n}=this,{padding:s}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=r.width/n,e.trim.height=e._frame.height=r.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),o.setRealSize(r.width,r.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var r,n,s,o,a;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},kr.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=e,(n=this._svgRoot)==null||n.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Oi(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Oi(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Ga?(this.ownsStyle=!1,this._style=t):t instanceof Si?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Ga.from(t)):(this.ownsStyle=!0,this._style=new Ga(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Ms.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ms.defaultMaxWidth=2024,Ms.defaultMaxHeight=2024,Ms.defaultAutoResolution=!0;var sb=Object.defineProperty,ob=(i,t,e)=>t in i?sb(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,T=(i,t,e)=>(ob(i,typeof t!="symbol"?t+"":t,e),e);class Pe{constructor(t){T(this,"parent"),T(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var ab=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},xp={exports:{}};(function(i,t){(function(){var e,r;r=function(n){return i.exports=n},e={linear:function(n,s,o,a){return o*n/a+s},easeInQuad:function(n,s,o,a){return o*(n/=a)*n+s},easeOutQuad:function(n,s,o,a){return-o*(n/=a)*(n-2)+s},easeInOutQuad:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n+s:-o/2*(--n*(n-2)-1)+s},easeInCubic:function(n,s,o,a){return o*(n/=a)*n*n+s},easeOutCubic:function(n,s,o,a){return o*((n=n/a-1)*n*n+1)+s},easeInOutCubic:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n+s:o/2*((n-=2)*n*n+2)+s},easeInQuart:function(n,s,o,a){return o*(n/=a)*n*n*n+s},easeOutQuart:function(n,s,o,a){return-o*((n=n/a-1)*n*n*n-1)+s},easeInOutQuart:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n*n+s:-o/2*((n-=2)*n*n*n-2)+s},easeInQuint:function(n,s,o,a){return o*(n/=a)*n*n*n*n+s},easeOutQuint:function(n,s,o,a){return o*((n=n/a-1)*n*n*n*n+1)+s},easeInOutQuint:function(n,s,o,a){return(n/=a/2)<1?o/2*n*n*n*n*n+s:o/2*((n-=2)*n*n*n*n+2)+s},easeInSine:function(n,s,o,a){return-o*Math.cos(n/a*(Math.PI/2))+o+s},easeOutSine:function(n,s,o,a){return o*Math.sin(n/a*(Math.PI/2))+s},easeInOutSine:function(n,s,o,a){return-o/2*(Math.cos(Math.PI*n/a)-1)+s},easeInExpo:function(n,s,o,a){return n===0?s:o*Math.pow(2,10*(n/a-1))+s},easeOutExpo:function(n,s,o,a){return n===a?s+o:o*(-Math.pow(2,-10*n/a)+1)+s},easeInOutExpo:function(n,s,o,a){return(n/=a/2)<1?o/2*Math.pow(2,10*(n-1))+s:o/2*(-Math.pow(2,-10*--n)+2)+s},easeInCirc:function(n,s,o,a){return-o*(Math.sqrt(1-(n/=a)*n)-1)+s},easeOutCirc:function(n,s,o,a){return o*Math.sqrt(1-(n=n/a-1)*n)+s},easeInOutCirc:function(n,s,o,a){return(n/=a/2)<1?-o/2*(Math.sqrt(1-n*n)-1)+s:o/2*(Math.sqrt(1-(n-=2)*n)+1)+s},easeInElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),-(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+s},easeOutElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a),l||(l=a*.3),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),h*Math.pow(2,-10*n)*Math.sin((n*a-u)*(2*Math.PI)/l)+o+s},easeInOutElastic:function(n,s,o,a){var h,l,u;return u=1.70158,l=0,h=o,n===0||(n/=a/2),l||(l=a*(.3*1.5)),h<Math.abs(o)?(h=o,u=l/4):u=l/(2*Math.PI)*Math.asin(o/h),n<1?-.5*(h*Math.pow(2,10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l))+s:h*Math.pow(2,-10*(n-=1))*Math.sin((n*a-u)*(2*Math.PI)/l)*.5+o+s},easeInBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),o*(n/=a)*n*((h+1)*n-h)+s},easeOutBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),o*((n=n/a-1)*n*((h+1)*n+h)+1)+s},easeInOutBack:function(n,s,o,a,h){return h===void 0&&(h=1.70158),(n/=a/2)<1?o/2*(n*n*(((h*=1.525)+1)*n-h))+s:o/2*((n-=2)*n*(((h*=1.525)+1)*n+h)+2)+s},easeInBounce:function(n,s,o,a){var h;return h=e.easeOutBounce(a-n,0,o,a),o-h+s},easeOutBounce:function(n,s,o,a){return(n/=a)<1/2.75?o*(7.5625*n*n)+s:n<2/2.75?o*(7.5625*(n-=1.5/2.75)*n+.75)+s:n<2.5/2.75?o*(7.5625*(n-=2.25/2.75)*n+.9375)+s:o*(7.5625*(n-=2.625/2.75)*n+.984375)+s},easeInOutBounce:function(n,s,o,a){var h;return n<a/2?(h=e.easeInBounce(n*2,0,o,a),h*.5+s):(h=e.easeOutBounce(n*2-a,0,o,a),h*.5+o*.5+s)}},r(e)}).call(ab)})(xp);const Vc=xp.exports;function Go(i,t){if(i){if(typeof i=="function")return i;if(typeof i=="string")return Vc[i]}else return Vc[t]}const hb={removeOnInterrupt:!1,ease:"linear",time:1e3};class lb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"startX"),T(this,"startY"),T(this,"deltaX"),T(this,"deltaY"),T(this,"keepCenter"),T(this,"startWidth",null),T(this,"startHeight",null),T(this,"deltaWidth",null),T(this,"deltaHeight",null),T(this,"width",null),T(this,"height",null),T(this,"time",0),this.options=Object.assign({},hb,e),this.options.ease=Go(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new ot(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const r=this.parent.width,n=this.parent.height;this.complete(),(r!==this.parent.width||n!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const r=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const n=this.startWidth,s=this.deltaWidth;this.parent.fitWidth(n+s*r,this.keepCenter,this.height===null)}if(this.height!==null){const n=this.startHeight,s=this.deltaHeight;this.parent.fitHeight(n+s*r,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const n=this.startX,s=this.startY,o=this.deltaX,a=this.deltaY,h=new ot(this.parent.x,this.parent.y);this.parent.moveCenter(n+o*r,s+a*r),this.parent.emit("moved",{viewport:this.parent,original:h,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const ub={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class cb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"left"),T(this,"top"),T(this,"right"),T(this,"bottom"),T(this,"underflowX"),T(this,"underflowY"),T(this,"ease"),T(this,"toX"),T(this,"toY"),this.options=Object.assign({},ub,e),this.ease=Go(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const r=this.options.underflow.toLowerCase();r==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=r.indexOf("left")!==-1?-1:r.indexOf("right")!==-1?1:0,this.underflowY=r.indexOf("top")!==-1?-1:r.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,r=typeof t.y>"u"?0:t.y,n=typeof t.width>"u"?this.parent.worldWidth:t.width,s=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>n,top:this.parent.top<r,bottom:this.parent.bottom>s,topLeft:new ot(e*this.parent.scale.x,r*this.parent.scale.y),bottomRight:new ot(n*this.parent.scale.x-this.parent.screenWidth,s*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new ot(0,0),bottomRight:new ot(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let r,n=this.parent.plugins.get("decelerate",!0);n&&(n.x||n.y)&&(n.x&&n.percentChangeX===((t=n.options)==null?void 0:t.friction)||n.y&&n.percentChangeY===((e=n.options)==null?void 0:e.friction))&&(r=this.oob(),(r.left&&this.left||r.right&&this.right)&&(n.percentChangeX=this.options.friction),(r.top&&this.top||r.bottom&&this.bottom)&&(n.percentChangeY=this.options.friction));const s=this.parent.plugins.get("drag",!0)||{},o=this.parent.plugins.get("pinch",!0)||{};if(n=n||{},!(s!=null&&s.active)&&!(o!=null&&o.active)&&(!this.toX||!this.toY)&&(!n.x||!n.y)){r=r||this.oob();const a=r.topLeft,h=r.bottomRight;if(!this.toX&&!n.x){let l=null;r.left&&this.left?l=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-a.x:r.right&&this.right&&(l=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-h.x),l!==null&&this.parent.x!==l&&(this.toX={time:0,start:this.parent.x,delta:l-this.parent.x,end:l},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!n.y){let l=null;r.top&&this.top?l=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-a.y:r.bottom&&this.bottom&&(l=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-h.y),l!==null&&this.parent.y!==l&&(this.toY={time:0,start:this.parent.y,delta:l-this.parent.y,end:l},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const db={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class fb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"last"),T(this,"noUnderflow"),T(this,"underflowX"),T(this,"underflowY"),this.options=Object.assign({},db,e),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new ot(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,r=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,r=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,r=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,e.x=0,r=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,r=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,r=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,r=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,e.y=0,r=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const pb={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class gb extends Pe{constructor(t,e={}){super(t),T(this,"options"),this.options=Object.assign({},pb,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&e<this.options.minHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&e>this.options.maxHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const s=this.options.minScale;t.x=typeof s.x>"u"?null:s.x,t.y=typeof s.y>"u"?null:s.y}if(typeof this.options.maxScale=="number")e.x=this.options.maxScale,e.y=this.options.maxScale;else if(this.options.maxScale!==null){const s=this.options.maxScale;e.x=typeof s.x>"u"?null:s.x,e.y=typeof s.y>"u"?null:s.y}let r=this.parent.scale.x,n=this.parent.scale.y;t.x!==null&&r<t.x&&(r=t.x),e.x!==null&&r>e.x&&(r=e.x),t.y!==null&&n<t.y&&(n=t.y),e.y!==null&&n>e.y&&(n=e.y),(r!==this.parent.scale.x||n!==this.parent.scale.y)&&(this.parent.scale.set(r,n),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const mb={friction:.98,bounce:.8,minSpeed:.01},Pi=16;class yb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"x"),T(this,"y"),T(this,"percentChangeX"),T(this,"percentChangeY"),T(this,"saved"),T(this,"timeSinceRelease"),this.options=Object.assign({},mb,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",r=>this.handleMoved(r))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];t.type==="clamp-x"&&t.original?e.x===t.original.x&&(e.x=this.parent.x):t.type==="clamp-y"&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const r=t-e.time;this.x=(this.parent.x-e.x)/r,this.y=(this.parent.y-e.y)/r,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,r=this.timeSinceRelease,n=this.timeSinceRelease+t;if(this.x){const s=this.percentChangeX,o=Math.log(s);this.parent.x+=this.x*Pi/o*(Math.pow(s,n/Pi)-Math.pow(s,r/Pi)),this.x*=Math.pow(this.percentChangeX,t/Pi)}if(this.y){const s=this.percentChangeY,o=Math.log(s);this.parent.y+=this.y*Pi/o*(Math.pow(s,n/Pi)-Math.pow(s,r/Pi)),this.y*=Math.pow(this.percentChangeY,t/Pi)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const vb={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class _b extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"moved"),T(this,"reverse"),T(this,"xDirection"),T(this,"yDirection"),T(this,"keyIsPressed"),T(this,"mouse"),T(this,"underflowX"),T(this,"underflowY"),T(this,"last"),T(this,"current"),T(this,"windowEventHandlers",[]),this.options=Object.assign({},vb,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const e=n=>{t.includes(n.code)&&(this.keyIsPressed=!0)},r=n=>{t.includes(n.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",r),this.addWindowEventHandler("keydown",e)}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e=t.pointerType==="mouse",r=this.parent.input.count();return!!((r===1||r>1&&!this.parent.plugins.get("pinch",!0))&&(!e||this.mouse[t.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,r=t.global.y,n=this.parent.input.count();if(n===1||n>1&&!this.parent.plugins.get("pinch",!0)){const s=e-this.last.x,o=r-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(s)||this.yDirection&&this.parent.input.checkThreshold(o)){const a={x:e,y:r};return this.xDirection&&(this.parent.x+=(a.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(a.y-this.last.y)*this.options.factor),this.last=a,this.moved||this.parent.emit("drag-start",{event:t,screen:new ot(this.last.x,this.last.y),world:this.parent.toWorld(new ot(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(e.length===1){const r=e[0];return r.last&&(this.last={x:r.last.x,y:r.last.y},this.current=r.id),this.moved=!1,!0}else if(this.last&&this.moved){const r=new ot(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:r,world:this.parent.toWorld(r),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const r=t.deltaMode?this.options.lineHeight:1,n=[t.deltaX,t.deltaY],[s,o]=this.options.wheelSwapAxes?n.reverse():n;return this.xDirection&&(this.parent.x+=s*r*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=o*r*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const xb={speed:0,acceleration:null,radius:null};class wb extends Pe{constructor(t,e,r={}){super(t),T(this,"options"),T(this,"target"),T(this,"velocity"),this.target=e,this.options=Object.assign({},xb,r),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let r=this.target.x,n=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius){const a=Math.atan2(this.target.y-e.y,this.target.x-e.x);r=this.target.x-Math.cos(a)*this.options.radius,n=this.target.y-Math.sin(a)*this.options.radius}else return;const s=r-e.x,o=n-e.y;if(s||o)if(this.options.speed)if(this.options.acceleration){const a=Math.atan2(n-e.y,r-e.x),h=Math.sqrt(Math.pow(s,2)+Math.pow(o,2));if(h){const l=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);h>l?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const u=Math.cos(a)*this.velocity.x,c=Math.sin(a)*this.velocity.y,d=Math.abs(u)>Math.abs(s)?r:e.x+u,f=Math.abs(c)>Math.abs(o)?n:e.y+c;this.parent.moveCenter(d,f),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const a=Math.atan2(n-e.y,r-e.x),h=Math.cos(a)*this.options.speed,l=Math.sin(a)*this.options.speed,u=Math.abs(h)>Math.abs(s)?r:e.x+h,c=Math.abs(l)>Math.abs(o)?n:e.y+l;this.parent.moveCenter(u,c),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(r,n),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const bb={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class Eb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"reverse"),T(this,"radiusSquared"),T(this,"left"),T(this,"top"),T(this,"right"),T(this,"bottom"),T(this,"horizontal"),T(this,"vertical"),this.options=Object.assign({},bb,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.pointerType!=="mouse"&&t.pointerId!==1||!this.options.allowButtons&&t.buttons!==0)return!1;const e=t.global.x,r=t.global.y;if(this.radiusSquared){const n=this.parent.toScreen(this.parent.center);if(Math.pow(n.x-e,2)+Math.pow(n.y-r,2)>=this.radiusSquared){const s=Math.atan2(n.y-r,n.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(s))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(s))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(s)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(s)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&r<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&r>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const Ab={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};let Sb=class extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"active",!1),T(this,"pinching",!1),T(this,"moved",!1),T(this,"lastCenter"),this.options=Object.assign({},Ab,e)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,r=t.global.y,n=this.parent.input.touches;if(n.length>=2){const s=n[0],o=n[1],a=s.last&&o.last?Math.sqrt(Math.pow(o.last.x-s.last.x,2)+Math.pow(o.last.y-s.last.y,2)):null;if(s.id===t.pointerId?s.last={x:e,y:r,data:t}:o.id===t.pointerId&&(o.last={x:e,y:r,data:t}),a){let h;const l=new ot(s.last.x+(o.last.x-s.last.x)/2,s.last.y+(o.last.y-s.last.y)/2);this.options.center||(h=this.parent.toLocal(l));let u=Math.sqrt(Math.pow(o.last.x-s.last.x,2)+Math.pow(o.last.y-s.last.y,2));u=u===0?u=1e-10:u;const c=(1-a/u)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=c),this.isAxisY()&&(this.parent.scale.y+=c),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:l});const d=this.parent.plugins.get("clamp-zoom",!0);if(d&&d.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const f=this.parent.toGlobal(h);this.parent.x+=(l.x-f.x)*this.options.factor,this.parent.y+=(l.y-f.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(l.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(l.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=l,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}};const Tb={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class Ib extends Pe{constructor(t,e,r,n={}){super(t),T(this,"options"),T(this,"ease"),T(this,"x"),T(this,"y"),T(this,"percent"),T(this,"snapping"),T(this,"deltaX"),T(this,"deltaY"),T(this,"startX"),T(this,"startY"),this.options=Object.assign({},Tb,n),this.ease=Go(n.ease,"easeInOutSine"),this.x=e,this.y=r,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const e=this.snapping;e.time+=t;let r,n,s;const o=this.startX,a=this.startY,h=this.deltaX,l=this.deltaY;if(e.time>this.options.time)r=!0,n=o+h,s=a+l;else{const u=this.ease(e.time,0,1,this.options.time);n=o+h*u,s=a+l*u}this.options.topLeft?this.parent.moveCorner(n,s):this.parent.moveCenter(n,s),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),r&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const e=this.options.topLeft?this.parent.corner:this.parent.center;(e.x!==this.x||e.y!==this.y)&&this.snapStart()}}}const Cb={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class Mb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"ease"),T(this,"xScale"),T(this,"yScale"),T(this,"xIndependent"),T(this,"yIndependent"),T(this,"snapping"),this.options=Object.assign({},Cb,e),this.ease=Go(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,r=this.parent.screenWidth/this.xScale,n=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:r-t,deltaY:n-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const r=this.snapping;if(r.time+=t,r.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const s=this.snapping,o=this.ease(s.time,s.startX,s.deltaX,this.options.time),a=this.ease(s.time,s.startY,s.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/o,this.parent.scale.y=this.parent.screenHeight/a}const n=this.parent.plugins.get("clamp-zoom",!0);n&&n.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}resume(){this.snapping=null,super.resume()}}const Pb={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class Rb extends Pe{constructor(t,e={}){super(t),T(this,"options"),T(this,"smoothing"),T(this,"smoothingCenter"),T(this,"smoothingCount"),T(this,"keyIsPressed"),this.options=Object.assign({},Pb,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let r;this.options.center||(r=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const s=this.parent.toGlobal(r);this.parent.x+=t.x-s.x,this.parent.y+=t.y-s.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),r=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,n=Math.pow(2,(1+this.options.percent)*r);let s;this.options.center||(s=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(s);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),r=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,n=Math.pow(2,(1+this.options.percent)*r);if(this.options.smooth){const s={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+s.x)*n-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+s.y)*n-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let s;this.options.center||(s=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.toGlobal(s);this.parent.x+=e.x-a.x,this.parent.y+=e.y-a.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class Db{constructor(t){T(this,"viewport"),T(this,"clickedAvailable"),T(this,"isMouseDown"),T(this,"last"),T(this,"wheelFunction"),T(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new ft(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.worldVisible)){if(t.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),this.count()===1){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),r=this.viewport.plugins.get("bounce",!0);(!e||!e.isActive())&&(!r||!r.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const r=t.global.x-this.last.x,n=t.global.y-this.last.y;(this.checkThreshold(r)||this.checkThreshold(n))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;t.pointerType==="mouse"&&(this.isMouseDown=!1),t.pointerType!=="mouse"&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new ot;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t){this.touches.splice(e,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}const vn=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class Nb{constructor(t){T(this,"plugins"),T(this,"list"),T(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,r=vn.length){const n=this.plugins[t];n&&n.destroy(),this.plugins[t]=e;const s=vn.indexOf(t);s!==-1&&vn.splice(s,1),vn.splice(r,0,t),this.sort()}get(t,e){var r;return e&&(r=this.plugins[t])!=null&&r.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&((e=this.plugins[t])==null||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;(e=this.plugins[t])==null||e.pause()}resume(t){var e;(e=this.plugins[t])==null||e.resume()}sort(){this.list=[];for(const t of vn)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const r of this.list)r.down(t)&&(e=!0);return e}move(t){let e=!1;for(const r of this.viewport.plugins.list)r.move(t)&&(e=!0);return e}up(t){let e=!1;for(const r of this.list)r.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const r of this.list)r.wheel(t)&&(e=!0);return e}}const Bb={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:_e.shared,allowPreserveDragOutside:!1};class Lb extends ie{constructor(t){super(),T(this,"moving"),T(this,"screenWidth"),T(this,"screenHeight"),T(this,"threshold"),T(this,"input"),T(this,"plugins"),T(this,"zooming"),T(this,"lastViewport"),T(this,"options"),T(this,"_dirty"),T(this,"_forceHitArea"),T(this,"_hitAreaDefault"),T(this,"_pause"),T(this,"tickerFunction"),T(this,"_worldWidth"),T(this,"_worldHeight"),T(this,"_disableOnContextMenu",e=>e.preventDefault()),this.options={...Bb,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new Db(this),this.plugins=new Nb(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new ft(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,r,n){this.screenWidth=t,this.screenHeight=e,typeof r<"u"&&(this._worldWidth=r),typeof n<"u"&&(this._worldHeight=n),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new ft(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return arguments.length===2?this.toLocal(new ot(t,e)):this.toLocal(t)}toScreen(t,e){return arguments.length===2?this.toGlobal(new ot(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new ot(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,r;typeof t[0]=="number"?(e=t[0],r=t[1]):(e=t[0].x,r=t[0].y);const n=(this.worldScreenWidth/2-e)*this.scale.x,s=(this.worldScreenHeight/2-r)*this.scale.y;return(this.x!==n||this.y!==s)&&(this.position.set(n,s),this.plugins.reset(),this.dirty=!0),this}get corner(){return new ot(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,r;return t.length===1?(e=-t[0].x*this.scale.x,r=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,r=-t[1]*this.scale.y),(e!==this.x||r!==this.y)&&(this.position.set(e,r),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const r=this.screenWidth/t,n=this.screenHeight/e;return Math.min(r,n)}findCover(t,e){const r=this.screenWidth/t,n=this.screenHeight/e;return Math.max(r,n)}fitWidth(t=this.worldWidth,e,r=!0,n){let s;e&&(s=this.center),this.scale.x=this.screenWidth/t,r&&(this.scale.y=this.scale.x);const o=this.plugins.get("clamp-zoom",!0);return!n&&o&&o.clamp(),e&&s&&this.moveCenter(s),this}fitHeight(t=this.worldHeight,e,r=!0,n){let s;e&&(s=this.center),this.scale.y=this.screenHeight/t,r&&(this.scale.x=this.scale.y);const o=this.plugins.get("clamp-zoom",!0);return!n&&o&&o.clamp(),e&&s&&this.moveCenter(s),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,r=this.worldHeight){let n;t&&(n=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/r,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&n&&this.moveCenter(n),this}setZoom(t,e){let r;e&&(r=this.center),this.scale.set(t);const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),e&&r&&this.moveCenter(r),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new Mb(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new ot(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new ft(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new _b(this,t)),this}clamp(t){return this.plugins.add("clamp",new fb(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new yb(this,t)),this}bounce(t){return this.plugins.add("bounce",new cb(this,t)),this}pinch(t){return this.plugins.add("pinch",new Sb(this,t)),this}snap(t,e,r){return this.plugins.add("snap",new Ib(this,t,e,r)),this}follow(t,e){return this.plugins.add("follow",new wb(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new Rb(this,t)),this}animate(t){return this.plugins.add("animate",new lb(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new gb(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new Eb(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,r,n,s){s&&(r>this.worldScreenWidth||n>this.worldScreenHeight)&&(this.fit(!0,r,n),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let o=!1;t<this.left?(this.left=t,o=!0):t+r>this.right&&(this.right=t+r,o=!0),e<this.top?(this.top=e,o=!0):e+n>this.bottom&&(this.bottom=e+n,o=!0),o&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}function Vr(i,t){return i==null||t==null?NaN:i<t?-1:i>t?1:i>=t?0:NaN}function Ob(i,t){return i==null||t==null?NaN:t<i?-1:t>i?1:t>=i?0:NaN}function wp(i){let t,e,r;i.length!==2?(t=Vr,e=(a,h)=>Vr(i(a),h),r=(a,h)=>i(a)-h):(t=i===Vr||i===Ob?i:kb,e=i,r=i);function n(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<0?l=c+1:u=c}while(l<u)}return l}function s(a,h,l=0,u=a.length){if(l<u){if(t(h,h)!==0)return u;do{const c=l+u>>>1;e(a[c],h)<=0?l=c+1:u=c}while(l<u)}return l}function o(a,h,l=0,u=a.length){const c=n(a,h,l,u-1);return c>l&&r(a[c-1],h)>-r(a[c],h)?c-1:c}return{left:n,center:o,right:s}}function kb(){return 0}function Fb(i){return i===null?NaN:+i}const Ub=wp(Vr),Gb=Ub.right;wp(Fb).center;const $b=Gb;function Hb(i,t){let e,r;if(t===void 0)for(const n of i)n!=null&&(e===void 0?n>=n&&(e=r=n):(e>n&&(e=n),r<n&&(r=n)));else{let n=-1;for(let s of i)(s=t(s,++n,i))!=null&&(e===void 0?s>=s&&(e=r=s):(e>s&&(e=s),r<s&&(r=s)))}return[e,r]}class Vh extends Map{constructor(t,e=Xb){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[r,n]of t)this.set(r,n)}get(t){return super.get(jc(this,t))}has(t){return super.has(jc(this,t))}set(t,e){return super.set(zb(this,t),e)}delete(t){return super.delete(Wb(this,t))}}function jc({_intern:i,_key:t},e){const r=t(e);return i.has(r)?i.get(r):e}function zb({_intern:i,_key:t},e){const r=t(e);return i.has(r)?i.get(r):(i.set(r,e),e)}function Wb({_intern:i,_key:t},e){const r=t(e);return i.has(r)&&(e=i.get(r),i.delete(r)),e}function Xb(i){return i!==null&&typeof i=="object"?i.valueOf():i}function Vb(i){return i}function jb(i,t,...e){return Yb(i,Vb,t,e)}function Yb(i,t,e,r){return function n(s,o){if(o>=r.length)return e(s);const a=new Vh,h=r[o++];let l=-1;for(const u of s){const c=h(u,++l,s),d=a.get(c);d?d.push(u):a.set(c,[u])}for(const[u,c]of a)a.set(u,n(c,o));return t(a)}(i,0)}function qb(i,t){return Array.from(t,e=>i[e])}function Kb(i,...t){if(typeof i[Symbol.iterator]!="function")throw new TypeError("values is not iterable");i=Array.from(i);let[e]=t;if(e&&e.length!==2||t.length>1){const r=Uint32Array.from(i,(n,s)=>s);return t.length>1?(t=t.map(n=>i.map(n)),r.sort((n,s)=>{for(const o of t){const a=jh(o[n],o[s]);if(a)return a}})):(e=i.map(e),r.sort((n,s)=>jh(e[n],e[s]))),qb(i,r)}return i.sort(Zb(e))}function Zb(i=Vr){if(i===Vr)return jh;if(typeof i!="function")throw new TypeError("compare is not a function");return(t,e)=>{const r=i(t,e);return r||r===0?r:(i(e,e)===0)-(i(t,t)===0)}}function jh(i,t){return(i==null||!(i>=i))-(t==null||!(t>=t))||(i<t?-1:i>t?1:0)}const Qb=Math.sqrt(50),Jb=Math.sqrt(10),t1=Math.sqrt(2);function vo(i,t,e){const r=(t-i)/Math.max(0,e),n=Math.floor(Math.log10(r)),s=r/Math.pow(10,n),o=s>=Qb?10:s>=Jb?5:s>=t1?2:1;let a,h,l;return n<0?(l=Math.pow(10,-n)/o,a=Math.round(i*l),h=Math.round(t*l),a/l<i&&++a,h/l>t&&--h,l=-l):(l=Math.pow(10,n)*o,a=Math.round(i/l),h=Math.round(t/l),a*l<i&&++a,h*l>t&&--h),h<a&&.5<=e&&e<2?vo(i,t,e*2):[a,h,l]}function e1(i,t,e){if(t=+t,i=+i,e=+e,!(e>0))return[];if(i===t)return[i];const r=t<i,[n,s,o]=r?vo(t,i,e):vo(i,t,e);if(!(s>=n))return[];const a=s-n+1,h=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)h[l]=(s-l)/-o;else for(let l=0;l<a;++l)h[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)h[l]=(n+l)/-o;else for(let l=0;l<a;++l)h[l]=(n+l)*o;return h}function Yh(i,t,e){return t=+t,i=+i,e=+e,vo(i,t,e)[2]}function i1(i,t,e){t=+t,i=+i,e=+e;const r=t<i,n=r?Yh(t,i,e):Yh(i,t,e);return(r?-1:1)*(n<0?1/-n:n)}function r1(i,t){let e;if(t===void 0)for(const r of i)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let n of i)(n=t(n,++r,i))!=null&&(e<n||e===void 0&&n>=n)&&(e=n)}return e}function Ve(i,t){if(typeof i[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof t!="function")throw new TypeError("mapper is not a function");return Array.from(i,(e,r)=>t(e,r,i))}var n1={value:()=>{}};function El(){for(var i=0,t=arguments.length,e={},r;i<t;++i){if(!(r=arguments[i]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new js(e)}function js(i){this._=i}function s1(i,t){return i.trim().split(/^|\s+/).map(function(e){var r="",n=e.indexOf(".");if(n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}js.prototype=El.prototype={constructor:js,on:function(i,t){var e=this._,r=s1(i+"",e),n,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((n=(i=r[s]).type)&&(n=o1(e[n],i.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(i=r[s]).type)e[n]=Yc(e[n],i.name,t);else if(t==null)for(n in e)e[n]=Yc(e[n],i.name,null);return this},copy:function(){var i={},t=this._;for(var e in t)i[e]=t[e].slice();return new js(i)},call:function(i,t){if((n=arguments.length-2)>0)for(var e=new Array(n),r=0,n,s;r<n;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(s=this._[i],r=0,n=s.length;r<n;++r)s[r].value.apply(t,e)},apply:function(i,t,e){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var r=this._[i],n=0,s=r.length;n<s;++n)r[n].value.apply(t,e)}};function o1(i,t){for(var e=0,r=i.length,n;e<r;++e)if((n=i[e]).name===t)return n.value}function Yc(i,t,e){for(var r=0,n=i.length;r<n;++r)if(i[r].name===t){i[r]=n1,i=i.slice(0,r).concat(i.slice(r+1));break}return e!=null&&i.push({name:t,value:e}),i}var qh="http://www.w3.org/1999/xhtml";const qc={svg:"http://www.w3.org/2000/svg",xhtml:qh,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function $o(i){var t=i+="",e=t.indexOf(":");return e>=0&&(t=i.slice(0,e))!=="xmlns"&&(i=i.slice(e+1)),qc.hasOwnProperty(t)?{space:qc[t],local:i}:i}function a1(i){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===qh&&t.documentElement.namespaceURI===qh?t.createElement(i):t.createElementNS(e,i)}}function h1(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function bp(i){var t=$o(i);return(t.local?h1:a1)(t)}function l1(){}function Al(i){return i==null?l1:function(){return this.querySelector(i)}}function u1(i){typeof i!="function"&&(i=Al(i));for(var t=this._groups,e=t.length,r=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=r[n]=new Array(o),h,l,u=0;u<o;++u)(h=s[u])&&(l=i.call(h,h.__data__,u,s))&&("__data__"in h&&(l.__data__=h.__data__),a[u]=l);return new ge(r,this._parents)}function Ep(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function c1(){return[]}function Ap(i){return i==null?c1:function(){return this.querySelectorAll(i)}}function d1(i){return function(){return Ep(i.apply(this,arguments))}}function f1(i){typeof i=="function"?i=d1(i):i=Ap(i);for(var t=this._groups,e=t.length,r=[],n=[],s=0;s<e;++s)for(var o=t[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&(r.push(i.call(h,h.__data__,l,o)),n.push(h));return new ge(r,n)}function Sp(i){return function(){return this.matches(i)}}function Tp(i){return function(t){return t.matches(i)}}var p1=Array.prototype.find;function g1(i){return function(){return p1.call(this.children,i)}}function m1(){return this.firstElementChild}function y1(i){return this.select(i==null?m1:g1(typeof i=="function"?i:Tp(i)))}var v1=Array.prototype.filter;function _1(){return Array.from(this.children)}function x1(i){return function(){return v1.call(this.children,i)}}function w1(i){return this.selectAll(i==null?_1:x1(typeof i=="function"?i:Tp(i)))}function b1(i){typeof i!="function"&&(i=Sp(i));for(var t=this._groups,e=t.length,r=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=r[n]=[],h,l=0;l<o;++l)(h=s[l])&&i.call(h,h.__data__,l,s)&&a.push(h);return new ge(r,this._parents)}function Ip(i){return new Array(i.length)}function E1(){return new ge(this._enter||this._groups.map(Ip),this._parents)}function _o(i,t){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=t}_o.prototype={constructor:_o,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,t){return this._parent.insertBefore(i,t)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function A1(i){return function(){return i}}function S1(i,t,e,r,n,s){for(var o=0,a,h=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):e[o]=new _o(i,s[o]);for(;o<h;++o)(a=t[o])&&(n[o]=a)}function T1(i,t,e,r,n,s,o){var a,h,l=new Map,u=t.length,c=s.length,d=new Array(u),f;for(a=0;a<u;++a)(h=t[a])&&(d[a]=f=o.call(h,h.__data__,a,t)+"",l.has(f)?n[a]=h:l.set(f,h));for(a=0;a<c;++a)f=o.call(i,s[a],a,s)+"",(h=l.get(f))?(r[a]=h,h.__data__=s[a],l.delete(f)):e[a]=new _o(i,s[a]);for(a=0;a<u;++a)(h=t[a])&&l.get(d[a])===h&&(n[a]=h)}function I1(i){return i.__data__}function C1(i,t){if(!arguments.length)return Array.from(this,I1);var e=t?T1:S1,r=this._parents,n=this._groups;typeof i!="function"&&(i=A1(i));for(var s=n.length,o=new Array(s),a=new Array(s),h=new Array(s),l=0;l<s;++l){var u=r[l],c=n[l],d=c.length,f=M1(i.call(u,u&&u.__data__,l,r)),p=f.length,g=a[l]=new Array(p),m=o[l]=new Array(p),y=h[l]=new Array(d);e(u,c,g,m,y,f,t);for(var _=0,v=0,x,E;_<p;++_)if(x=g[_]){for(_>=v&&(v=_+1);!(E=m[v])&&++v<p;);x._next=E||null}}return o=new ge(o,r),o._enter=a,o._exit=h,o}function M1(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function P1(){return new ge(this._exit||this._groups.map(Ip),this._parents)}function R1(i,t,e){var r=this.enter(),n=this,s=this.exit();return typeof i=="function"?(r=i(r),r&&(r=r.selection())):r=r.append(i+""),t!=null&&(n=t(n),n&&(n=n.selection())),e==null?s.remove():e(s),r&&n?r.merge(n).order():n}function D1(i){for(var t=i.selection?i.selection():i,e=this._groups,r=t._groups,n=e.length,s=r.length,o=Math.min(n,s),a=new Array(n),h=0;h<o;++h)for(var l=e[h],u=r[h],c=l.length,d=a[h]=new Array(c),f,p=0;p<c;++p)(f=l[p]||u[p])&&(d[p]=f);for(;h<n;++h)a[h]=e[h];return new ge(a,this._parents)}function N1(){for(var i=this._groups,t=-1,e=i.length;++t<e;)for(var r=i[t],n=r.length-1,s=r[n],o;--n>=0;)(o=r[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function B1(i){i||(i=L1);function t(c,d){return c&&d?i(c.__data__,d.__data__):!c-!d}for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s){for(var o=e[s],a=o.length,h=n[s]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(h[u]=l);h.sort(t)}return new ge(n,this._parents).order()}function L1(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function O1(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function k1(){return Array.from(this)}function F1(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var r=i[t],n=0,s=r.length;n<s;++n){var o=r[n];if(o)return o}return null}function U1(){let i=0;for(const t of this)++i;return i}function G1(){return!this.node()}function $1(i){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,o=n.length,a;s<o;++s)(a=n[s])&&i.call(a,a.__data__,s,n);return this}function H1(i){return function(){this.removeAttribute(i)}}function z1(i){return function(){this.removeAttributeNS(i.space,i.local)}}function W1(i,t){return function(){this.setAttribute(i,t)}}function X1(i,t){return function(){this.setAttributeNS(i.space,i.local,t)}}function V1(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(i):this.setAttribute(i,e)}}function j1(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,e)}}function Y1(i,t){var e=$o(i);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((t==null?e.local?z1:H1:typeof t=="function"?e.local?j1:V1:e.local?X1:W1)(e,t))}function Cp(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function q1(i){return function(){this.style.removeProperty(i)}}function K1(i,t,e){return function(){this.style.setProperty(i,t,e)}}function Z1(i,t,e){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(i):this.style.setProperty(i,r,e)}}function Q1(i,t,e){return arguments.length>1?this.each((t==null?q1:typeof t=="function"?Z1:K1)(i,t,e??"")):Jr(this.node(),i)}function Jr(i,t){return i.style.getPropertyValue(t)||Cp(i).getComputedStyle(i,null).getPropertyValue(t)}function J1(i){return function(){delete this[i]}}function tE(i,t){return function(){this[i]=t}}function eE(i,t){return function(){var e=t.apply(this,arguments);e==null?delete this[i]:this[i]=e}}function iE(i,t){return arguments.length>1?this.each((t==null?J1:typeof t=="function"?eE:tE)(i,t)):this.node()[i]}function Mp(i){return i.trim().split(/^|\s+/)}function Sl(i){return i.classList||new Pp(i)}function Pp(i){this._node=i,this._names=Mp(i.getAttribute("class")||"")}Pp.prototype={add:function(i){var t=this._names.indexOf(i);t<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var t=this._names.indexOf(i);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function Rp(i,t){for(var e=Sl(i),r=-1,n=t.length;++r<n;)e.add(t[r])}function Dp(i,t){for(var e=Sl(i),r=-1,n=t.length;++r<n;)e.remove(t[r])}function rE(i){return function(){Rp(this,i)}}function nE(i){return function(){Dp(this,i)}}function sE(i,t){return function(){(t.apply(this,arguments)?Rp:Dp)(this,i)}}function oE(i,t){var e=Mp(i+"");if(arguments.length<2){for(var r=Sl(this.node()),n=-1,s=e.length;++n<s;)if(!r.contains(e[n]))return!1;return!0}return this.each((typeof t=="function"?sE:t?rE:nE)(e,t))}function aE(){this.textContent=""}function hE(i){return function(){this.textContent=i}}function lE(i){return function(){var t=i.apply(this,arguments);this.textContent=t??""}}function uE(i){return arguments.length?this.each(i==null?aE:(typeof i=="function"?lE:hE)(i)):this.node().textContent}function cE(){this.innerHTML=""}function dE(i){return function(){this.innerHTML=i}}function fE(i){return function(){var t=i.apply(this,arguments);this.innerHTML=t??""}}function pE(i){return arguments.length?this.each(i==null?cE:(typeof i=="function"?fE:dE)(i)):this.node().innerHTML}function gE(){this.nextSibling&&this.parentNode.appendChild(this)}function mE(){return this.each(gE)}function yE(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vE(){return this.each(yE)}function _E(i){var t=typeof i=="function"?i:bp(i);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function xE(){return null}function wE(i,t){var e=typeof i=="function"?i:bp(i),r=t==null?xE:typeof t=="function"?t:Al(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function bE(){var i=this.parentNode;i&&i.removeChild(this)}function EE(){return this.each(bE)}function AE(){var i=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function SE(){var i=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function TE(i){return this.select(i?SE:AE)}function IE(i){return arguments.length?this.property("__data__",i):this.node().__data__}function CE(i){return function(t){i.call(this,t,this.__data__)}}function ME(i){return i.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}})}function PE(i){return function(){var t=this.__on;if(t){for(var e=0,r=-1,n=t.length,s;e<n;++e)s=t[e],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function RE(i,t,e){return function(){var r=this.__on,n,s=CE(t);if(r){for(var o=0,a=r.length;o<a;++o)if((n=r[o]).type===i.type&&n.name===i.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=e),n.value=t;return}}this.addEventListener(i.type,s,e),n={type:i.type,name:i.name,value:t,listener:s,options:e},r?r.push(n):this.__on=[n]}}function DE(i,t,e){var r=ME(i+""),n,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,l=a.length,u;h<l;++h)for(n=0,u=a[h];n<s;++n)if((o=r[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?RE:PE,n=0;n<s;++n)this.each(a(r[n],t,e));return this}function Np(i,t,e){var r=Cp(i),n=r.CustomEvent;typeof n=="function"?n=new n(t,e):(n=r.document.createEvent("Event"),e?(n.initEvent(t,e.bubbles,e.cancelable),n.detail=e.detail):n.initEvent(t,!1,!1)),i.dispatchEvent(n)}function NE(i,t){return function(){return Np(this,i,t)}}function BE(i,t){return function(){return Np(this,i,t.apply(this,arguments))}}function LE(i,t){return this.each((typeof t=="function"?BE:NE)(i,t))}function*OE(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var r=i[t],n=0,s=r.length,o;n<s;++n)(o=r[n])&&(yield o)}var Tl=[null];function ge(i,t){this._groups=i,this._parents=t}function Zn(){return new ge([[document.documentElement]],Tl)}function kE(){return this}ge.prototype=Zn.prototype={constructor:ge,select:u1,selectAll:f1,selectChild:y1,selectChildren:w1,filter:b1,data:C1,enter:E1,exit:P1,join:R1,merge:D1,selection:kE,order:N1,sort:B1,call:O1,nodes:k1,node:F1,size:U1,empty:G1,each:$1,attr:Y1,style:Q1,property:iE,classed:oE,text:uE,html:pE,raise:mE,lower:vE,append:_E,insert:wE,remove:EE,clone:TE,datum:IE,on:DE,dispatch:LE,[Symbol.iterator]:OE};function Vt(i){return typeof i=="string"?new ge([[document.querySelector(i)]],[document.documentElement]):new ge([[i]],Tl)}function $a(i){return typeof i=="string"?new ge([document.querySelectorAll(i)],[document.documentElement]):new ge([Ep(i)],Tl)}function Il(i,t,e){i.prototype=t.prototype=e,e.constructor=i}function Bp(i,t){var e=Object.create(i.prototype);for(var r in t)e[r]=t[r];return e}function Qn(){}var $n=.7,xo=1/$n,jr="\\s*([+-]?\\d+)\\s*",Hn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ii="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",FE=/^#([0-9a-f]{3,8})$/,UE=new RegExp(`^rgb\\(${jr},${jr},${jr}\\)$`),GE=new RegExp(`^rgb\\(${ii},${ii},${ii}\\)$`),$E=new RegExp(`^rgba\\(${jr},${jr},${jr},${Hn}\\)$`),HE=new RegExp(`^rgba\\(${ii},${ii},${ii},${Hn}\\)$`),zE=new RegExp(`^hsl\\(${Hn},${ii},${ii}\\)$`),WE=new RegExp(`^hsla\\(${Hn},${ii},${ii},${Hn}\\)$`),Kc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Il(Qn,pr,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Zc,formatHex:Zc,formatHex8:XE,formatHsl:VE,formatRgb:Qc,toString:Qc});function Zc(){return this.rgb().formatHex()}function XE(){return this.rgb().formatHex8()}function VE(){return Lp(this).formatHsl()}function Qc(){return this.rgb().formatRgb()}function pr(i){var t,e;return i=(i+"").trim().toLowerCase(),(t=FE.exec(i))?(e=t[1].length,t=parseInt(t[1],16),e===6?Jc(t):e===3?new xe(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Ps(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Ps(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=UE.exec(i))?new xe(t[1],t[2],t[3],1):(t=GE.exec(i))?new xe(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=$E.exec(i))?Ps(t[1],t[2],t[3],t[4]):(t=HE.exec(i))?Ps(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=zE.exec(i))?id(t[1],t[2]/100,t[3]/100,1):(t=WE.exec(i))?id(t[1],t[2]/100,t[3]/100,t[4]):Kc.hasOwnProperty(i)?Jc(Kc[i]):i==="transparent"?new xe(NaN,NaN,NaN,0):null}function Jc(i){return new xe(i>>16&255,i>>8&255,i&255,1)}function Ps(i,t,e,r){return r<=0&&(i=t=e=NaN),new xe(i,t,e,r)}function jE(i){return i instanceof Qn||(i=pr(i)),i?(i=i.rgb(),new xe(i.r,i.g,i.b,i.opacity)):new xe}function Kh(i,t,e,r){return arguments.length===1?jE(i):new xe(i,t,e,r??1)}function xe(i,t,e,r){this.r=+i,this.g=+t,this.b=+e,this.opacity=+r}Il(xe,Kh,Bp(Qn,{brighter(i){return i=i==null?xo:Math.pow(xo,i),new xe(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?$n:Math.pow($n,i),new xe(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new xe(ur(this.r),ur(this.g),ur(this.b),wo(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:td,formatHex:td,formatHex8:YE,formatRgb:ed,toString:ed}));function td(){return`#${sr(this.r)}${sr(this.g)}${sr(this.b)}`}function YE(){return`#${sr(this.r)}${sr(this.g)}${sr(this.b)}${sr((isNaN(this.opacity)?1:this.opacity)*255)}`}function ed(){const i=wo(this.opacity);return`${i===1?"rgb(":"rgba("}${ur(this.r)}, ${ur(this.g)}, ${ur(this.b)}${i===1?")":`, ${i})`}`}function wo(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function ur(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function sr(i){return i=ur(i),(i<16?"0":"")+i.toString(16)}function id(i,t,e,r){return r<=0?i=t=e=NaN:e<=0||e>=1?i=t=NaN:t<=0&&(i=NaN),new Fe(i,t,e,r)}function Lp(i){if(i instanceof Fe)return new Fe(i.h,i.s,i.l,i.opacity);if(i instanceof Qn||(i=pr(i)),!i)return new Fe;if(i instanceof Fe)return i;i=i.rgb();var t=i.r/255,e=i.g/255,r=i.b/255,n=Math.min(t,e,r),s=Math.max(t,e,r),o=NaN,a=s-n,h=(s+n)/2;return a?(t===s?o=(e-r)/a+(e<r)*6:e===s?o=(r-t)/a+2:o=(t-e)/a+4,a/=h<.5?s+n:2-s-n,o*=60):a=h>0&&h<1?0:o,new Fe(o,a,h,i.opacity)}function qE(i,t,e,r){return arguments.length===1?Lp(i):new Fe(i,t,e,r??1)}function Fe(i,t,e,r){this.h=+i,this.s=+t,this.l=+e,this.opacity=+r}Il(Fe,qE,Bp(Qn,{brighter(i){return i=i==null?xo:Math.pow(xo,i),new Fe(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?$n:Math.pow($n,i),new Fe(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,t=isNaN(i)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,n=2*e-r;return new xe(Ha(i>=240?i-240:i+120,n,r),Ha(i,n,r),Ha(i<120?i+240:i-120,n,r),this.opacity)},clamp(){return new Fe(rd(this.h),Rs(this.s),Rs(this.l),wo(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=wo(this.opacity);return`${i===1?"hsl(":"hsla("}${rd(this.h)}, ${Rs(this.s)*100}%, ${Rs(this.l)*100}%${i===1?")":`, ${i})`}`}}));function rd(i){return i=(i||0)%360,i<0?i+360:i}function Rs(i){return Math.max(0,Math.min(1,i||0))}function Ha(i,t,e){return(i<60?t+(e-t)*i/60:i<180?e:i<240?t+(e-t)*(240-i)/60:t)*255}const Cl=i=>()=>i;function KE(i,t){return function(e){return i+e*t}}function ZE(i,t,e){return i=Math.pow(i,e),t=Math.pow(t,e)-i,e=1/e,function(r){return Math.pow(i+r*t,e)}}function QE(i){return(i=+i)==1?Op:function(t,e){return e-t?ZE(t,e,i):Cl(isNaN(t)?e:t)}}function Op(i,t){var e=t-i;return e?KE(i,e):Cl(isNaN(i)?t:i)}const bo=function i(t){var e=QE(t);function r(n,s){var o=e((n=Kh(n)).r,(s=Kh(s)).r),a=e(n.g,s.g),h=e(n.b,s.b),l=Op(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=h(u),n.opacity=l(u),n+""}}return r.gamma=i,r}(1);function JE(i,t){t||(t=[]);var e=i?Math.min(t.length,i.length):0,r=t.slice(),n;return function(s){for(n=0;n<e;++n)r[n]=i[n]*(1-s)+t[n]*s;return r}}function tA(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function eA(i,t){var e=t?t.length:0,r=i?Math.min(e,i.length):0,n=new Array(r),s=new Array(e),o;for(o=0;o<r;++o)n[o]=Ml(i[o],t[o]);for(;o<e;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=n[o](a);return s}}function iA(i,t){var e=new Date;return i=+i,t=+t,function(r){return e.setTime(i*(1-r)+t*r),e}}function Oe(i,t){return i=+i,t=+t,function(e){return i*(1-e)+t*e}}function rA(i,t){var e={},r={},n;(i===null||typeof i!="object")&&(i={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in i?e[n]=Ml(i[n],t[n]):r[n]=t[n];return function(s){for(n in e)r[n]=e[n](s);return r}}var Zh=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,za=new RegExp(Zh.source,"g");function nA(i){return function(){return i}}function sA(i){return function(t){return i(t)+""}}function kp(i,t){var e=Zh.lastIndex=za.lastIndex=0,r,n,s,o=-1,a=[],h=[];for(i=i+"",t=t+"";(r=Zh.exec(i))&&(n=za.exec(t));)(s=n.index)>e&&(s=t.slice(e,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,h.push({i:o,x:Oe(r,n)})),e=za.lastIndex;return e<t.length&&(s=t.slice(e),a[o]?a[o]+=s:a[++o]=s),a.length<2?h[0]?sA(h[0].x):nA(t):(t=h.length,function(l){for(var u=0,c;u<t;++u)a[(c=h[u]).i]=c.x(l);return a.join("")})}function Ml(i,t){var e=typeof t,r;return t==null||e==="boolean"?Cl(t):(e==="number"?Oe:e==="string"?(r=pr(t))?(t=r,bo):kp:t instanceof pr?bo:t instanceof Date?iA:tA(t)?JE:Array.isArray(t)?eA:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?rA:Oe)(i,t)}function oA(i,t){return i=+i,t=+t,function(e){return Math.round(i*(1-e)+t*e)}}var nd=180/Math.PI,Qh={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Fp(i,t,e,r,n,s){var o,a,h;return(o=Math.sqrt(i*i+t*t))&&(i/=o,t/=o),(h=i*e+t*r)&&(e-=i*h,r-=t*h),(a=Math.sqrt(e*e+r*r))&&(e/=a,r/=a,h/=a),i*r<t*e&&(i=-i,t=-t,h=-h,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(t,i)*nd,skewX:Math.atan(h)*nd,scaleX:o,scaleY:a}}var Ds;function aA(i){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return t.isIdentity?Qh:Fp(t.a,t.b,t.c,t.d,t.e,t.f)}function hA(i){return i==null||(Ds||(Ds=document.createElementNS("http://www.w3.org/2000/svg","g")),Ds.setAttribute("transform",i),!(i=Ds.transform.baseVal.consolidate()))?Qh:(i=i.matrix,Fp(i.a,i.b,i.c,i.d,i.e,i.f))}function Up(i,t,e,r){function n(l){return l.length?l.pop()+" ":""}function s(l,u,c,d,f,p){if(l!==c||u!==d){var g=f.push("translate(",null,t,null,e);p.push({i:g-4,x:Oe(l,c)},{i:g-2,x:Oe(u,d)})}else(c||d)&&f.push("translate("+c+t+d+e)}function o(l,u,c,d){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),d.push({i:c.push(n(c)+"rotate(",null,r)-2,x:Oe(l,u)})):u&&c.push(n(c)+"rotate("+u+r)}function a(l,u,c,d){l!==u?d.push({i:c.push(n(c)+"skewX(",null,r)-2,x:Oe(l,u)}):u&&c.push(n(c)+"skewX("+u+r)}function h(l,u,c,d,f,p){if(l!==c||u!==d){var g=f.push(n(f)+"scale(",null,",",null,")");p.push({i:g-4,x:Oe(l,c)},{i:g-2,x:Oe(u,d)})}else(c!==1||d!==1)&&f.push(n(f)+"scale("+c+","+d+")")}return function(l,u){var c=[],d=[];return l=i(l),u=i(u),s(l.translateX,l.translateY,u.translateX,u.translateY,c,d),o(l.rotate,u.rotate,c,d),a(l.skewX,u.skewX,c,d),h(l.scaleX,l.scaleY,u.scaleX,u.scaleY,c,d),l=u=null,function(f){for(var p=-1,g=d.length,m;++p<g;)c[(m=d[p]).i]=m.x(f);return c.join("")}}}var lA=Up(aA,"px, ","px)","deg)"),uA=Up(hA,", ",")",")"),tn=0,Mn=0,_n=0,Gp=1e3,Eo,Pn,Ao=0,gr=0,Ho=0,zn=typeof performance=="object"&&performance.now?performance:Date,$p=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Pl(){return gr||($p(cA),gr=zn.now()+Ho)}function cA(){gr=0}function So(){this._call=this._time=this._next=null}So.prototype=Rl.prototype={constructor:So,restart:function(i,t,e){if(typeof i!="function")throw new TypeError("callback is not a function");e=(e==null?Pl():+e)+(t==null?0:+t),!this._next&&Pn!==this&&(Pn?Pn._next=this:Eo=this,Pn=this),this._call=i,this._time=e,Jh()},stop:function(){this._call&&(this._call=null,this._time=1/0,Jh())}};function Rl(i,t,e){var r=new So;return r.restart(i,t,e),r}function dA(){Pl(),++tn;for(var i=Eo,t;i;)(t=gr-i._time)>=0&&i._call.call(void 0,t),i=i._next;--tn}function sd(){gr=(Ao=zn.now())+Ho,tn=Mn=0;try{dA()}finally{tn=0,pA(),gr=0}}function fA(){var i=zn.now(),t=i-Ao;t>Gp&&(Ho-=t,Ao=i)}function pA(){for(var i,t=Eo,e,r=1/0;t;)t._call?(r>t._time&&(r=t._time),i=t,t=t._next):(e=t._next,t._next=null,t=i?i._next=e:Eo=e);Pn=i,Jh(r)}function Jh(i){if(!tn){Mn&&(Mn=clearTimeout(Mn));var t=i-gr;t>24?(i<1/0&&(Mn=setTimeout(sd,i-zn.now()-Ho)),_n&&(_n=clearInterval(_n))):(_n||(Ao=zn.now(),_n=setInterval(fA,Gp)),tn=1,$p(sd))}}function od(i,t,e){var r=new So;return t=t==null?0:+t,r.restart(n=>{r.stop(),i(n+t)},t,e),r}var gA=El("start","end","cancel","interrupt"),mA=[],Hp=0,ad=1,tl=2,Ys=3,hd=4,el=5,qs=6;function zo(i,t,e,r,n,s){var o=i.__transition;if(!o)i.__transition={};else if(e in o)return;yA(i,e,{name:t,index:r,group:n,on:gA,tween:mA,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Hp})}function Dl(i,t){var e=He(i,t);if(e.state>Hp)throw new Error("too late; already scheduled");return e}function ai(i,t){var e=He(i,t);if(e.state>Ys)throw new Error("too late; already running");return e}function He(i,t){var e=i.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function yA(i,t,e){var r=i.__transition,n;r[t]=e,e.timer=Rl(s,0,e.time);function s(l){e.state=ad,e.timer.restart(o,e.delay,e.time),e.delay<=l&&o(l-e.delay)}function o(l){var u,c,d,f;if(e.state!==ad)return h();for(u in r)if(f=r[u],f.name===e.name){if(f.state===Ys)return od(o);f.state===hd?(f.state=qs,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete r[u]):+u<t&&(f.state=qs,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete r[u])}if(od(function(){e.state===Ys&&(e.state=hd,e.timer.restart(a,e.delay,e.time),a(l))}),e.state=tl,e.on.call("start",i,i.__data__,e.index,e.group),e.state===tl){for(e.state=Ys,n=new Array(d=e.tween.length),u=0,c=-1;u<d;++u)(f=e.tween[u].value.call(i,i.__data__,e.index,e.group))&&(n[++c]=f);n.length=c+1}}function a(l){for(var u=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(h),e.state=el,1),c=-1,d=n.length;++c<d;)n[c].call(i,u);e.state===el&&(e.on.call("end",i,i.__data__,e.index,e.group),h())}function h(){e.state=qs,e.timer.stop(),delete r[t];for(var l in r)return;delete i.__transition}}function vA(i,t){var e=i.__transition,r,n,s=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((r=e[o]).name!==t){s=!1;continue}n=r.state>tl&&r.state<el,r.state=qs,r.timer.stop(),r.on.call(n?"interrupt":"cancel",i,i.__data__,r.index,r.group),delete e[o]}s&&delete i.__transition}}function _A(i){return this.each(function(){vA(this,i)})}function xA(i,t){var e,r;return function(){var n=ai(this,i),s=n.tween;if(s!==e){r=e=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}n.tween=r}}function wA(i,t,e){var r,n;if(typeof e!="function")throw new Error;return function(){var s=ai(this,i),o=s.tween;if(o!==r){n=(r=o).slice();for(var a={name:t,value:e},h=0,l=n.length;h<l;++h)if(n[h].name===t){n[h]=a;break}h===l&&n.push(a)}s.tween=n}}function bA(i,t){var e=this._id;if(i+="",arguments.length<2){for(var r=He(this.node(),e).tween,n=0,s=r.length,o;n<s;++n)if((o=r[n]).name===i)return o.value;return null}return this.each((t==null?xA:wA)(e,i,t))}function Nl(i,t,e){var r=i._id;return i.each(function(){var n=ai(this,r);(n.value||(n.value={}))[t]=e.apply(this,arguments)}),function(n){return He(n,r).value[t]}}function zp(i,t){var e;return(typeof t=="number"?Oe:t instanceof pr?bo:(e=pr(t))?(t=e,bo):kp)(i,t)}function EA(i){return function(){this.removeAttribute(i)}}function AA(i){return function(){this.removeAttributeNS(i.space,i.local)}}function SA(i,t,e){var r,n=e+"",s;return function(){var o=this.getAttribute(i);return o===n?null:o===r?s:s=t(r=o,e)}}function TA(i,t,e){var r,n=e+"",s;return function(){var o=this.getAttributeNS(i.space,i.local);return o===n?null:o===r?s:s=t(r=o,e)}}function IA(i,t,e){var r,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(i):(o=this.getAttribute(i),h=a+"",o===h?null:o===r&&h===n?s:(n=h,s=t(r=o,a)))}}function CA(i,t,e){var r,n,s;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(i.space,i.local):(o=this.getAttributeNS(i.space,i.local),h=a+"",o===h?null:o===r&&h===n?s:(n=h,s=t(r=o,a)))}}function MA(i,t){var e=$o(i),r=e==="transform"?uA:zp;return this.attrTween(i,typeof t=="function"?(e.local?CA:IA)(e,r,Nl(this,"attr."+i,t)):t==null?(e.local?AA:EA)(e):(e.local?TA:SA)(e,r,t))}function PA(i,t){return function(e){this.setAttribute(i,t.call(this,e))}}function RA(i,t){return function(e){this.setAttributeNS(i.space,i.local,t.call(this,e))}}function DA(i,t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&RA(i,s)),e}return n._value=t,n}function NA(i,t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&PA(i,s)),e}return n._value=t,n}function BA(i,t){var e="attr."+i;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var r=$o(i);return this.tween(e,(r.local?DA:NA)(r,t))}function LA(i,t){return function(){Dl(this,i).delay=+t.apply(this,arguments)}}function OA(i,t){return t=+t,function(){Dl(this,i).delay=t}}function kA(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?LA:OA)(t,i)):He(this.node(),t).delay}function FA(i,t){return function(){ai(this,i).duration=+t.apply(this,arguments)}}function UA(i,t){return t=+t,function(){ai(this,i).duration=t}}function GA(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?FA:UA)(t,i)):He(this.node(),t).duration}function $A(i,t){if(typeof t!="function")throw new Error;return function(){ai(this,i).ease=t}}function HA(i){var t=this._id;return arguments.length?this.each($A(t,i)):He(this.node(),t).ease}function zA(i,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;ai(this,i).ease=e}}function WA(i){if(typeof i!="function")throw new Error;return this.each(zA(this._id,i))}function XA(i){typeof i!="function"&&(i=Sp(i));for(var t=this._groups,e=t.length,r=new Array(e),n=0;n<e;++n)for(var s=t[n],o=s.length,a=r[n]=[],h,l=0;l<o;++l)(h=s[l])&&i.call(h,h.__data__,l,s)&&a.push(h);return new Ti(r,this._parents,this._name,this._id)}function VA(i){if(i._id!==this._id)throw new Error;for(var t=this._groups,e=i._groups,r=t.length,n=e.length,s=Math.min(r,n),o=new Array(r),a=0;a<s;++a)for(var h=t[a],l=e[a],u=h.length,c=o[a]=new Array(u),d,f=0;f<u;++f)(d=h[f]||l[f])&&(c[f]=d);for(;a<r;++a)o[a]=t[a];return new Ti(o,this._parents,this._name,this._id)}function jA(i){return(i+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function YA(i,t,e){var r,n,s=jA(t)?Dl:ai;return function(){var o=s(this,i),a=o.on;a!==r&&(n=(r=a).copy()).on(t,e),o.on=n}}function qA(i,t){var e=this._id;return arguments.length<2?He(this.node(),e).on.on(i):this.each(YA(e,i,t))}function KA(i){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==i)return;t&&t.removeChild(this)}}function ZA(){return this.on("end.remove",KA(this._id))}function QA(i){var t=this._name,e=this._id;typeof i!="function"&&(i=Al(i));for(var r=this._groups,n=r.length,s=new Array(n),o=0;o<n;++o)for(var a=r[o],h=a.length,l=s[o]=new Array(h),u,c,d=0;d<h;++d)(u=a[d])&&(c=i.call(u,u.__data__,d,a))&&("__data__"in u&&(c.__data__=u.__data__),l[d]=c,zo(l[d],t,e,d,l,He(u,e)));return new Ti(s,this._parents,t,e)}function JA(i){var t=this._name,e=this._id;typeof i!="function"&&(i=Ap(i));for(var r=this._groups,n=r.length,s=[],o=[],a=0;a<n;++a)for(var h=r[a],l=h.length,u,c=0;c<l;++c)if(u=h[c]){for(var d=i.call(u,u.__data__,c,h),f,p=He(u,e),g=0,m=d.length;g<m;++g)(f=d[g])&&zo(f,t,e,g,d,p);s.push(d),o.push(u)}return new Ti(s,o,t,e)}var tS=Zn.prototype.constructor;function eS(){return new tS(this._groups,this._parents)}function iS(i,t){var e,r,n;return function(){var s=Jr(this,i),o=(this.style.removeProperty(i),Jr(this,i));return s===o?null:s===e&&o===r?n:n=t(e=s,r=o)}}function Wp(i){return function(){this.style.removeProperty(i)}}function rS(i,t,e){var r,n=e+"",s;return function(){var o=Jr(this,i);return o===n?null:o===r?s:s=t(r=o,e)}}function nS(i,t,e){var r,n,s;return function(){var o=Jr(this,i),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(i),Jr(this,i))),o===h?null:o===r&&h===n?s:(n=h,s=t(r=o,a))}}function sS(i,t){var e,r,n,s="style."+t,o="end."+s,a;return function(){var h=ai(this,i),l=h.on,u=h.value[s]==null?a||(a=Wp(t)):void 0;(l!==e||n!==u)&&(r=(e=l).copy()).on(o,n=u),h.on=r}}function oS(i,t,e){var r=(i+="")=="transform"?lA:zp;return t==null?this.styleTween(i,iS(i,r)).on("end.style."+i,Wp(i)):typeof t=="function"?this.styleTween(i,nS(i,r,Nl(this,"style."+i,t))).each(sS(this._id,i)):this.styleTween(i,rS(i,r,t),e).on("end.style."+i,null)}function aS(i,t,e){return function(r){this.style.setProperty(i,t.call(this,r),e)}}function hS(i,t,e){var r,n;function s(){var o=t.apply(this,arguments);return o!==n&&(r=(n=o)&&aS(i,o,e)),r}return s._value=t,s}function lS(i,t,e){var r="style."+(i+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,hS(i,t,e??""))}function uS(i){return function(){this.textContent=i}}function cS(i){return function(){var t=i(this);this.textContent=t??""}}function dS(i){return this.tween("text",typeof i=="function"?cS(Nl(this,"text",i)):uS(i==null?"":i+""))}function fS(i){return function(t){this.textContent=i.call(this,t)}}function pS(i){var t,e;function r(){var n=i.apply(this,arguments);return n!==e&&(t=(e=n)&&fS(n)),t}return r._value=i,r}function gS(i){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(i==null)return this.tween(t,null);if(typeof i!="function")throw new Error;return this.tween(t,pS(i))}function mS(){for(var i=this._name,t=this._id,e=Xp(),r=this._groups,n=r.length,s=0;s<n;++s)for(var o=r[s],a=o.length,h,l=0;l<a;++l)if(h=o[l]){var u=He(h,t);zo(h,i,e,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Ti(r,this._parents,i,e)}function yS(){var i,t,e=this,r=e._id,n=e.size();return new Promise(function(s,o){var a={value:o},h={value:function(){--n===0&&s()}};e.each(function(){var l=ai(this,r),u=l.on;u!==i&&(t=(i=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),l.on=t}),n===0&&s()})}var vS=0;function Ti(i,t,e,r){this._groups=i,this._parents=t,this._name=e,this._id=r}function Xp(){return++vS}var fi=Zn.prototype;Ti.prototype={constructor:Ti,select:QA,selectAll:JA,selectChild:fi.selectChild,selectChildren:fi.selectChildren,filter:XA,merge:VA,selection:eS,transition:mS,call:fi.call,nodes:fi.nodes,node:fi.node,size:fi.size,empty:fi.empty,each:fi.each,on:qA,attr:MA,attrTween:BA,style:oS,styleTween:lS,text:dS,textTween:gS,remove:ZA,tween:bA,delay:kA,duration:GA,ease:HA,easeVarying:WA,end:yS,[Symbol.iterator]:fi[Symbol.iterator]};function _S(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var xS={time:null,delay:0,duration:250,ease:_S};function wS(i,t){for(var e;!(e=i.__transition)||!(e=e[t]);)if(!(i=i.parentNode))throw new Error(`transition ${t} not found`);return e}function bS(i){var t,e;i instanceof Ti?(t=i._id,i=i._name):(t=Xp(),(e=xS).time=Pl(),i=i==null?null:i+"");for(var r=this._groups,n=r.length,s=0;s<n;++s)for(var o=r[s],a=o.length,h,l=0;l<a;++l)(h=o[l])&&zo(h,i,t,l,o,e||wS(h,t));return new Ti(r,this._parents,i,t)}Zn.prototype.interrupt=_A;Zn.prototype.transition=bS;function ES(i){const t=+this._x.call(null,i),e=+this._y.call(null,i);return Vp(this.cover(t,e),t,e,i)}function Vp(i,t,e,r){if(isNaN(t)||isNaN(e))return i;var n,s=i._root,o={data:r},a=i._x0,h=i._y0,l=i._x1,u=i._y1,c,d,f,p,g,m,y,_;if(!s)return i._root=o,i;for(;s.length;)if((g=t>=(c=(a+l)/2))?a=c:l=c,(m=e>=(d=(h+u)/2))?h=d:u=d,n=s,!(s=s[y=m<<1|g]))return n[y]=o,i;if(f=+i._x.call(null,s.data),p=+i._y.call(null,s.data),t===f&&e===p)return o.next=s,n?n[y]=o:i._root=o,i;do n=n?n[y]=new Array(4):i._root=new Array(4),(g=t>=(c=(a+l)/2))?a=c:l=c,(m=e>=(d=(h+u)/2))?h=d:u=d;while((y=m<<1|g)===(_=(p>=d)<<1|f>=c));return n[_]=s,n[y]=o,i}function AS(i){var t,e,r=i.length,n,s,o=new Array(r),a=new Array(r),h=1/0,l=1/0,u=-1/0,c=-1/0;for(e=0;e<r;++e)isNaN(n=+this._x.call(null,t=i[e]))||isNaN(s=+this._y.call(null,t))||(o[e]=n,a[e]=s,n<h&&(h=n),n>u&&(u=n),s<l&&(l=s),s>c&&(c=s));if(h>u||l>c)return this;for(this.cover(h,l).cover(u,c),e=0;e<r;++e)Vp(this,o[e],a[e],i[e]);return this}function SS(i,t){if(isNaN(i=+i)||isNaN(t=+t))return this;var e=this._x0,r=this._y0,n=this._x1,s=this._y1;if(isNaN(e))n=(e=Math.floor(i))+1,s=(r=Math.floor(t))+1;else{for(var o=n-e||1,a=this._root,h,l;e>i||i>=n||r>t||t>=s;)switch(l=(t<r)<<1|i<e,h=new Array(4),h[l]=a,a=h,o*=2,l){case 0:n=e+o,s=r+o;break;case 1:e=n-o,s=r+o;break;case 2:n=e+o,r=s-o;break;case 3:e=n-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=e,this._y0=r,this._x1=n,this._y1=s,this}function TS(){var i=[];return this.visit(function(t){if(!t.length)do i.push(t.data);while(t=t.next)}),i}function IS(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function de(i,t,e,r,n){this.node=i,this.x0=t,this.y0=e,this.x1=r,this.y1=n}function CS(i,t,e){var r,n=this._x0,s=this._y0,o,a,h,l,u=this._x1,c=this._y1,d=[],f=this._root,p,g;for(f&&d.push(new de(f,n,s,u,c)),e==null?e=1/0:(n=i-e,s=t-e,u=i+e,c=t+e,e*=e);p=d.pop();)if(!(!(f=p.node)||(o=p.x0)>u||(a=p.y0)>c||(h=p.x1)<n||(l=p.y1)<s))if(f.length){var m=(o+h)/2,y=(a+l)/2;d.push(new de(f[3],m,y,h,l),new de(f[2],o,y,m,l),new de(f[1],m,a,h,y),new de(f[0],o,a,m,y)),(g=(t>=y)<<1|i>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var _=i-+this._x.call(null,f.data),v=t-+this._y.call(null,f.data),x=_*_+v*v;if(x<e){var E=Math.sqrt(e=x);n=i-E,s=t-E,u=i+E,c=t+E,r=f.data}}return r}function MS(i){if(isNaN(u=+this._x.call(null,i))||isNaN(c=+this._y.call(null,i)))return this;var t,e=this._root,r,n,s,o=this._x0,a=this._y0,h=this._x1,l=this._y1,u,c,d,f,p,g,m,y;if(!e)return this;if(e.length)for(;;){if((p=u>=(d=(o+h)/2))?o=d:h=d,(g=c>=(f=(a+l)/2))?a=f:l=f,t=e,!(e=e[m=g<<1|p]))return this;if(!e.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(r=t,y=m)}for(;e.data!==i;)if(n=e,!(e=e.next))return this;return(s=e.next)&&delete e.next,n?(s?n.next=s:delete n.next,this):t?(s?t[m]=s:delete t[m],(e=t[0]||t[1]||t[2]||t[3])&&e===(t[3]||t[2]||t[1]||t[0])&&!e.length&&(r?r[y]=e:this._root=e),this):(this._root=s,this)}function PS(i){for(var t=0,e=i.length;t<e;++t)this.remove(i[t]);return this}function RS(){return this._root}function DS(){var i=0;return this.visit(function(t){if(!t.length)do++i;while(t=t.next)}),i}function NS(i){var t=[],e,r=this._root,n,s,o,a,h;for(r&&t.push(new de(r,this._x0,this._y0,this._x1,this._y1));e=t.pop();)if(!i(r=e.node,s=e.x0,o=e.y0,a=e.x1,h=e.y1)&&r.length){var l=(s+a)/2,u=(o+h)/2;(n=r[3])&&t.push(new de(n,l,u,a,h)),(n=r[2])&&t.push(new de(n,s,u,l,h)),(n=r[1])&&t.push(new de(n,l,o,a,u)),(n=r[0])&&t.push(new de(n,s,o,l,u))}return this}function BS(i){var t=[],e=[],r;for(this._root&&t.push(new de(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var n=r.node;if(n.length){var s,o=r.x0,a=r.y0,h=r.x1,l=r.y1,u=(o+h)/2,c=(a+l)/2;(s=n[0])&&t.push(new de(s,o,a,u,c)),(s=n[1])&&t.push(new de(s,u,a,h,c)),(s=n[2])&&t.push(new de(s,o,c,u,l)),(s=n[3])&&t.push(new de(s,u,c,h,l))}e.push(r)}for(;r=e.pop();)i(r.node,r.x0,r.y0,r.x1,r.y1);return this}function LS(i){return i[0]}function OS(i){return arguments.length?(this._x=i,this):this._x}function kS(i){return i[1]}function FS(i){return arguments.length?(this._y=i,this):this._y}function Bl(i,t,e){var r=new Ll(t??LS,e??kS,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function Ll(i,t,e,r,n,s){this._x=i,this._y=t,this._x0=e,this._y0=r,this._x1=n,this._y1=s,this._root=void 0}function ld(i){for(var t={data:i.data},e=t;i=i.next;)e=e.next={data:i.data};return t}var me=Bl.prototype=Ll.prototype;me.copy=function(){var i=new Ll(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,e,r;if(!t)return i;if(!t.length)return i._root=ld(t),i;for(e=[{source:t,target:i._root=new Array(4)}];t=e.pop();)for(var n=0;n<4;++n)(r=t.source[n])&&(r.length?e.push({source:r,target:t.target[n]=new Array(4)}):t.target[n]=ld(r));return i};me.add=ES;me.addAll=AS;me.cover=SS;me.data=TS;me.extent=IS;me.find=CS;me.remove=MS;me.removeAll=PS;me.root=RS;me.size=DS;me.visit=NS;me.visitAfter=BS;me.x=OS;me.y=FS;function pe(i){return function(){return i}}function Fi(i){return(i()-.5)*1e-6}function US(i){return i.x+i.vx}function GS(i){return i.y+i.vy}function $S(i){var t,e,r,n=1,s=1;typeof i!="function"&&(i=pe(i==null?1:+i));function o(){for(var l,u=t.length,c,d,f,p,g,m,y=0;y<s;++y)for(c=Bl(t,US,GS).visitAfter(a),l=0;l<u;++l)d=t[l],g=e[d.index],m=g*g,f=d.x+d.vx,p=d.y+d.vy,c.visit(_);function _(v,x,E,N,I){var S=v.data,D=v.r,U=g+D;if(S){if(S.index>d.index){var L=f-S.x-S.vx,C=p-S.y-S.vy,b=L*L+C*C;b<U*U&&(L===0&&(L=Fi(r),b+=L*L),C===0&&(C=Fi(r),b+=C*C),b=(U-(b=Math.sqrt(b)))/b*n,d.vx+=(L*=b)*(U=(D*=D)/(m+D)),d.vy+=(C*=b)*U,S.vx-=L*(U=1-U),S.vy-=C*U)}return}return x>f+U||N<f-U||E>p+U||I<p-U}}function a(l){if(l.data)return l.r=e[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function h(){if(t){var l,u=t.length,c;for(e=new Array(u),l=0;l<u;++l)c=t[l],e[c.index]=+i(c,l,t)}}return o.initialize=function(l,u){t=l,r=u,h()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(n=+l,o):n},o.radius=function(l){return arguments.length?(i=typeof l=="function"?l:pe(+l),h(),o):i},o}function HS(i){return i.index}function ud(i,t){var e=i.get(t);if(!e)throw new Error("node not found: "+t);return e}function zS(i){var t=HS,e=c,r,n=pe(30),s,o,a,h,l,u=1;i==null&&(i=[]);function c(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,_=i.length;y<u;++y)for(var v=0,x,E,N,I,S,D,U;v<_;++v)x=i[v],E=x.source,N=x.target,I=N.x+N.vx-E.x-E.vx||Fi(l),S=N.y+N.vy-E.y-E.vy||Fi(l),D=Math.sqrt(I*I+S*S),D=(D-s[v])/D*m*r[v],I*=D,S*=D,N.vx-=I*(U=h[v]),N.vy-=S*U,E.vx+=I*(U=1-U),E.vy+=S*U}function f(){if(o){var m,y=o.length,_=i.length,v=new Map(o.map((E,N)=>[t(E,N,o),E])),x;for(m=0,a=new Array(y);m<_;++m)x=i[m],x.index=m,typeof x.source!="object"&&(x.source=ud(v,x.source)),typeof x.target!="object"&&(x.target=ud(v,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(m=0,h=new Array(_);m<_;++m)x=i[m],h[m]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);r=new Array(_),p(),s=new Array(_),g()}}function p(){if(o)for(var m=0,y=i.length;m<y;++m)r[m]=+e(i[m],m,i)}function g(){if(o)for(var m=0,y=i.length;m<y;++m)s[m]=+n(i[m],m,i)}return d.initialize=function(m,y){o=m,l=y,f()},d.links=function(m){return arguments.length?(i=m,f(),d):i},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(u=+m,d):u},d.strength=function(m){return arguments.length?(e=typeof m=="function"?m:pe(+m),p(),d):e},d.distance=function(m){return arguments.length?(n=typeof m=="function"?m:pe(+m),g(),d):n},d}const WS=1664525,XS=1013904223,cd=4294967296;function VS(){let i=1;return()=>(i=(WS*i+XS)%cd)/cd}function jS(i){return i.x}function YS(i){return i.y}var qS=10,KS=Math.PI*(3-Math.sqrt(5));function ZS(i){var t,e=1,r=.001,n=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,h=Rl(c),l=El("tick","end"),u=VS();i==null&&(i=[]);function c(){d(),l.call("tick",t),e<r&&(h.stop(),l.call("end",t))}function d(g){var m,y=i.length,_;g===void 0&&(g=1);for(var v=0;v<g;++v)for(e+=(s-e)*n,a.forEach(function(x){x(e)}),m=0;m<y;++m)_=i[m],_.fx==null?_.x+=_.vx*=o:(_.x=_.fx,_.vx=0),_.fy==null?_.y+=_.vy*=o:(_.y=_.fy,_.vy=0);return t}function f(){for(var g=0,m=i.length,y;g<m;++g){if(y=i[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var _=qS*Math.sqrt(.5+g),v=g*KS;y.x=_*Math.cos(v),y.y=_*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(i,u),g}return f(),t={tick:d,restart:function(){return h.restart(c),t},stop:function(){return h.stop(),t},nodes:function(g){return arguments.length?(i=g,f(),a.forEach(p),t):i},alpha:function(g){return arguments.length?(e=+g,t):e},alphaMin:function(g){return arguments.length?(r=+g,t):r},alphaDecay:function(g){return arguments.length?(n=+g,t):+n},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(o=1-g,t):1-o},randomSource:function(g){return arguments.length?(u=g,a.forEach(p),t):u},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),t):a.get(g)},find:function(g,m,y){var _=0,v=i.length,x,E,N,I,S;for(y==null?y=1/0:y*=y,_=0;_<v;++_)I=i[_],x=g-I.x,E=m-I.y,N=x*x+E*E,N<y&&(S=I,y=N);return S},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function dd(){var i,t,e,r,n=pe(-30),s,o=1,a=1/0,h=.81;function l(f){var p,g=i.length,m=Bl(i,jS,YS).visitAfter(c);for(r=f,p=0;p<g;++p)t=i[p],m.visit(d)}function u(){if(i){var f,p=i.length,g;for(s=new Array(p),f=0;f<p;++f)g=i[f],s[g.index]=+n(g,f,i)}}function c(f){var p=0,g,m,y=0,_,v,x;if(f.length){for(_=v=x=0;x<4;++x)(g=f[x])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,_+=m*g.x,v+=m*g.y);f.x=_/y,f.y=v/y}else{g=f,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}f.value=p}function d(f,p,g,m){if(!f.value)return!0;var y=f.x-t.x,_=f.y-t.y,v=m-p,x=y*y+_*_;if(v*v/h<x)return x<a&&(y===0&&(y=Fi(e),x+=y*y),_===0&&(_=Fi(e),x+=_*_),x<o&&(x=Math.sqrt(o*x)),t.vx+=y*f.value*r/x,t.vy+=_*f.value*r/x),!0;if(f.length||x>=a)return;(f.data!==t||f.next)&&(y===0&&(y=Fi(e),x+=y*y),_===0&&(_=Fi(e),x+=_*_),x<o&&(x=Math.sqrt(o*x)));do f.data!==t&&(v=s[f.data.index]*r/x,t.vx+=y*v,t.vy+=_*v);while(f=f.next)}return l.initialize=function(f,p){i=f,e=p,u()},l.strength=function(f){return arguments.length?(n=typeof f=="function"?f:pe(+f),u(),l):n},l.distanceMin=function(f){return arguments.length?(o=f*f,l):Math.sqrt(o)},l.distanceMax=function(f){return arguments.length?(a=f*f,l):Math.sqrt(a)},l.theta=function(f){return arguments.length?(h=f*f,l):Math.sqrt(h)},l}function QS(i){var t=pe(.1),e,r,n;typeof i!="function"&&(i=pe(i==null?0:+i));function s(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vx+=(n[h]-u.x)*r[h]*a}function o(){if(e){var a,h=e.length;for(r=new Array(h),n=new Array(h),a=0;a<h;++a)r[a]=isNaN(n[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return s.initialize=function(a){e=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:pe(+a),o(),s):t},s.x=function(a){return arguments.length?(i=typeof a=="function"?a:pe(+a),o(),s):i},s}function JS(i){var t=pe(.1),e,r,n;typeof i!="function"&&(i=pe(i==null?0:+i));function s(a){for(var h=0,l=e.length,u;h<l;++h)u=e[h],u.vy+=(n[h]-u.y)*r[h]*a}function o(){if(e){var a,h=e.length;for(r=new Array(h),n=new Array(h),a=0;a<h;++a)r[a]=isNaN(n[a]=+i(e[a],a,e))?0:+t(e[a],a,e)}}return s.initialize=function(a){e=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:pe(+a),o(),s):t},s.y=function(a){return arguments.length?(i=typeof a=="function"?a:pe(+a),o(),s):i},s}function tT(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function To(i,t){if((e=(i=t?i.toExponential(t-1):i.toExponential()).indexOf("e"))<0)return null;var e,r=i.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+i.slice(e+1)]}function en(i){return i=To(Math.abs(i)),i?i[1]:NaN}function eT(i,t){return function(e,r){for(var n=e.length,s=[],o=0,a=i[0],h=0;n>0&&a>0&&(h+a+1>r&&(a=Math.max(1,r-h)),s.push(e.substring(n-=a,n+a)),!((h+=a+1)>r));)a=i[o=(o+1)%i.length];return s.reverse().join(t)}}function iT(i){return function(t){return t.replace(/[0-9]/g,function(e){return i[+e]})}}var rT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Io(i){if(!(t=rT.exec(i)))throw new Error("invalid format: "+i);var t;return new Ol({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Io.prototype=Ol.prototype;function Ol(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Ol.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function nT(i){t:for(var t=i.length,e=1,r=-1,n;e<t;++e)switch(i[e]){case".":r=n=e;break;case"0":r===0&&(r=e),n=e;break;default:if(!+i[e])break t;r>0&&(r=0);break}return r>0?i.slice(0,r)+i.slice(n+1):i}var jp;function sT(i,t){var e=To(i,t);if(!e)return i+"";var r=e[0],n=e[1],s=n-(jp=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+To(i,Math.max(0,t+s-1))[0]}function fd(i,t){var e=To(i,t);if(!e)return i+"";var r=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+new Array(n-r.length+2).join("0")}const pd={"%":(i,t)=>(i*100).toFixed(t),b:i=>Math.round(i).toString(2),c:i=>i+"",d:tT,e:(i,t)=>i.toExponential(t),f:(i,t)=>i.toFixed(t),g:(i,t)=>i.toPrecision(t),o:i=>Math.round(i).toString(8),p:(i,t)=>fd(i*100,t),r:fd,s:sT,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function gd(i){return i}var md=Array.prototype.map,yd=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function oT(i){var t=i.grouping===void 0||i.thousands===void 0?gd:eT(md.call(i.grouping,Number),i.thousands+""),e=i.currency===void 0?"":i.currency[0]+"",r=i.currency===void 0?"":i.currency[1]+"",n=i.decimal===void 0?".":i.decimal+"",s=i.numerals===void 0?gd:iT(md.call(i.numerals,String)),o=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"":i.minus+"",h=i.nan===void 0?"NaN":i.nan+"";function l(c){c=Io(c);var d=c.fill,f=c.align,p=c.sign,g=c.symbol,m=c.zero,y=c.width,_=c.comma,v=c.precision,x=c.trim,E=c.type;E==="n"?(_=!0,E="g"):pd[E]||(v===void 0&&(v=12),x=!0,E="g"),(m||d==="0"&&f==="=")&&(m=!0,d="0",f="=");var N=g==="$"?e:g==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",I=g==="$"?r:/[%p]/.test(E)?o:"",S=pd[E],D=/[defgprs%]/.test(E);v=v===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function U(L){var C=N,b=I,R,tt,et;if(E==="c")b=S(L)+b,L="";else{L=+L;var Z=L<0||1/L<0;if(L=isNaN(L)?h:S(Math.abs(L),v),x&&(L=nT(L)),Z&&+L==0&&p!=="+"&&(Z=!1),C=(Z?p==="("?p:a:p==="-"||p==="("?"":p)+C,b=(E==="s"?yd[8+jp/3]:"")+b+(Z&&p==="("?")":""),D){for(R=-1,tt=L.length;++R<tt;)if(et=L.charCodeAt(R),48>et||et>57){b=(et===46?n+L.slice(R+1):L.slice(R))+b,L=L.slice(0,R);break}}}_&&!m&&(L=t(L,1/0));var at=C.length+L.length+b.length,gt=at<y?new Array(y-at+1).join(d):"";switch(_&&m&&(L=t(gt+L,gt.length?y-b.length:1/0),gt=""),f){case"<":L=C+L+b+gt;break;case"=":L=C+gt+L+b;break;case"^":L=gt.slice(0,at=gt.length>>1)+C+L+b+gt.slice(at);break;default:L=gt+C+L+b;break}return s(L)}return U.toString=function(){return c+""},U}function u(c,d){var f=l((c=Io(c),c.type="f",c)),p=Math.max(-8,Math.min(8,Math.floor(en(d)/3)))*3,g=Math.pow(10,-p),m=yd[8+p/3];return function(y){return f(g*y)+m}}return{format:l,formatPrefix:u}}var Ns,Yp,qp;aT({thousands:",",grouping:[3],currency:["$",""]});function aT(i){return Ns=oT(i),Yp=Ns.format,qp=Ns.formatPrefix,Ns}function hT(i){return Math.max(0,-en(Math.abs(i)))}function lT(i,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(en(t)/3)))*3-en(Math.abs(i)))}function uT(i,t){return i=Math.abs(i),t=Math.abs(t)-i,Math.max(0,en(t)-en(i))+1}function cT(i){var t=0,e=i.children,r=e&&e.length;if(!r)t=1;else for(;--r>=0;)t+=e[r].value;i.value=t}function dT(){return this.eachAfter(cT)}function fT(i,t){let e=-1;for(const r of this)i.call(t,r,++e,this);return this}function pT(i,t){for(var e=this,r=[e],n,s,o=-1;e=r.pop();)if(i.call(t,e,++o,this),n=e.children)for(s=n.length-1;s>=0;--s)r.push(n[s]);return this}function gT(i,t){for(var e=this,r=[e],n=[],s,o,a,h=-1;e=r.pop();)if(n.push(e),s=e.children)for(o=0,a=s.length;o<a;++o)r.push(s[o]);for(;e=n.pop();)i.call(t,e,++h,this);return this}function mT(i,t){let e=-1;for(const r of this)if(i.call(t,r,++e,this))return r}function yT(i){return this.eachAfter(function(t){for(var e=+i(t.data)||0,r=t.children,n=r&&r.length;--n>=0;)e+=r[n].value;t.value=e})}function vT(i){return this.eachBefore(function(t){t.children&&t.children.sort(i)})}function _T(i){for(var t=this,e=xT(t,i),r=[t];t!==e;)t=t.parent,r.push(t);for(var n=r.length;i!==e;)r.splice(n,0,i),i=i.parent;return r}function xT(i,t){if(i===t)return i;var e=i.ancestors(),r=t.ancestors(),n=null;for(i=e.pop(),t=r.pop();i===t;)n=i,i=e.pop(),t=r.pop();return n}function wT(){for(var i=this,t=[i];i=i.parent;)t.push(i);return t}function bT(){return Array.from(this)}function ET(){var i=[];return this.eachBefore(function(t){t.children||i.push(t)}),i}function AT(){var i=this,t=[];return i.each(function(e){e!==i&&t.push({source:e.parent,target:e})}),t}function*ST(){var i=this,t,e=[i],r,n,s;do for(t=e.reverse(),e=[];i=t.pop();)if(yield i,r=i.children)for(n=0,s=r.length;n<s;++n)e.push(r[n]);while(e.length)}function Kp(i,t){i instanceof Map?(i=[void 0,i],t===void 0&&(t=CT)):t===void 0&&(t=IT);for(var e=new Wn(i),r,n=[e],s,o,a,h;r=n.pop();)if((o=t(r.data))&&(h=(o=Array.from(o)).length))for(r.children=o,a=h-1;a>=0;--a)n.push(s=o[a]=new Wn(o[a])),s.parent=r,s.depth=r.depth+1;return e.eachBefore(Zp)}function TT(){return Kp(this).eachBefore(MT)}function IT(i){return i.children}function CT(i){return Array.isArray(i)?i[1]:null}function MT(i){i.data.value!==void 0&&(i.value=i.data.value),i.data=i.data.data}function Zp(i){var t=0;do i.height=t;while((i=i.parent)&&i.height<++t)}function Wn(i){this.data=i,this.depth=this.height=0,this.parent=null}Wn.prototype=Kp.prototype={constructor:Wn,count:dT,each:fT,eachAfter:gT,eachBefore:pT,find:mT,sum:yT,sort:vT,path:_T,ancestors:wT,descendants:bT,leaves:ET,links:AT,copy:TT,[Symbol.iterator]:ST};function Wa(i){return i==null?null:PT(i)}function PT(i){if(typeof i!="function")throw new Error;return i}var RT={depth:-1},vd={},Xa={};function DT(i){return i.id}function NT(i){return i.parentId}function BT(){var i=DT,t=NT,e;function r(n){var s=Array.from(n),o=i,a=t,h,l,u,c,d,f,p,g,m=new Map;if(e!=null){const y=s.map((x,E)=>LT(e(x,E,n))),_=y.map(_d),v=new Set(y).add("");for(const x of _)v.has(x)||(v.add(x),y.push(x),_.push(_d(x)),s.push(Xa));o=(x,E)=>y[E],a=(x,E)=>_[E]}for(u=0,h=s.length;u<h;++u)l=s[u],f=s[u]=new Wn(l),(p=o(l,u,n))!=null&&(p+="")&&(g=f.id=p,m.set(g,m.has(g)?vd:f)),(p=a(l,u,n))!=null&&(p+="")&&(f.parent=p);for(u=0;u<h;++u)if(f=s[u],p=f.parent){if(d=m.get(p),!d)throw new Error("missing: "+p);if(d===vd)throw new Error("ambiguous: "+p);d.children?d.children.push(f):d.children=[f],f.parent=d}else{if(c)throw new Error("multiple roots");c=f}if(!c)throw new Error("no root");if(e!=null){for(;c.data===Xa&&c.children.length===1;)c=c.children[0],--h;for(let y=s.length-1;y>=0&&(f=s[y],f.data===Xa);--y)f.data=null}if(c.parent=RT,c.eachBefore(function(y){y.depth=y.parent.depth+1,--h}).eachBefore(Zp),c.parent=null,h>0)throw new Error("cycle");return c}return r.id=function(n){return arguments.length?(i=Wa(n),r):i},r.parentId=function(n){return arguments.length?(t=Wa(n),r):t},r.path=function(n){return arguments.length?(e=Wa(n),r):e},r}function LT(i){i=`${i}`;let t=i.length;return il(i,t-1)&&!il(i,t-2)&&(i=i.slice(0,-1)),i[0]==="/"?i:`/${i}`}function _d(i){let t=i.length;if(t<2)return"";for(;--t>1&&!il(i,t););return i.slice(0,t)}function il(i,t){if(i[t]==="/"){let e=0;for(;t>0&&i[--t]==="\\";)++e;if(!(e&1))return!0}return!1}function Qp(i,t){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(t).domain(i);break}return this}const xd=Symbol("implicit");function Jp(){var i=new Vh,t=[],e=[],r=xd;function n(s){let o=i.get(s);if(o===void 0){if(r!==xd)return r;i.set(s,o=t.push(s)-1)}return e[o%e.length]}return n.domain=function(s){if(!arguments.length)return t.slice();t=[],i=new Vh;for(const o of s)i.has(o)||i.set(o,t.push(o)-1);return n},n.range=function(s){return arguments.length?(e=Array.from(s),n):e.slice()},n.unknown=function(s){return arguments.length?(r=s,n):r},n.copy=function(){return Jp(t,e).unknown(r)},Qp.apply(n,arguments),n}function OT(i){return function(){return i}}function kT(i){return+i}var wd=[0,1];function Ui(i){return i}function rl(i,t){return(t-=i=+i)?function(e){return(e-i)/t}:OT(isNaN(t)?NaN:.5)}function FT(i,t){var e;return i>t&&(e=i,i=t,t=e),function(r){return Math.max(i,Math.min(t,r))}}function UT(i,t,e){var r=i[0],n=i[1],s=t[0],o=t[1];return n<r?(r=rl(n,r),s=e(o,s)):(r=rl(r,n),s=e(s,o)),function(a){return s(r(a))}}function GT(i,t,e){var r=Math.min(i.length,t.length)-1,n=new Array(r),s=new Array(r),o=-1;for(i[r]<i[0]&&(i=i.slice().reverse(),t=t.slice().reverse());++o<r;)n[o]=rl(i[o],i[o+1]),s[o]=e(t[o],t[o+1]);return function(a){var h=$b(i,a,1,r)-1;return s[h](n[h](a))}}function $T(i,t){return t.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function HT(){var i=wd,t=wd,e=Ml,r,n,s,o=Ui,a,h,l;function u(){var d=Math.min(i.length,t.length);return o!==Ui&&(o=FT(i[0],i[d-1])),a=d>2?GT:UT,h=l=null,c}function c(d){return d==null||isNaN(d=+d)?s:(h||(h=a(i.map(r),t,e)))(r(o(d)))}return c.invert=function(d){return o(n((l||(l=a(t,i.map(r),Oe)))(d)))},c.domain=function(d){return arguments.length?(i=Array.from(d,kT),u()):i.slice()},c.range=function(d){return arguments.length?(t=Array.from(d),u()):t.slice()},c.rangeRound=function(d){return t=Array.from(d),e=oA,u()},c.clamp=function(d){return arguments.length?(o=d?!0:Ui,u()):o!==Ui},c.interpolate=function(d){return arguments.length?(e=d,u()):e},c.unknown=function(d){return arguments.length?(s=d,c):s},function(d,f){return r=d,n=f,u()}}function zT(i,t,e,r){var n=i1(i,t,e),s;switch(r=Io(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(i),Math.abs(t));return r.precision==null&&!isNaN(s=lT(n,o))&&(r.precision=s),qp(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=uT(n,Math.max(Math.abs(i),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=hT(n))&&(r.precision=s-(r.type==="%")*2);break}}return Yp(r)}function WT(i){var t=i.domain;return i.ticks=function(e){var r=t();return e1(r[0],r[r.length-1],e??10)},i.tickFormat=function(e,r){var n=t();return zT(n[0],n[n.length-1],e??10,r)},i.nice=function(e){e==null&&(e=10);var r=t(),n=0,s=r.length-1,o=r[n],a=r[s],h,l,u=10;for(a<o&&(l=o,o=a,a=l,l=n,n=s,s=l);u-- >0;){if(l=Yh(o,a,e),l===h)return r[n]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;h=l}return i},i}function bd(i){return function(t){return t<0?-Math.pow(-t,i):Math.pow(t,i)}}function XT(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function VT(i){return i<0?-i*i:i*i}function jT(i){var t=i(Ui,Ui),e=1;function r(){return e===1?i(Ui,Ui):e===.5?i(XT,VT):i(bd(e),bd(1/e))}return t.exponent=function(n){return arguments.length?(e=+n,r()):e},WT(t)}function tg(){var i=jT(HT());return i.copy=function(){return $T(i,tg()).exponent(i.exponent())},Qp.apply(i,arguments),i}function YT(){return tg.apply(null,arguments).exponent(.5)}function qT(i){for(var t=i.length/6|0,e=new Array(t),r=0;r<t;)e[r]="#"+i.slice(r*6,++r*6);return e}const KT=qT("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function Rn(i,t,e){this.k=i,this.x=t,this.y=e}Rn.prototype={constructor:Rn,scale:function(i){return i===1?this:new Rn(this.k*i,this.x,this.y)},translate:function(i,t){return i===0&t===0?this:new Rn(this.k,this.x+this.k*i,this.y+this.k*t)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Rn.prototype;var kl={},Fl=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"},on={},Wo={};Wo.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";Wo.SYMBOL_SUPPORT=typeof Symbol<"u";var eg=Wo,ZT=eg.ARRAY_BUFFER_SUPPORT,QT=eg.SYMBOL_SUPPORT,Ul=function(t,e){var r,n,s,o,a;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||ZT&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(s=0,o=t.length;s<o;s++)e(t[s],s);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(QT&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(r=t,s=0;a=r.next(),a.done!==!0;)e(a.value,s),s++;return}for(n in t)t.hasOwnProperty(n)&&e(t[n],n)},ig={};(function(i){var t=Math.pow(2,8)-1,e=Math.pow(2,16)-1,r=Math.pow(2,32)-1,n=Math.pow(2,7)-1,s=Math.pow(2,15)-1,o=Math.pow(2,31)-1;i.getPointerArray=function(h){var l=h-1;if(l<=t)return Uint8Array;if(l<=e)return Uint16Array;if(l<=r)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},i.getSignedPointerArray=function(h){var l=h-1;return l<=n?Int8Array:l<=s?Int16Array:l<=o?Int32Array:Float64Array},i.getNumberType=function(h){return h===(h|0)?Math.sign(h)===-1?h<=127&&h>=-128?Int8Array:h<=32767&&h>=-32768?Int16Array:Int32Array:h<=255?Uint8Array:h<=65535?Uint16Array:Uint32Array:Float64Array};var a={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};i.getMinimalRepresentation=function(h,l){var u=null,c=0,d,f,p,g,m;for(g=0,m=h.length;g<m;g++)p=l?l(h[g]):h[g],f=i.getNumberType(p),d=a[f.name],d>c&&(c=d,u=f);return u},i.isTypedArray=function(h){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(h)},i.concat=function(){var h=0,l,u,c;for(l=0,c=arguments.length;l<c;l++)h+=arguments[l].length;var d=new arguments[0].constructor(h);for(l=0,u=0;l<c;l++)d.set(arguments[l],u),u+=arguments[l].length;return d},i.indices=function(h){for(var l=i.getPointerArray(h),u=new l(h),c=0;c<h;c++)u[c]=c;return u}})(ig);var rg=Ul,ng=ig;function JT(i){return Array.isArray(i)||ng.isTypedArray(i)}function Gl(i){if(typeof i.length=="number")return i.length;if(typeof i.size=="number")return i.size}function tI(i){var t=Gl(i),e=typeof t=="number"?new Array(t):[],r=0;return rg(i,function(n){e[r++]=n}),e}function eI(i){var t=Gl(i),e=typeof t=="number"?ng.getPointerArray(t):Array,r=typeof t=="number"?new Array(t):[],n=typeof t=="number"?new e(t):[],s=0;return rg(i,function(o){r[s]=o,n[s]=s++}),[r,n]}on.isArrayLike=JT;on.guessLength=Gl;on.toArray=tI;on.toArrayWithIndices=eI;function si(i){if(typeof i!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=i}typeof Symbol<"u"&&(si.prototype[Symbol.iterator]=function(){return this});si.of=function(){var i=arguments,t=i.length,e=0;return new si(function(){return e>=t?{done:!0}:{done:!1,value:i[e++]}})};si.empty=function(){var i=new si(function(){return{done:!0}});return i};si.fromSequence=function(i){var t=0,e=i.length;return new si(function(){return t>=e?{done:!0}:{done:!1,value:i[t++]}})};si.is=function(i){return i instanceof si?!0:typeof i=="object"&&i!==null&&typeof i.next=="function"};var Jn=si;const Me=Xn(Jn);var Va=on,sg=Jn;function Wt(i,t){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=i,this.capacity=t,this.items=new i(this.capacity),this.clear()}Wt.prototype.clear=function(){this.start=0,this.size=0};Wt.prototype.push=function(i){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var t=(this.start+this.size)%this.capacity;return this.items[t]=i,++this.size};Wt.prototype.unshift=function(i){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=i,this.start=t,++this.size};Wt.prototype.pop=function(){if(this.size===0)return;const i=(this.start+this.size-1)%this.capacity;return this.size--,this.items[i]};Wt.prototype.shift=function(){if(this.size!==0){var i=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[i]}};Wt.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};Wt.prototype.peekLast=function(){if(this.size!==0){var i=this.start+this.size-1;return i>this.capacity&&(i-=this.capacity),this.items[i]}};Wt.prototype.get=function(i){if(this.size!==0)return i=this.start+i,i>this.capacity&&(i-=this.capacity),this.items[i]};Wt.prototype.forEach=function(i,t){t=arguments.length>1?t:this;for(var e=this.capacity,r=this.size,n=this.start,s=0;s<r;)i.call(t,this.items[n],s,this),n++,s++,n===e&&(n=0)};Wt.prototype.toArray=function(){var i=this.start+this.size;if(i<this.capacity)return this.items.slice(this.start,i);for(var t=new this.ArrayClass(this.size),e=this.capacity,r=this.size,n=this.start,s=0;s<r;)t[s]=this.items[n],n++,s++,n===e&&(n=0);return t};Wt.prototype.values=function(){var i=this.items,t=this.capacity,e=this.size,r=this.start,n=0;return new sg(function(){if(n>=e)return{done:!0};var s=i[r];return r++,n++,r===t&&(r=0),{value:s,done:!1}})};Wt.prototype.entries=function(){var i=this.items,t=this.capacity,e=this.size,r=this.start,n=0;return new sg(function(){if(n>=e)return{done:!0};var s=i[r];return r++,r===t&&(r=0),{value:[n++,s],done:!1}})};typeof Symbol<"u"&&(Wt.prototype[Symbol.iterator]=Wt.prototype.values);Wt.prototype.inspect=function(){var i=this.toArray();return i.type=this.ArrayClass.name,i.capacity=this.capacity,Object.defineProperty(i,"constructor",{value:Wt,enumerable:!1}),i};typeof Symbol<"u"&&(Wt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Wt.prototype.inspect);Wt.from=function(i,t,e){if(arguments.length<3&&(e=Va.guessLength(i),typeof e!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var r=new Wt(t,e);if(Va.isArrayLike(i)){var n,s;for(n=0,s=i.length;n<s;n++)r.items[n]=i[n];return r.size=s,r}return Va.forEach(i,function(o){r.push(o)}),r};var iI=Wt,rI=iI;function Xi(i){this.graph=i,this.queue=new rI(Array,i.order),this.seen=new Set,this.size=0}Xi.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};Xi.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};Xi.prototype.forEachNodeYetUnseen=function(i){var t=this.seen,e=this.graph;e.someNode(function(r,n){if(t.size===e.order)return!0;if(t.has(r))return!1;var s=i(r,n);return!!s})};Xi.prototype.has=function(i){return this.seen.has(i)};Xi.prototype.push=function(i){var t=this.seen.size;return this.seen.add(i),t===this.seen.size?!1:(this.queue.push(i),this.size++,!0)};Xi.prototype.pushWith=function(i,t){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.queue.push(t),this.size++,!0)};Xi.prototype.shift=function(){var i=this.queue.shift();return this.size=this.queue.size,i};var nI=Xi,$l={};function sI(i,t,e){this.node=i,this.attributes=t,this.depth=e}function oI(i){return i[0].toUpperCase()+i.slice(1)}$l.TraversalRecord=sI;$l.capitalize=oI;var aI=Fl,hI=nI,og=$l,Ed=og.TraversalRecord,lI=og.capitalize;function ag(i,t,e,r){if(r=r||{},!aI(i))throw new Error("graphology-traversal/bfs: expecting a graphology instance.");if(typeof e!="function")throw new Error("graphology-traversal/bfs: given callback is not a function.");if(i.order===0)return;var n=new hI(i),s=i["forEach"+lI(r.mode||"outbound")+"Neighbor"].bind(i),o;t===null?o=n.forEachNodeYetUnseen.bind(n):o=function(u){t=""+t,u(t,i.getNodeAttributes(t))};var a,h;function l(u,c){n.pushWith(u,new Ed(u,c,a.depth+1))}o(function(u,c){for(n.pushWith(u,new Ed(u,c,0));n.size!==0;)a=n.shift(),h=e(a.node,a.attributes,a.depth),h!==!0&&s(a.node,l)})}kl.bfs=function(i,t,e){return ag(i,null,t,e)};kl.bfsFromNode=ag;function xr(i){this.graph=i,this.stack=new Array(i.order),this.seen=new Set,this.size=0}xr.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order};xr.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size};xr.prototype.forEachNodeYetUnseen=function(i){var t=this.seen,e=this.graph;e.someNode(function(r,n){if(t.size===e.order)return!0;if(t.has(r))return!1;var s=i(r,n);return!!s})};xr.prototype.has=function(i){return this.seen.has(i)};xr.prototype.push=function(i){var t=this.seen.size;return this.seen.add(i),t===this.seen.size?!1:(this.stack[this.size++]=i,!0)};xr.prototype.pushWith=function(i,t){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.stack[this.size++]=t,!0)};xr.prototype.pop=function(){if(this.size!==0)return this.stack[--this.size]};var uI=kl,Ad=uI.bfsFromNode,an={},hg=Jn,cI=Ul;function Xt(){this.clear()}Xt.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};Xt.prototype.enqueue=function(i){return this.items.push(i),++this.size};Xt.prototype.dequeue=function(){if(this.size){var i=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,i}};Xt.prototype.peek=function(){if(this.size)return this.items[this.offset]};Xt.prototype.forEach=function(i,t){t=arguments.length>1?t:this;for(var e=this.offset,r=0,n=this.items.length;e<n;e++,r++)i.call(t,this.items[e],r,this)};Xt.prototype.toArray=function(){return this.items.slice(this.offset)};Xt.prototype.values=function(){var i=this.items,t=this.offset;return new hg(function(){if(t>=i.length)return{done:!0};var e=i[t];return t++,{value:e,done:!1}})};Xt.prototype.entries=function(){var i=this.items,t=this.offset,e=0;return new hg(function(){if(t>=i.length)return{done:!0};var r=i[t];return t++,{value:[e++,r],done:!1}})};typeof Symbol<"u"&&(Xt.prototype[Symbol.iterator]=Xt.prototype.values);Xt.prototype.toString=function(){return this.toArray().join(",")};Xt.prototype.toJSON=function(){return this.toArray()};Xt.prototype.inspect=function(){var i=this.toArray();return Object.defineProperty(i,"constructor",{value:Xt,enumerable:!1}),i};typeof Symbol<"u"&&(Xt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Xt.prototype.inspect);Xt.from=function(i){var t=new Xt;return cI(i,function(e){t.enqueue(e)}),t};Xt.of=function(){return Xt.from(arguments)};var dI=Xt,fI=function(t,e){var r=e.length;if(r!==0){var n=t.length;t.length+=r;for(var s=0;s<r;s++)t[n+s]=e[s]}},Hl=Fl,pI=dI,gI=fI;function mI(i,t,e){if(!Hl(i))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<3)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 3.");if(!i.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');if(!i.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" target node does not exist in the given graph.');if(t=""+t,e=""+e,t===e)return[t];var r=i.inboundNeighbors.bind(i),n=i.outboundNeighbors.bind(i),s={},o={};s[t]=null,o[e]=null;var a=[t],h=[e],l,u,c,d,f,p,g,m,y=!1;t:for(;a.length&&h.length;)if(a.length<=h.length){for(l=a,a=[],f=0,g=l.length;f<g;f++)for(u=l[f],c=n(u),p=0,m=c.length;p<m;p++)if(d=c[p],d in s||(a.push(d),s[d]=u),d in o){y=!0;break t}}else for(l=h,h=[],f=0,g=l.length;f<g;f++)for(u=l[f],c=r(u),p=0,m=c.length;p<m;p++)if(d=c[p],d in o||(h.push(d),o[d]=u),d in s){y=!0;break t}if(!y)return null;for(var _=[];d;)_.unshift(d),d=s[d];for(d=o[_[_.length-1]];d;)_.push(d),d=o[d];return _.length?_:null}function yI(i,t){if(!Hl(i))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<2)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 2.");if(!i.hasNode(t))throw new Error('graphology-shortest-path: the "'+t+'" source node does not exist in the given graph.');t=""+t;var e={},r={},n,s,o,a,h,l;for(e[t]=!0,r[t]=[t];Object.keys(e).length;){n=e,e={};for(o in n)for(s=i.outboundNeighbors(o),h=0,l=s.length;h<l;h++)a=s[h],r[a]||(r[a]=r[o].concat(a),e[a]=!0)}return r}function lg(i,t,e){if(!Hl(t))throw new Error("graphology-shortest-path: invalid graphology instance.");if(!t.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" source node does not exist in the given graph.');e=""+e;var r=new Set,n={},s=0;n[e]=0;for(var o=[e],a,h,l;o.length!==0;){var u=[];for(a=0,h=o.length;a<h;a++)l=o[a],!r.has(l)&&(r.add(l),gI(u,t[i](l)),n[l]=s);s++,o=u}return n}var vI=lg.bind(null,"outboundNeighbors"),_I=lg.bind(null,"neighbors");function xI(i,t){t=""+t;var e=[],r={},n={},s=i.nodes(),o,a,h,l,u,c,d,f,p;for(c=0,f=s.length;c<f;c++)l=s[c],r[l]=[],n[l]=0;var g={};n[t]=1,g[t]=0;for(var m=pI.of(t);m.size;)for(l=m.dequeue(),e.push(l),o=g[l],a=n[l],h=i.outboundNeighbors(l),d=0,p=h.length;d<p;d++)u=h[d],u in g||(m.enqueue(u),g[u]=o+1),g[u]===o+1&&(n[u]+=a,r[u].push(l));return[e,r,n]}an.bidirectional=mI;an.singleSource=yI;an.singleSourceLength=vI;an.undirectedSingleSourceLength=_I;an.brandes=xI;var Xo={},Vo={};function wI(i){return typeof i!="number"||isNaN(i)?1:i}function bI(i,t){var e={},r=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(r=t);var n=function(o){return r(o[i])},s=function(){return r(void 0)};return typeof i=="string"?(e.fromAttributes=n,e.fromGraph=function(o,a){return n(o.getNodeAttributes(a))},e.fromEntry=function(o,a){return n(a)}):typeof i=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){return r(i(a,o.getNodeAttributes(a)))},e.fromEntry=function(o,a){return r(i(o,a))}):(e.fromAttributes=s,e.fromGraph=s,e.fromEntry=s),e}function ug(i,t){var e={},r=function(o){return typeof o>"u"?t:o};typeof t=="function"&&(r=t);var n=function(o){return r(o[i])},s=function(){return r(void 0)};return typeof i=="string"?(e.fromAttributes=n,e.fromGraph=function(o,a){return n(o.getEdgeAttributes(a))},e.fromEntry=function(o,a){return n(a)},e.fromPartialEntry=e.fromEntry,e.fromMinimalEntry=e.fromEntry):typeof i=="function"?(e.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},e.fromGraph=function(o,a){var h=o.extremities(a);return r(i(a,o.getEdgeAttributes(a),h[0],h[1],o.getNodeAttributes(h[0]),o.getNodeAttributes(h[1]),o.isUndirected(a)))},e.fromEntry=function(o,a,h,l,u,c,d){return r(i(o,a,h,l,u,c,d))},e.fromPartialEntry=function(o,a,h,l){return r(i(o,a,h,l))},e.fromMinimalEntry=function(o,a){return r(i(o,a))}):(e.fromAttributes=s,e.fromGraph=s,e.fromEntry=s,e.fromMinimalEntry=s),e}Vo.createNodeValueGetter=bI;Vo.createEdgeValueGetter=ug;Vo.createEdgeWeightGetter=function(i){return ug(i,wI)};var ts={},EI=function(i,t){return i<t?-1:i>t?1:0},AI=function(i,t){return i<t?1:i>t?-1:0};function SI(i){return function(t,e){return i(e,t)}}function TI(i){return i===2?function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:t[1]<e[1]?-1:t[1]>e[1]?1:0}:function(t,e){for(var r=0;r<i;){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1;r++}return 0}}ts.DEFAULT_COMPARATOR=EI;ts.DEFAULT_REVERSE_COMPARATOR=AI;ts.reverseComparator=SI;ts.createTupleComparator=TI;var Co=Ul,cg=ts,ri=on,jo=cg.DEFAULT_COMPARATOR,zl=cg.reverseComparator;function Wl(i,t,e,r){for(var n=t[r],s,o;r>e;){if(s=r-1>>1,o=t[s],i(n,o)<0){t[r]=o,r=s;continue}break}t[r]=n}function es(i,t,e){for(var r=t.length,n=e,s=t[e],o=2*e+1,a;o<r;)a=o+1,a<r&&i(t[o],t[a])>=0&&(o=a),t[e]=t[o],e=o,o=2*e+1;t[e]=s,Wl(i,t,n,e)}function dg(i,t,e){t.push(e),Wl(i,t,0,t.length-1)}function Xl(i,t){var e=t.pop();if(t.length!==0){var r=t[0];return t[0]=e,es(i,t,0),r}return e}function rn(i,t,e){if(t.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var r=t[0];return t[0]=e,es(i,t,0),r}function fg(i,t,e){var r;return t.length!==0&&i(t[0],e)<0&&(r=t[0],t[0]=e,e=r,es(i,t,0)),e}function mr(i,t){for(var e=t.length,r=e>>1,n=r;--n>=0;)es(i,t,n)}function Vl(i,t){for(var e=t.length,r=0,n=new Array(e);r<e;)n[r++]=Xl(i,t);return n}function II(i,t,e){arguments.length===2&&(e=t,t=i,i=jo);var r=zl(i),n,s,o,a=1/0,h;if(t===1){if(ri.isArrayLike(e)){for(n=0,s=e.length;n<s;n++)o=e[n],(a===1/0||i(o,a)<0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Co(e,function(u){(a===1/0||i(u,a)<0)&&(a=u)}),[a]}if(ri.isArrayLike(e)){if(t>=e.length)return e.slice().sort(i);for(h=e.slice(0,t),mr(r,h),n=t,s=e.length;n<s;n++)r(e[n],h[0])>0&&rn(r,h,e[n]);return h.sort(i)}var l=ri.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),n=0,Co(e,function(u){n<t?h[n]=u:(n===t&&mr(r,h),r(u,h[0])>0&&rn(r,h,u)),n++}),h.length>n&&(h.length=n),h.sort(i)}function CI(i,t,e){arguments.length===2&&(e=t,t=i,i=jo);var r=zl(i),n,s,o,a=-1/0,h;if(t===1){if(ri.isArrayLike(e)){for(n=0,s=e.length;n<s;n++)o=e[n],(a===-1/0||i(o,a)>0)&&(a=o);return h=new e.constructor(1),h[0]=a,h}return Co(e,function(u){(a===-1/0||i(u,a)>0)&&(a=u)}),[a]}if(ri.isArrayLike(e)){if(t>=e.length)return e.slice().sort(r);for(h=e.slice(0,t),mr(i,h),n=t,s=e.length;n<s;n++)i(e[n],h[0])>0&&rn(i,h,e[n]);return h.sort(r)}var l=ri.guessLength(e);return l!==null&&l<t&&(t=l),h=new Array(t),n=0,Co(e,function(u){n<t?h[n]=u:(n===t&&mr(i,h),i(u,h[0])>0&&rn(i,h,u)),n++}),h.length>n&&(h.length=n),h.sort(r)}function Tt(i){if(this.clear(),this.comparator=i||jo,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}Tt.prototype.clear=function(){this.items=[],this.size=0};Tt.prototype.push=function(i){return dg(this.comparator,this.items,i),++this.size};Tt.prototype.peek=function(){return this.items[0]};Tt.prototype.pop=function(){return this.size!==0&&this.size--,Xl(this.comparator,this.items)};Tt.prototype.replace=function(i){return rn(this.comparator,this.items,i)};Tt.prototype.pushpop=function(i){return fg(this.comparator,this.items,i)};Tt.prototype.consume=function(){return this.size=0,Vl(this.comparator,this.items)};Tt.prototype.toArray=function(){return Vl(this.comparator,this.items.slice())};Tt.prototype.inspect=function(){var i=this.toArray();return Object.defineProperty(i,"constructor",{value:Tt,enumerable:!1}),i};typeof Symbol<"u"&&(Tt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Tt.prototype.inspect);function Mo(i){if(this.clear(),this.comparator=i||jo,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=zl(this.comparator)}Mo.prototype=Tt.prototype;Tt.from=function(i,t){var e=new Tt(t),r;return ri.isArrayLike(i)?r=i.slice():r=ri.toArray(i),mr(e.comparator,r),e.items=r,e.size=r.length,e};Mo.from=function(i,t){var e=new Mo(t),r;return ri.isArrayLike(i)?r=i.slice():r=ri.toArray(i),mr(e.comparator,r),e.items=r,e.size=r.length,e};Tt.siftUp=es;Tt.siftDown=Wl;Tt.push=dg;Tt.pop=Xl;Tt.replace=rn;Tt.pushpop=fg;Tt.heapify=mr;Tt.consume=Vl;Tt.nsmallest=II;Tt.nlargest=CI;Tt.MinHeap=Tt;Tt.MaxHeap=Mo;var MI=Tt,pg=Fl,jl=Vo.createEdgeWeightGetter,Po=MI,Yl="weight";function nl(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:i[2]>t[2]?1:i[2]<t[2]?-1:0}function PI(i,t){return i[0]>t[0]?1:i[0]<t[0]?-1:i[1]>t[1]?1:i[1]<t[1]?-1:i[2]>t[2]?1:i[2]<t[2]?-1:i[3]>t[3]?1:i[3]<t[3]?-1:0}function RI(i,t,e,r){if(t=""+t,e=""+e,!pg(i))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(t&&!i.hasNode(t))throw new Error('graphology-shortest-path/dijkstra: the "'+t+'" source node does not exist in the given graph.');if(e&&!i.hasNode(e))throw new Error('graphology-shortest-path/dijkstra: the "'+e+'" target node does not exist in the given graph.');if(r=jl(r||Yl).fromMinimalEntry,t===e)return[0,[t]];var n=[{},{}],s=[{},{}],o=[new Po(nl),new Po(nl)],a=[{},{}];s[0][t]=[t],s[1][e]=[e],a[0][t]=0,a[1][e]=0;var h=[],l=1/0,u=0,c=1,d,f,p,g,m,y,_,v,x;for(o[0].push([0,u++,t]),o[1].push([0,u++,e]);o[0].size&&o[1].size;)if(c=1-c,d=o[c].pop(),g=d[0],m=d[2],!(m in n[c])){if(n[c][m]=g,m in n[1-c])return[l,h];for(f=c===1?i.inboundEdges(m):i.outboundEdges(m),v=0,x=f.length;v<x;v++){if(_=f[v],y=i.opposite(m,_),p=n[c][m]+r(_,i.getEdgeAttributes(_)),y in n[c]&&p<n[c][y])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(y in a[c])||p<a[c][y])&&(a[c][y]=p,o[c].push([p,u++,y]),s[c][y]=s[c][m].concat(y),y in a[0]&&y in a[1]&&(g=a[0][y]+a[1][y],(h.length===0||l>g)&&(l=g,h=s[0][y].concat(s[1][y].slice(0,-1).reverse()))))}}return[1/0,null]}function DI(i,t,e,r,n,s){if(!pg(i))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(n&&!i.hasNode(n))throw new Error('graphology-shortest-path/dijkstra: the "'+n+'" target node does not exist in the given graph.');e=jl(e||Yl).fromMinimalEntry;var o={},a={},h=new Po(nl),l=0,u,c,d,f,p,g,m,y,_,v,x;for(y=0,v=t.length;y<v;y++)f=t[y],a[f]=0,h.push([0,l++,f]),s&&(s[f]=[f]);for(;h.size;)if(c=h.pop(),m=c[0],f=c[2],!(f in o)){if(o[f]=m,f===n)break;for(u=i.outboundEdges(f),_=0,x=u.length;_<x;_++)if(g=u[_],p=i.opposite(f,g),d=e(g,i.getEdgeAttributes(g))+o[f],!(r&&d>r)){if(p in o&&d<o[p])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(p in a)||d<a[p])&&(a[p]=d,h.push([d,l++,p]),s&&(s[p]=s[f].concat(p)))}}return o}function NI(i,t,e){var r={};return DI(i,[t],e,0,null,r),r}function BI(i,t,e,r){return RI(i,t,e,r)[1]}function LI(i,t,e){t=""+t,e=jl(e||Yl).fromMinimalEntry;var r=[],n={},s={},o=i.nodes(),a,h,l,u,c,d,f,p,g,m;for(g=0,m=o.length;g<m;g++)d=o[g],n[d]=[],s[d]=0;var y={};s[t]=1;var _={};_[t]=0;var v=0,x=new Po(PI);for(x.push([0,v++,t,t]);x.size;)if(h=x.pop(),u=h[0],l=h[2],d=h[3],!(d in y))for(s[d]+=s[l],r.push(d),y[d]=u,a=i.outboundEdges(d),g=0,m=a.length;g<m;g++)p=a[g],f=i.opposite(d,p),c=u+e(p,i.getEdgeAttributes(p)),!(f in y)&&(!(f in _)||c<_[f])?(_[f]=c,x.push([c,v++,d,f]),s[f]=0,n[f]=[d]):c===_[f]&&(s[f]+=s[d],n[f].push(d));return[r,n,s]}Xo.bidirectional=BI;Xo.singleSource=NI;Xo.brandes=LI;var is=an,OI=Xo;is.bidirectional;is.singleSource;is.singleSourceLength;is.undirectedSingleSourceLength;is.brandes;var ql={exports:{}},Yr=typeof Reflect=="object"?Reflect:null,Sd=Yr&&typeof Yr.apply=="function"?Yr.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},Ks;Yr&&typeof Yr.ownKeys=="function"?Ks=Yr.ownKeys:Object.getOwnPropertySymbols?Ks=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ks=function(t){return Object.getOwnPropertyNames(t)};function kI(i){console&&console.warn&&console.warn(i)}var gg=Number.isNaN||function(t){return t!==t};function Mt(){Mt.init.call(this)}ql.exports=Mt;ql.exports.once=$I;Mt.EventEmitter=Mt;Mt.prototype._events=void 0;Mt.prototype._eventsCount=0;Mt.prototype._maxListeners=void 0;var Td=10;function Yo(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Mt,"defaultMaxListeners",{enumerable:!0,get:function(){return Td},set:function(i){if(typeof i!="number"||i<0||gg(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Td=i}});Mt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Mt.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||gg(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function mg(i){return i._maxListeners===void 0?Mt.defaultMaxListeners:i._maxListeners}Mt.prototype.getMaxListeners=function(){return mg(this)};Mt.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n=t==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=s[t];if(h===void 0)return!1;if(typeof h=="function")Sd(h,this,e);else for(var l=h.length,u=wg(h,l),r=0;r<l;++r)Sd(u[r],this,e);return!0};function yg(i,t,e,r){var n,s,o;if(Yo(e),s=i._events,s===void 0?(s=i._events=Object.create(null),i._eventsCount=0):(s.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),s=i._events),o=s[t]),o===void 0)o=s[t]=e,++i._eventsCount;else if(typeof o=="function"?o=s[t]=r?[e,o]:[o,e]:r?o.unshift(e):o.push(e),n=mg(i),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=t,a.count=o.length,kI(a)}return i}Mt.prototype.addListener=function(t,e){return yg(this,t,e,!1)};Mt.prototype.on=Mt.prototype.addListener;Mt.prototype.prependListener=function(t,e){return yg(this,t,e,!0)};function FI(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function vg(i,t,e){var r={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},n=FI.bind(r);return n.listener=e,r.wrapFn=n,n}Mt.prototype.once=function(t,e){return Yo(e),this.on(t,vg(this,t,e)),this};Mt.prototype.prependOnceListener=function(t,e){return Yo(e),this.prependListener(t,vg(this,t,e)),this};Mt.prototype.removeListener=function(t,e){var r,n,s,o,a;if(Yo(e),n=this._events,n===void 0)return this;if(r=n[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():UI(r,s),r.length===1&&(n[t]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};Mt.prototype.off=Mt.prototype.removeListener;Mt.prototype.removeAllListeners=function(t){var e,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var s=Object.keys(r),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this};function _g(i,t,e){var r=i._events;if(r===void 0)return[];var n=r[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?GI(n):wg(n,n.length)}Mt.prototype.listeners=function(t){return _g(this,t,!0)};Mt.prototype.rawListeners=function(t){return _g(this,t,!1)};Mt.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):xg.call(i,t)};Mt.prototype.listenerCount=xg;function xg(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Mt.prototype.eventNames=function(){return this._eventsCount>0?Ks(this._events):[]};function wg(i,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=i[r];return e}function UI(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function GI(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function $I(i,t){return new Promise(function(e,r){function n(o){i.removeListener(t,s),r(o)}function s(){typeof i.removeListener=="function"&&i.removeListener("error",n),e([].slice.call(arguments))}bg(i,t,s,{once:!0}),t!=="error"&&HI(i,n,{once:!0})})}function HI(i,t,e){typeof i.on=="function"&&bg(i,"error",t,e)}function bg(i,t,e,r){if(typeof i.on=="function")r.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function n(s){r.once&&i.removeEventListener(t,n),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var zI=ql.exports,WI=Jn,Eg=Wo,XI=Eg.ARRAY_BUFFER_SUPPORT,VI=Eg.SYMBOL_SUPPORT;function jI(i){return typeof i=="string"||Array.isArray(i)||XI&&ArrayBuffer.isView(i)?WI.fromSequence(i):typeof i!="object"||i===null?null:VI&&typeof i[Symbol.iterator]=="function"?i[Symbol.iterator]():typeof i.next=="function"?i:null}var Ag=function(t){var e=jI(t);if(!e)throw new Error("obliterator: target is not iterable nor a valid iterator.");return e},YI=Ag,qI=function(t,e){for(var r=arguments.length>1?e:1/0,n=r!==1/0?new Array(r):[],s,o=0,a=YI(t);;){if(o===r)return n;if(s=a.next(),s.done)return o!==e&&(n.length=o),n;n[o++]=s.value}};const Sg=Xn(qI);var KI=Jn,ZI=Ag,QI=function(){var t=arguments,e=null,r=-1;return new KI(function(){var s=null;do{if(e===null){if(r++,r>=t.length)return{done:!0};e=ZI(t[r])}if(s=e.next(),s.done===!0){e=null;continue}break}while(!0);return s})};const Ei=Xn(QI);function JI(){const i=arguments[0];for(let t=1,e=arguments.length;t<e;t++)if(arguments[t])for(const r in arguments[t])i[r]=arguments[t][r];return i}let Kt=JI;typeof Object.assign=="function"&&(Kt=Object.assign);function Ce(i,t,e,r){const n=i._nodes.get(t);let s=null;return n&&(r==="mixed"?s=n.out&&n.out[e]||n.undirected&&n.undirected[e]:r==="directed"?s=n.out&&n.out[e]:s=n.undirected&&n.undirected[e]),s}function ne(i){return typeof i=="object"&&i!==null}function Tg(i){let t;for(t in i)return!1;return!0}function Ae(i,t,e){Object.defineProperty(i,t,{enumerable:!1,configurable:!1,writable:!0,value:e})}function Ne(i,t,e){const r={enumerable:!0,configurable:!0};typeof e=="function"?r.get=e:(r.value=e,r.writable=!1),Object.defineProperty(i,t,r)}function Id(i){return!(!ne(i)||i.attributes&&!Array.isArray(i.attributes))}function tC(){let i=Math.floor(Math.random()*256)&255;return()=>i++}class Kl extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class V extends Kl{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,V.prototype.constructor)}}class $ extends Kl{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$.prototype.constructor)}}class lt extends Kl{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,lt.prototype.constructor)}}function Ig(i,t){this.key=i,this.attributes=t,this.clear()}Ig.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Cg(i,t){this.key=i,this.attributes=t,this.clear()}Cg.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Mg(i,t){this.key=i,this.attributes=t,this.clear()}Mg.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function hn(i,t,e,r,n){this.key=t,this.attributes=n,this.undirected=i,this.source=e,this.target=r}hn.prototype.attach=function(){let i="out",t="in";this.undirected&&(i=t="undirected");const e=this.source.key,r=this.target.key;this.source[i][r]=this,!(this.undirected&&e===r)&&(this.target[t][e]=this)};hn.prototype.attachMulti=function(){let i="out",t="in";const e=this.source.key,r=this.target.key;this.undirected&&(i=t="undirected");const n=this.source[i],s=n[r];if(typeof s>"u"){n[r]=this,this.undirected&&e===r||(this.target[t][e]=this);return}s.previous=this,this.next=s,n[r]=this,this.target[t][e]=this};hn.prototype.detach=function(){const i=this.source.key,t=this.target.key;let e="out",r="in";this.undirected&&(e=r="undirected"),delete this.source[e][t],delete this.target[r][i]};hn.prototype.detachMulti=function(){const i=this.source.key,t=this.target.key;let e="out",r="in";this.undirected&&(e=r="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[e][t],delete this.target[r][i]):(this.next.previous=void 0,this.source[e][t]=this.next,this.target[r][i]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Pg=0,Rg=1,eC=2,Dg=3;function Ii(i,t,e,r,n,s,o){let a,h,l,u;if(r=""+r,e===Pg){if(a=i._nodes.get(r),!a)throw new $(`Graph.${t}: could not find the "${r}" node in the graph.`);l=n,u=s}else if(e===Dg){if(n=""+n,h=i._edges.get(n),!h)throw new $(`Graph.${t}: could not find the "${n}" edge in the graph.`);const c=h.source.key,d=h.target.key;if(r===c)a=h.target;else if(r===d)a=h.source;else throw new $(`Graph.${t}: the "${r}" node is not attached to the "${n}" edge (${c}, ${d}).`);l=s,u=o}else{if(h=i._edges.get(r),!h)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`);e===Rg?a=h.source:a=h.target,l=n,u=s}return[a,l,u]}function iC(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Ii(this,t,e,r,n,s);return o.attributes[a]}}function rC(i,t,e){i.prototype[t]=function(r,n){const[s]=Ii(this,t,e,r,n);return s.attributes}}function nC(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Ii(this,t,e,r,n,s);return o.attributes.hasOwnProperty(a)}}function sC(i,t,e){i.prototype[t]=function(r,n,s,o){const[a,h,l]=Ii(this,t,e,r,n,s,o);return a.attributes[h]=l,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function oC(i,t,e){i.prototype[t]=function(r,n,s,o){const[a,h,l]=Ii(this,t,e,r,n,s,o);if(typeof l!="function")throw new V(`Graph.${t}: updater should be a function.`);const u=a.attributes,c=l(u[h]);return u[h]=c,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:h}),this}}function aC(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Ii(this,t,e,r,n,s);return delete o.attributes[a],this.emit("nodeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:a}),this}}function hC(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Ii(this,t,e,r,n,s);if(!ne(a))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=a,this.emit("nodeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function lC(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Ii(this,t,e,r,n,s);if(!ne(a))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return Kt(o.attributes,a),this.emit("nodeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:a}),this}}function uC(i,t,e){i.prototype[t]=function(r,n,s){const[o,a]=Ii(this,t,e,r,n,s);if(typeof a!="function")throw new V(`Graph.${t}: provided updater is not a function.`);return o.attributes=a(o.attributes),this.emit("nodeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const cC=[{name:i=>`get${i}Attribute`,attacher:iC},{name:i=>`get${i}Attributes`,attacher:rC},{name:i=>`has${i}Attribute`,attacher:nC},{name:i=>`set${i}Attribute`,attacher:sC},{name:i=>`update${i}Attribute`,attacher:oC},{name:i=>`remove${i}Attribute`,attacher:aC},{name:i=>`replace${i}Attributes`,attacher:hC},{name:i=>`merge${i}Attributes`,attacher:lC},{name:i=>`update${i}Attributes`,attacher:uC}];function dC(i){cC.forEach(function({name:t,attacher:e}){e(i,t("Node"),Pg),e(i,t("Source"),Rg),e(i,t("Target"),eC),e(i,t("Opposite"),Dg)})}function fC(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Ce(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return s.attributes[n]}}function pC(i,t,e){i.prototype[t]=function(r){let n;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+r,o=""+arguments[1];if(n=Ce(this,s,o,e),!n)throw new $(`Graph.${t}: could not find an edge for the given path ("${s}" - "${o}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,n=this._edges.get(r),!n)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return n.attributes}}function gC(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Ce(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return s.attributes.hasOwnProperty(n)}}function mC(i,t,e){i.prototype[t]=function(r,n,s){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+r,h=""+n;if(n=arguments[2],s=arguments[3],o=Ce(this,a,h,e),!o)throw new $(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,o=this._edges.get(r),!o)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return o.attributes[n]=s,this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:n}),this}}function yC(i,t,e){i.prototype[t]=function(r,n,s){let o;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+r,h=""+n;if(n=arguments[2],s=arguments[3],o=Ce(this,a,h,e),!o)throw new $(`Graph.${t}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,o=this._edges.get(r),!o)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(typeof s!="function")throw new V(`Graph.${t}: updater should be a function.`);return o.attributes[n]=s(o.attributes[n]),this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:n}),this}}function vC(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Ce(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}return delete s.attributes[n],this.emit("edgeAttributesUpdated",{key:s.key,type:"remove",attributes:s.attributes,name:n}),this}}function _C(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Ce(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(!ne(n))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return s.attributes=n,this.emit("edgeAttributesUpdated",{key:s.key,type:"replace",attributes:s.attributes}),this}}function xC(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Ce(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(!ne(n))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return Kt(s.attributes,n),this.emit("edgeAttributesUpdated",{key:s.key,type:"merge",attributes:s.attributes,data:n}),this}}function wC(i,t,e){i.prototype[t]=function(r,n){let s;if(this.type!=="mixed"&&e!=="mixed"&&e!==this.type)throw new lt(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new lt(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+r,a=""+n;if(n=arguments[2],s=Ce(this,o,a,e),!s)throw new $(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(e!=="mixed")throw new lt(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(r=""+r,s=this._edges.get(r),!s)throw new $(`Graph.${t}: could not find the "${r}" edge in the graph.`)}if(typeof n!="function")throw new V(`Graph.${t}: provided updater is not a function.`);return s.attributes=n(s.attributes),this.emit("edgeAttributesUpdated",{key:s.key,type:"update",attributes:s.attributes}),this}}const bC=[{name:i=>`get${i}Attribute`,attacher:fC},{name:i=>`get${i}Attributes`,attacher:pC},{name:i=>`has${i}Attribute`,attacher:gC},{name:i=>`set${i}Attribute`,attacher:mC},{name:i=>`update${i}Attribute`,attacher:yC},{name:i=>`remove${i}Attribute`,attacher:vC},{name:i=>`replace${i}Attributes`,attacher:_C},{name:i=>`merge${i}Attributes`,attacher:xC},{name:i=>`update${i}Attributes`,attacher:wC}];function EC(i){bC.forEach(function({name:t,attacher:e}){e(i,t("Edge"),"mixed"),e(i,t("DirectedEdge"),"directed"),e(i,t("UndirectedEdge"),"undirected")})}const AC=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function SC(i,t,e,r){let n=!1;for(const s in t){if(s===r)continue;const o=t[s];if(n=e(o.key,o.attributes,o.source.key,o.target.key,o.source.attributes,o.target.attributes,o.undirected),i&&n)return o.key}}function TC(i,t,e,r){let n,s,o,a=!1;for(const h in t)if(h!==r){n=t[h];do{if(s=n.source,o=n.target,a=e(n.key,n.attributes,s.key,o.key,s.attributes,o.attributes,n.undirected),i&&a)return n.key;n=n.next}while(n!==void 0)}}function ja(i,t){const e=Object.keys(i),r=e.length;let n,s=0;return new Me(function(){do if(n)n=n.next;else{if(s>=r)return{done:!0};const a=e[s++];if(a===t){n=void 0;continue}n=i[a]}while(!n);return{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}}})}function IC(i,t,e,r){const n=t[e];if(!n)return;const s=n.source,o=n.target;if(r(n.key,n.attributes,s.key,o.key,s.attributes,o.attributes,n.undirected)&&i)return n.key}function CC(i,t,e,r){let n=t[e];if(!n)return;let s=!1;do{if(s=r(n.key,n.attributes,n.source.key,n.target.key,n.source.attributes,n.target.attributes,n.undirected),i&&s)return n.key;n=n.next}while(n!==void 0)}function Ya(i,t){let e=i[t];return e.next!==void 0?new Me(function(){if(!e)return{done:!0};const r={edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected};return e=e.next,{done:!1,value:r}}):Me.of({edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected})}function MC(i,t){if(i.size===0)return[];if(t==="mixed"||t===i.type)return typeof Array.from=="function"?Array.from(i._edges.keys()):Sg(i._edges.keys(),i._edges.size);const e=t==="undirected"?i.undirectedSize:i.directedSize,r=new Array(e),n=t==="undirected",s=i._edges.values();let o=0,a,h;for(;a=s.next(),a.done!==!0;)h=a.value,h.undirected===n&&(r[o++]=h.key);return r}function Ng(i,t,e,r){if(t.size===0)return;const n=e!=="mixed"&&e!==t.type,s=e==="undirected";let o,a,h=!1;const l=t._edges.values();for(;o=l.next(),o.done!==!0;){if(a=o.value,n&&a.undirected!==s)continue;const{key:u,attributes:c,source:d,target:f}=a;if(h=r(u,c,d.key,f.key,d.attributes,f.attributes,a.undirected),i&&h)return u}}function PC(i,t){if(i.size===0)return Me.empty();const e=t!=="mixed"&&t!==i.type,r=t==="undirected",n=i._edges.values();return new Me(function(){let o,a;for(;;){if(o=n.next(),o.done)return o;if(a=o.value,!(e&&a.undirected!==r))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}})}function Zl(i,t,e,r,n,s){const o=t?TC:SC;let a;if(e!=="undirected"&&(r!=="out"&&(a=o(i,n.in,s),i&&a)||r!=="in"&&(a=o(i,n.out,s,r?void 0:n.key),i&&a))||e!=="directed"&&(a=o(i,n.undirected,s),i&&a))return a}function RC(i,t,e,r){const n=[];return Zl(!1,i,t,e,r,function(s){n.push(s)}),n}function DC(i,t,e){let r=Me.empty();return i!=="undirected"&&(t!=="out"&&typeof e.in<"u"&&(r=Ei(r,ja(e.in))),t!=="in"&&typeof e.out<"u"&&(r=Ei(r,ja(e.out,t?void 0:e.key)))),i!=="directed"&&typeof e.undirected<"u"&&(r=Ei(r,ja(e.undirected))),r}function Ql(i,t,e,r,n,s,o){const a=e?CC:IC;let h;if(t!=="undirected"&&(typeof n.in<"u"&&r!=="out"&&(h=a(i,n.in,s,o),i&&h)||typeof n.out<"u"&&r!=="in"&&(r||n.key!==s)&&(h=a(i,n.out,s,o),i&&h))||t!=="directed"&&typeof n.undirected<"u"&&(h=a(i,n.undirected,s,o),i&&h))return h}function NC(i,t,e,r,n){const s=[];return Ql(!1,i,t,e,r,n,function(o){s.push(o)}),s}function BC(i,t,e,r){let n=Me.empty();return i!=="undirected"&&(typeof e.in<"u"&&t!=="out"&&r in e.in&&(n=Ei(n,Ya(e.in,r))),typeof e.out<"u"&&t!=="in"&&r in e.out&&(t||e.key!==r)&&(n=Ei(n,Ya(e.out,r)))),i!=="directed"&&typeof e.undirected<"u"&&r in e.undirected&&(n=Ei(n,Ya(e.undirected,r))),n}function LC(i,t){const{name:e,type:r,direction:n}=t;i.prototype[e]=function(s,o){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return[];if(!arguments.length)return MC(this,r);if(arguments.length===1){s=""+s;const a=this._nodes.get(s);if(typeof a>"u")throw new $(`Graph.${e}: could not find the "${s}" node in the graph.`);return RC(this.multi,r==="mixed"?this.type:r,n,a)}if(arguments.length===2){s=""+s,o=""+o;const a=this._nodes.get(s);if(!a)throw new $(`Graph.${e}:  could not find the "${s}" source node in the graph.`);if(!this._nodes.has(o))throw new $(`Graph.${e}:  could not find the "${o}" target node in the graph.`);return NC(r,this.multi,n,a,o)}throw new V(`Graph.${e}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function OC(i,t){const{name:e,type:r,direction:n}=t,s="forEach"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[s]=function(l,u,c){if(!(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)){if(arguments.length===1)return c=l,Ng(!1,this,r,c);if(arguments.length===2){l=""+l,c=u;const d=this._nodes.get(l);if(typeof d>"u")throw new $(`Graph.${s}: could not find the "${l}" node in the graph.`);return Zl(!1,this.multi,r==="mixed"?this.type:r,n,d,c)}if(arguments.length===3){l=""+l,u=""+u;const d=this._nodes.get(l);if(!d)throw new $(`Graph.${s}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(u))throw new $(`Graph.${s}:  could not find the "${u}" target node in the graph.`);return Ql(!1,r,this.multi,n,d,u,c)}throw new V(`Graph.${s}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const o="map"+e[0].toUpperCase()+e.slice(1);i.prototype[o]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop();let c;if(l.length===0){let d=0;r!=="directed"&&(d+=this.undirectedSize),r!=="undirected"&&(d+=this.directedSize),c=new Array(d);let f=0;l.push((p,g,m,y,_,v,x)=>{c[f++]=u(p,g,m,y,_,v,x)})}else c=[],l.push((d,f,p,g,m,y,_)=>{c.push(u(d,f,p,g,m,y,_))});return this[s].apply(this,l),c};const a="filter"+e[0].toUpperCase()+e.slice(1);i.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),u=l.pop(),c=[];return l.push((d,f,p,g,m,y,_)=>{u(d,f,p,g,m,y,_)&&c.push(d)}),this[s].apply(this,l),c};const h="reduce"+e[0].toUpperCase()+e.slice(1);i.prototype[h]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new V(`Graph.${h}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new V(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let u,c;l.length===2?(u=l[0],c=l[1],l=[]):l.length===3?(u=l[1],c=l[2],l=[l[0]]):l.length===4&&(u=l[2],c=l[3],l=[l[0],l[1]]);let d=c;return l.push((f,p,g,m,y,_,v)=>{d=u(d,f,p,g,m,y,_,v)}),this[s].apply(this,l),d}}function kC(i,t){const{name:e,type:r,direction:n}=t,s="find"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[s]=function(h,l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return!1;if(arguments.length===1)return u=h,Ng(!0,this,r,u);if(arguments.length===2){h=""+h,u=l;const c=this._nodes.get(h);if(typeof c>"u")throw new $(`Graph.${s}: could not find the "${h}" node in the graph.`);return Zl(!0,this.multi,r==="mixed"?this.type:r,n,c,u)}if(arguments.length===3){h=""+h,l=""+l;const c=this._nodes.get(h);if(!c)throw new $(`Graph.${s}:  could not find the "${h}" source node in the graph.`);if(!this._nodes.has(l))throw new $(`Graph.${s}:  could not find the "${l}" target node in the graph.`);return Ql(!0,r,this.multi,n,c,l,u)}throw new V(`Graph.${s}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const o="some"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[o]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((c,d,f,p,g,m,y)=>l(c,d,f,p,g,m,y)),!!this[s].apply(this,h)};const a="every"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[a]=function(){const h=Array.prototype.slice.call(arguments),l=h.pop();return h.push((c,d,f,p,g,m,y)=>!l(c,d,f,p,g,m,y)),!this[s].apply(this,h)}}function FC(i,t){const{name:e,type:r,direction:n}=t,s=e.slice(0,-1)+"Entries";i.prototype[s]=function(o,a){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return Me.empty();if(!arguments.length)return PC(this,r);if(arguments.length===1){o=""+o;const h=this._nodes.get(o);if(!h)throw new $(`Graph.${s}: could not find the "${o}" node in the graph.`);return DC(r,n,h)}if(arguments.length===2){o=""+o,a=""+a;const h=this._nodes.get(o);if(!h)throw new $(`Graph.${s}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new $(`Graph.${s}:  could not find the "${a}" target node in the graph.`);return BC(r,n,h,a)}throw new V(`Graph.${s}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function UC(i){AC.forEach(t=>{LC(i,t),OC(i,t),kC(i,t),FC(i,t)})}const GC=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function qo(){this.A=null,this.B=null}qo.prototype.wrap=function(i){this.A===null?this.A=i:this.B===null&&(this.B=i)};qo.prototype.has=function(i){return this.A!==null&&i in this.A||this.B!==null&&i in this.B};function xn(i,t,e,r,n){for(const s in r){const o=r[s],a=o.source,h=o.target,l=a===e?h:a;if(t&&t.has(l.key))continue;const u=n(l.key,l.attributes);if(i&&u)return l.key}}function Jl(i,t,e,r,n){if(t!=="mixed"){if(t==="undirected")return xn(i,null,r,r.undirected,n);if(typeof e=="string")return xn(i,null,r,r[e],n)}const s=new qo;let o;if(t!=="undirected"){if(e!=="out"){if(o=xn(i,null,r,r.in,n),i&&o)return o;s.wrap(r.in)}if(e!=="in"){if(o=xn(i,s,r,r.out,n),i&&o)return o;s.wrap(r.out)}}if(t!=="directed"&&(o=xn(i,s,r,r.undirected,n),i&&o))return o}function $C(i,t,e){if(i!=="mixed"){if(i==="undirected")return Object.keys(e.undirected);if(typeof t=="string")return Object.keys(e[t])}const r=[];return Jl(!1,i,t,e,function(n){r.push(n)}),r}function wn(i,t,e){const r=Object.keys(e),n=r.length;let s=0;return new Me(function(){let a=null;do{if(s>=n)return i&&i.wrap(e),{done:!0};const h=e[r[s++]],l=h.source,u=h.target;if(a=l===t?u:l,i&&i.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}})}function HC(i,t,e){if(i!=="mixed"){if(i==="undirected")return wn(null,e,e.undirected);if(typeof t=="string")return wn(null,e,e[t])}let r=Me.empty();const n=new qo;return i!=="undirected"&&(t!=="out"&&(r=Ei(r,wn(n,e,e.in))),t!=="in"&&(r=Ei(r,wn(n,e,e.out)))),i!=="directed"&&(r=Ei(r,wn(n,e,e.undirected))),r}function zC(i,t){const{name:e,type:r,direction:n}=t;i.prototype[e]=function(s){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return[];s=""+s;const o=this._nodes.get(s);if(typeof o>"u")throw new $(`Graph.${e}: could not find the "${s}" node in the graph.`);return $C(r==="mixed"?this.type:r,n,o)}}function WC(i,t){const{name:e,type:r,direction:n}=t,s="forEach"+e[0].toUpperCase()+e.slice(1,-1);i.prototype[s]=function(l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return;l=""+l;const c=this._nodes.get(l);if(typeof c>"u")throw new $(`Graph.${s}: could not find the "${l}" node in the graph.`);Jl(!1,r==="mixed"?this.type:r,n,c,u)};const o="map"+e[0].toUpperCase()+e.slice(1);i.prototype[o]=function(l,u){const c=[];return this[s](l,(d,f)=>{c.push(u(d,f))}),c};const a="filter"+e[0].toUpperCase()+e.slice(1);i.prototype[a]=function(l,u){const c=[];return this[s](l,(d,f)=>{u(d,f)&&c.push(d)}),c};const h="reduce"+e[0].toUpperCase()+e.slice(1);i.prototype[h]=function(l,u,c){if(arguments.length<3)throw new V(`Graph.${h}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let d=c;return this[s](l,(f,p)=>{d=u(d,f,p)}),d}}function XC(i,t){const{name:e,type:r,direction:n}=t,s=e[0].toUpperCase()+e.slice(1,-1),o="find"+s;i.prototype[o]=function(l,u){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return;l=""+l;const c=this._nodes.get(l);if(typeof c>"u")throw new $(`Graph.${o}: could not find the "${l}" node in the graph.`);return Jl(!0,r==="mixed"?this.type:r,n,c,u)};const a="some"+s;i.prototype[a]=function(l,u){return!!this[o](l,u)};const h="every"+s;i.prototype[h]=function(l,u){return!this[o](l,(d,f)=>!u(d,f))}}function VC(i,t){const{name:e,type:r,direction:n}=t,s=e.slice(0,-1)+"Entries";i.prototype[s]=function(o){if(r!=="mixed"&&this.type!=="mixed"&&r!==this.type)return Me.empty();o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new $(`Graph.${s}: could not find the "${o}" node in the graph.`);return HC(r==="mixed"?this.type:r,n,a)}}function jC(i){GC.forEach(t=>{zC(i,t),WC(i,t),XC(i,t),VC(i,t)})}function Bs(i,t,e,r,n){const s=r._nodes.values(),o=r.type;let a,h,l,u,c,d,f;for(;a=s.next(),a.done!==!0;){let p=!1;if(h=a.value,o!=="undirected"){u=h.out;for(l in u){c=u[l];do{if(d=c.target,p=!0,f=n(h.key,d.key,h.attributes,d.attributes,c.key,c.attributes,c.undirected),i&&f)return c;c=c.next}while(c)}}if(o!=="directed"){u=h.undirected;for(l in u)if(!(t&&h.key>l)){c=u[l];do{if(d=c.target,d.key!==l&&(d=c.source),p=!0,f=n(h.key,d.key,h.attributes,d.attributes,c.key,c.attributes,c.undirected),i&&f)return c;c=c.next}while(c)}}if(e&&!p&&(f=n(h.key,null,h.attributes,null,null,null,null),i&&f))return null}}function YC(i,t){const e={key:i};return Tg(t.attributes)||(e.attributes=Kt({},t.attributes)),e}function qC(i,t,e){const r={key:t,source:e.source.key,target:e.target.key};return Tg(e.attributes)||(r.attributes=Kt({},e.attributes)),i==="mixed"&&e.undirected&&(r.undirected=!0),r}function KC(i){if(!ne(i))throw new V('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in i))throw new V("Graph.import: serialized node is missing its key.");if("attributes"in i&&(!ne(i.attributes)||i.attributes===null))throw new V("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function ZC(i){if(!ne(i))throw new V('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in i))throw new V("Graph.import: serialized edge is missing its source.");if(!("target"in i))throw new V("Graph.import: serialized edge is missing its target.");if("attributes"in i&&(!ne(i.attributes)||i.attributes===null))throw new V("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in i&&typeof i.undirected!="boolean")throw new V("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const QC=tC(),JC=new Set(["directed","undirected","mixed"]),Cd=new Set(["domain","_events","_eventsCount","_maxListeners"]),tM=[{name:i=>`${i}Edge`,generateKey:!0},{name:i=>`${i}DirectedEdge`,generateKey:!0,type:"directed"},{name:i=>`${i}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:i=>`${i}EdgeWithKey`},{name:i=>`${i}DirectedEdgeWithKey`,type:"directed"},{name:i=>`${i}UndirectedEdgeWithKey`,type:"undirected"}],eM={allowSelfLoops:!0,multi:!1,type:"mixed"};function iM(i,t,e){if(e&&!ne(e))throw new V(`Graph.addNode: invalid attributes. Expecting an object but got "${e}"`);if(t=""+t,e=e||{},i._nodes.has(t))throw new lt(`Graph.addNode: the "${t}" node already exist in the graph.`);const r=new i.NodeDataClass(t,e);return i._nodes.set(t,r),i.emit("nodeAdded",{key:t,attributes:e}),r}function Md(i,t,e){const r=new i.NodeDataClass(t,e);return i._nodes.set(t,r),i.emit("nodeAdded",{key:t,attributes:e}),r}function Bg(i,t,e,r,n,s,o,a){if(!r&&i.type==="undirected")throw new lt(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(r&&i.type==="directed")throw new lt(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!ne(a))throw new V(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`);if(s=""+s,o=""+o,a=a||{},!i.allowSelfLoops&&s===o)throw new lt(`Graph.${t}: source & target are the same ("${s}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const h=i._nodes.get(s),l=i._nodes.get(o);if(!h)throw new $(`Graph.${t}: source node "${s}" not found.`);if(!l)throw new $(`Graph.${t}: target node "${o}" not found.`);const u={key:null,undirected:r,source:s,target:o,attributes:a};if(e)n=i._edgeKeyGenerator();else if(n=""+n,i._edges.has(n))throw new lt(`Graph.${t}: the "${n}" edge already exists in the graph.`);if(!i.multi&&(r?typeof h.undirected[o]<"u":typeof h.out[o]<"u"))throw new lt(`Graph.${t}: an edge linking "${s}" to "${o}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const c=new hn(r,n,h,l,a);i._edges.set(n,c);const d=s===o;return r?(h.undirectedDegree++,l.undirectedDegree++,d&&(h.undirectedLoops++,i._undirectedSelfLoopCount++)):(h.outDegree++,l.inDegree++,d&&(h.directedLoops++,i._directedSelfLoopCount++)),i.multi?c.attachMulti():c.attach(),r?i._undirectedSize++:i._directedSize++,u.key=n,i.emit("edgeAdded",u),n}function rM(i,t,e,r,n,s,o,a,h){if(!r&&i.type==="undirected")throw new lt(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(r&&i.type==="directed")throw new lt(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(h){if(typeof a!="function")throw new V(`Graph.${t}: invalid updater function. Expecting a function but got "${a}"`)}else if(!ne(a))throw new V(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`)}s=""+s,o=""+o;let l;if(h&&(l=a,a=void 0),!i.allowSelfLoops&&s===o)throw new lt(`Graph.${t}: source & target are the same ("${s}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let u=i._nodes.get(s),c=i._nodes.get(o),d,f;if(!e&&(d=i._edges.get(n),d)){if((d.source.key!==s||d.target.key!==o)&&(!r||d.source.key!==o||d.target.key!==s))throw new lt(`Graph.${t}: inconsistency detected when attempting to merge the "${n}" edge with "${s}" source & "${o}" target vs. ("${d.source.key}", "${d.target.key}").`);f=d}if(!f&&!i.multi&&u&&(f=r?u.undirected[o]:u.out[o]),f){const _=[f.key,!1,!1,!1];if(h?!l:!a)return _;if(h){const v=f.attributes;f.attributes=l(v),i.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else Kt(f.attributes,a),i.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:a});return _}a=a||{},h&&l&&(a=l(a));const p={key:null,undirected:r,source:s,target:o,attributes:a};if(e)n=i._edgeKeyGenerator();else if(n=""+n,i._edges.has(n))throw new lt(`Graph.${t}: the "${n}" edge already exists in the graph.`);let g=!1,m=!1;u||(u=Md(i,s,{}),g=!0,s===o&&(c=u,m=!0)),c||(c=Md(i,o,{}),m=!0),d=new hn(r,n,u,c,a),i._edges.set(n,d);const y=s===o;return r?(u.undirectedDegree++,c.undirectedDegree++,y&&(u.undirectedLoops++,i._undirectedSelfLoopCount++)):(u.outDegree++,c.inDegree++,y&&(u.directedLoops++,i._directedSelfLoopCount++)),i.multi?d.attachMulti():d.attach(),r?i._undirectedSize++:i._directedSize++,p.key=n,i.emit("edgeAdded",p),[n,!0,g,m]}function Cr(i,t){i._edges.delete(t.key);const{source:e,target:r,attributes:n}=t,s=t.undirected,o=e===r;s?(e.undirectedDegree--,r.undirectedDegree--,o&&(e.undirectedLoops--,i._undirectedSelfLoopCount--)):(e.outDegree--,r.inDegree--,o&&(e.directedLoops--,i._directedSelfLoopCount--)),i.multi?t.detachMulti():t.detach(),s?i._undirectedSize--:i._directedSize--,i.emit("edgeDropped",{key:t.key,attributes:n,source:e.key,target:r.key,undirected:s})}class Pt extends zI.EventEmitter{constructor(t){if(super(),t=Kt({},eM,t),typeof t.multi!="boolean")throw new V(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!JC.has(t.type))throw new V(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new V(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const e=t.type==="mixed"?Ig:t.type==="directed"?Cg:Mg;Ae(this,"NodeDataClass",e);const r="geid_"+QC()+"_";let n=0;const s=()=>{let o;do o=r+n++;while(this._edges.has(o));return o};Ae(this,"_attributes",{}),Ae(this,"_nodes",new Map),Ae(this,"_edges",new Map),Ae(this,"_directedSize",0),Ae(this,"_undirectedSize",0),Ae(this,"_directedSelfLoopCount",0),Ae(this,"_undirectedSelfLoopCount",0),Ae(this,"_edgeKeyGenerator",s),Ae(this,"_options",t),Cd.forEach(o=>Ae(this,o,this[o])),Ne(this,"order",()=>this._nodes.size),Ne(this,"size",()=>this._edges.size),Ne(this,"directedSize",()=>this._directedSize),Ne(this,"undirectedSize",()=>this._undirectedSize),Ne(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Ne(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Ne(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Ne(this,"multi",this._options.multi),Ne(this,"type",this._options.type),Ne(this,"allowSelfLoops",this._options.allowSelfLoops),Ne(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,e){if(this.type==="undirected")return!1;if(arguments.length===1){const r=""+t,n=this._edges.get(r);return!!n&&!n.undirected}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?r.out.hasOwnProperty(e):!1}throw new V(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,e){if(this.type==="directed")return!1;if(arguments.length===1){const r=""+t,n=this._edges.get(r);return!!n&&n.undirected}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?r.undirected.hasOwnProperty(e):!1}throw new V(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,e){if(arguments.length===1){const r=""+t;return this._edges.has(r)}else if(arguments.length===2){t=""+t,e=""+e;const r=this._nodes.get(t);return r?typeof r.out<"u"&&r.out.hasOwnProperty(e)||typeof r.undirected<"u"&&r.undirected.hasOwnProperty(e):!1}throw new V(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,e){if(this.type==="undirected")return;if(t=""+t,e=""+e,this.multi)throw new lt("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const r=this._nodes.get(t);if(!r)throw new $(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.directedEdge: could not find the "${e}" target node in the graph.`);const n=r.out&&r.out[e]||void 0;if(n)return n.key}undirectedEdge(t,e){if(this.type==="directed")return;if(t=""+t,e=""+e,this.multi)throw new lt("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const r=this._nodes.get(t);if(!r)throw new $(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.undirectedEdge: could not find the "${e}" target node in the graph.`);const n=r.undirected&&r.undirected[e]||void 0;if(n)return n.key}edge(t,e){if(this.multi)throw new lt("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(e))throw new $(`Graph.edge: could not find the "${e}" target node in the graph.`);const n=r.out&&r.out[e]||r.undirected&&r.undirected[e]||void 0;if(n)return n.key}areDirectedNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.in||e in r.out}areOutNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.out}areInNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:e in r.in}areUndirectedNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:e in r.undirected}areNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(e in r.in||e in r.out)||this.type!=="directed"&&e in r.undirected}areInboundNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in r.in||this.type!=="directed"&&e in r.undirected}areOutboundNeighbors(t,e){t=""+t,e=""+e;const r=this._nodes.get(t);if(!r)throw new $(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&e in r.out||this.type!=="directed"&&e in r.undirected}inDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree}outDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree}directedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree}undirectedDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree}inboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.inDegree),r}outboundDegree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.outDegree),r}degree(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.degree: could not find the "${t}" node in the graph.`);let r=0;return this.type!=="directed"&&(r+=e.undirectedDegree),this.type!=="undirected"&&(r+=e.inDegree+e.outDegree),r}inDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree-e.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.outDegree-e.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:e.inDegree+e.outDegree-e.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:e.undirectedDegree-e.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,n=0;return this.type!=="directed"&&(r+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.inDegree,n+=e.directedLoops),r-n}outboundDegreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,n=0;return this.type!=="directed"&&(r+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.outDegree,n+=e.directedLoops),r-n}degreeWithoutSelfLoops(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let r=0,n=0;return this.type!=="directed"&&(r+=e.undirectedDegree,n+=e.undirectedLoops*2),this.type!=="undirected"&&(r+=e.inDegree+e.outDegree,n+=e.directedLoops*2),r-n}source(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.source: could not find the "${t}" edge in the graph.`);return e.source.key}target(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.target: could not find the "${t}" edge in the graph.`);return e.target.key}extremities(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[e.source.key,e.target.key]}opposite(t,e){t=""+t,e=""+e;const r=this._edges.get(e);if(!r)throw new $(`Graph.opposite: could not find the "${e}" edge in the graph.`);const n=r.source.key,s=r.target.key;if(t===n)return s;if(t===s)return n;throw new $(`Graph.opposite: the "${t}" node is not attached to the "${e}" edge (${n}, ${s}).`)}hasExtremity(t,e){t=""+t,e=""+e;const r=this._edges.get(t);if(!r)throw new $(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return r.source.key===e||r.target.key===e}isUndirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return e.undirected}isDirected(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!e.undirected}isSelfLoop(t){t=""+t;const e=this._edges.get(t);if(!e)throw new $(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return e.source===e.target}addNode(t,e){return iM(this,t,e).key}mergeNode(t,e){if(e&&!ne(e))throw new V(`Graph.mergeNode: invalid attributes. Expecting an object but got "${e}"`);t=""+t,e=e||{};let r=this._nodes.get(t);return r?(e&&(Kt(r.attributes,e),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:r.attributes,data:e})),[t,!1]):(r=new this.NodeDataClass(t,e),this._nodes.set(t,r),this.emit("nodeAdded",{key:t,attributes:e}),[t,!0])}updateNode(t,e){if(e&&typeof e!="function")throw new V(`Graph.updateNode: invalid updater function. Expecting a function but got "${e}"`);t=""+t;let r=this._nodes.get(t);if(r){if(e){const s=r.attributes;r.attributes=e(s),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:r.attributes})}return[t,!1]}const n=e?e({}):{};return r=new this.NodeDataClass(t,n),this._nodes.set(t,r),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0]}dropNode(t){t=""+t;const e=this._nodes.get(t);if(!e)throw new $(`Graph.dropNode: could not find the "${t}" node in the graph.`);let r;if(this.type!=="undirected"){for(const n in e.out){r=e.out[n];do Cr(this,r),r=r.next;while(r)}for(const n in e.in){r=e.in[n];do Cr(this,r),r=r.next;while(r)}}if(this.type!=="directed")for(const n in e.undirected){r=e.undirected[n];do Cr(this,r),r=r.next;while(r)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:e.attributes})}dropEdge(t){let e;if(arguments.length>1){const r=""+arguments[0],n=""+arguments[1];if(e=Ce(this,r,n,this.type),!e)throw new $(`Graph.dropEdge: could not find the "${r}" -> "${n}" edge in the graph.`)}else if(t=""+t,e=this._edges.get(t),!e)throw new $(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return Cr(this,e),this}dropDirectedEdge(t,e){if(arguments.length<2)throw new lt("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new lt("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,e=""+e;const r=Ce(this,t,e,"directed");if(!r)throw new $(`Graph.dropDirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Cr(this,r),this}dropUndirectedEdge(t,e){if(arguments.length<2)throw new lt("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new lt("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const r=Ce(this,t,e,"undirected");if(!r)throw new $(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${e}" edge in the graph.`);return Cr(this,r),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let e;for(;e=t.next(),e.done!==!0;)e.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,e){return this._attributes[t]=e,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,e){if(typeof e!="function")throw new V("Graph.updateAttribute: updater should be a function.");const r=this._attributes[t];return this._attributes[t]=e(r),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!ne(t))throw new V("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!ne(t))throw new V("Graph.mergeAttributes: provided attributes are not a plain object.");return Kt(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new V("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,e){if(typeof t!="function")throw new V("Graph.updateEachNodeAttributes: expecting an updater function.");if(e&&!Id(e))throw new V("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const r=this._nodes.values();let n,s;for(;n=r.next(),n.done!==!0;)s=n.value,s.attributes=t(s.key,s.attributes);this.emit("eachNodeAttributesUpdated",{hints:e||null})}updateEachEdgeAttributes(t,e){if(typeof t!="function")throw new V("Graph.updateEachEdgeAttributes: expecting an updater function.");if(e&&!Id(e))throw new V("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const r=this._edges.values();let n,s,o,a;for(;n=r.next(),n.done!==!0;)s=n.value,o=s.source,a=s.target,s.attributes=t(s.key,s.attributes,o.key,a.key,o.attributes,a.attributes,s.undirected);this.emit("eachEdgeAttributesUpdated",{hints:e||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new V("Graph.forEachAdjacencyEntry: expecting a callback.");Bs(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new V("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");Bs(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new V("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");Bs(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new V("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");Bs(!1,!0,!0,this,t)}nodes(){return typeof Array.from=="function"?Array.from(this._nodes.keys()):Sg(this._nodes.keys(),this._nodes.size)}forEachNode(t){if(typeof t!="function")throw new V("Graph.forEachNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)n=r.value,t(n.key,n.attributes)}findNode(t){if(typeof t!="function")throw new V("Graph.findNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)if(n=r.value,t(n.key,n.attributes))return n.key}mapNodes(t){if(typeof t!="function")throw new V("Graph.mapNode: expecting a callback.");const e=this._nodes.values();let r,n;const s=new Array(this.order);let o=0;for(;r=e.next(),r.done!==!0;)n=r.value,s[o++]=t(n.key,n.attributes);return s}someNode(t){if(typeof t!="function")throw new V("Graph.someNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)if(n=r.value,t(n.key,n.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new V("Graph.everyNode: expecting a callback.");const e=this._nodes.values();let r,n;for(;r=e.next(),r.done!==!0;)if(n=r.value,!t(n.key,n.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new V("Graph.filterNodes: expecting a callback.");const e=this._nodes.values();let r,n;const s=[];for(;r=e.next(),r.done!==!0;)n=r.value,t(n.key,n.attributes)&&s.push(n.key);return s}reduceNodes(t,e){if(typeof t!="function")throw new V("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new V("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let r=e;const n=this._nodes.values();let s,o;for(;s=n.next(),s.done!==!0;)o=s.value,r=t(r,o.key,o.attributes);return r}nodeEntries(){const t=this._nodes.values();return new Me(()=>{const e=t.next();if(e.done)return e;const r=e.value;return{value:{node:r.key,attributes:r.attributes},done:!1}})}export(){const t=new Array(this._nodes.size);let e=0;this._nodes.forEach((n,s)=>{t[e++]=YC(s,n)});const r=new Array(this._edges.size);return e=0,this._edges.forEach((n,s)=>{r[e++]=qC(this.type,s,n)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:r}}import(t,e=!1){if(t instanceof Pt)return t.forEachNode((h,l)=>{e?this.mergeNode(h,l):this.addNode(h,l)}),t.forEachEdge((h,l,u,c,d,f,p)=>{e?p?this.mergeUndirectedEdgeWithKey(h,u,c,l):this.mergeDirectedEdgeWithKey(h,u,c,l):p?this.addUndirectedEdgeWithKey(h,u,c,l):this.addDirectedEdgeWithKey(h,u,c,l)}),this;if(!ne(t))throw new V("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!ne(t.attributes))throw new V("Graph.import: invalid attributes. Expecting a plain object.");e?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let r,n,s,o,a;if(t.nodes){if(s=t.nodes,!Array.isArray(s))throw new V("Graph.import: invalid nodes. Expecting an array.");for(r=0,n=s.length;r<n;r++){o=s[r],KC(o);const{key:h,attributes:l}=o;e?this.mergeNode(h,l):this.addNode(h,l)}}if(t.edges){let h=!1;if(this.type==="undirected"&&(h=!0),s=t.edges,!Array.isArray(s))throw new V("Graph.import: invalid edges. Expecting an array.");for(r=0,n=s.length;r<n;r++){a=s[r],ZC(a);const{source:l,target:u,attributes:c,undirected:d=h}=a;let f;"key"in a?(f=e?d?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:d?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,a.key,l,u,c)):(f=e?d?this.mergeUndirectedEdge:this.mergeDirectedEdge:d?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,u,c))}}return this}nullCopy(t){const e=new Pt(Kt({},this._options,t));return e.replaceAttributes(Kt({},this.getAttributes())),e}emptyCopy(t){const e=this.nullCopy(t);return this._nodes.forEach((r,n)=>{const s=Kt({},r.attributes);r=new e.NodeDataClass(n,s),e._nodes.set(n,r)}),e}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new lt(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new lt("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new lt("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const e=this.emptyCopy(t),r=this._edges.values();let n,s;for(;n=r.next(),n.done!==!0;)s=n.value,Bg(e,"copy",!1,s.undirected,s.key,s.source.key,s.target.key,Kt({},s.attributes));return e}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((s,o)=>{t[o]=s.attributes});const e={},r={};this._edges.forEach((s,o)=>{const a=s.undirected?"--":"->";let h="",l=s.source.key,u=s.target.key,c;s.undirected&&l>u&&(c=l,l=u,u=c);const d=`(${l})${a}(${u})`;o.startsWith("geid_")?this.multi&&(typeof r[d]>"u"?r[d]=0:r[d]++,h+=`${r[d]}. `):h+=`[${o}]: `,h+=d,e[h]=s.attributes});const n={};for(const s in this)this.hasOwnProperty(s)&&!Cd.has(s)&&typeof this[s]!="function"&&typeof s!="symbol"&&(n[s]=this[s]);return n.attributes=this._attributes,n.nodes=t,n.edges=e,Ae(n,"constructor",this.constructor),n}}typeof Symbol<"u"&&(Pt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Pt.prototype.inspect);tM.forEach(i=>{["add","merge","update"].forEach(t=>{const e=i.name(t),r=t==="add"?Bg:rM;i.generateKey?Pt.prototype[e]=function(n,s,o){return r(this,e,!0,(i.type||this.type)==="undirected",null,n,s,o,t==="update")}:Pt.prototype[e]=function(n,s,o,a){return r(this,e,!1,(i.type||this.type)==="undirected",n,s,o,a,t==="update")}})});dC(Pt);EC(Pt);UC(Pt);jC(Pt);class Lg extends Pt{constructor(t){const e=Kt({type:"directed"},t);if("multi"in e&&e.multi!==!1)throw new V("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="directed")throw new V('DirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class Og extends Pt{constructor(t){const e=Kt({type:"undirected"},t);if("multi"in e&&e.multi!==!1)throw new V("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(e.type!=="undirected")throw new V('UndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class kg extends Pt{constructor(t){const e=Kt({multi:!0},t);if("multi"in e&&e.multi!==!0)throw new V("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(e)}}class Fg extends Pt{constructor(t){const e=Kt({type:"directed",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new V("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="directed")throw new V('MultiDirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}class Ug extends Pt{constructor(t){const e=Kt({type:"undirected",multi:!0},t);if("multi"in e&&e.multi!==!0)throw new V("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(e.type!=="undirected")throw new V('MultiUndirectedGraph.from: inconsistent "'+e.type+'" type in given options!');super(e)}}function ln(i){i.from=function(t,e){const r=Kt({},t.options,e),n=new i(r);return n.import(t),n}}ln(Pt);ln(Lg);ln(Og);ln(kg);ln(Fg);ln(Ug);Pt.Graph=Pt;Pt.DirectedGraph=Lg;Pt.UndirectedGraph=Og;Pt.MultiGraph=kg;Pt.MultiDirectedGraph=Fg;Pt.MultiUndirectedGraph=Ug;Pt.InvalidArgumentsGraphError=V;Pt.NotFoundGraphError=$;Pt.UsageGraphError=lt;function nM(i,t){const e={id:"ROOT"},r=[...new Set(i.filter(d=>d.SUBMODULE>t).map(d=>d.SUBMODULE))].filter(d=>d).map(d=>{const f=i.find(p=>p.SUBMODULE===d);return{id:"submodule-"+d,parent:"ROOT",NAME:f.SUBMODULE_NAME,type:"tier1"}}),n=[...new Set(i.filter(d=>d.SEGMENT&&d.SUBMODULE&&+d.SUBMODULE>t).map(d=>d.SUBMODULE+"_"+d.SEGMENT))].filter(d=>d!=="null_null").map(d=>{const f=i.find(p=>p.SUBMODULE===+d.split("_")[0]&&p.SEGMENT===+d.split("_")[1]);return{id:"segment-"+d,parent:"submodule-"+d.split("_")[0],NAME:f.SEGMENT_NAME,type:"tier2"}});let s=[e];i.forEach(d=>{let f;d.type==="tier1"?f="ROOT":d.type==="tier2"?f="submodule-"+d.SUBMODULE:f="segment-"+d.SUBMODULE+"_"+d.SEGMENT,s.push({parent:f,id:d.id,NAME:d.NAME,type:d.type})}),s=s.concat(r).concat(n);const o={},a=[];s.forEach(d=>{o[d.id]=d});for(const d in o)a.push(o[d]);s=a;function h(d,f){d.append("span").text(f.NAME),!(f.parent==="ROOT"||f.type==="tier1"||f.type==="tier2")&&d.append("input").attr("type","checkbox")}function l(d,f){const p=d.append("span").attr("class","list-label-"+f.depth);if(p.append("span").classed("arrow",!0),p.call(h,f.data),!f.hasOwnProperty("children"))return;const g=d.append("ul").style("list-style-type","none").selectAll("li").data(f.children,m=>m.NAME);g.exit().remove(),g.enter().append("li").attr("class","list-item-"+f.depth).style("cursor","pointer").merge(g).each(function(m){Vt(this).call(l,m)}),p.select(".arrow").text(" ")}function u(d){d.classed("viewport",!0).style("overflow-y","scroll").style("height","calc(100vh - 170px)").append("div").classed("body",!0).style("transform","scale(1.5)").style("transform-origin","top left")}function c(d,f){const p=BT().id(g=>g.id).parentId(g=>g.parent)(f);p.eachBefore(g=>{g.children&&g.children.sort((m,y)=>m.data.id.localeCompare(y.data.id))}),d.select(".body").call(l,p),d.select(".body > span").remove(),d.select(".body > ul").style("padding-left",0)}Vt("#view div").remove(),Vt("#view").append("div").call(u).call(c,s)}async function sM({nodes:i,links:t},{containerSelector:e,nodeId:r="id",sourceId:n="source",targetId:s="target",nodeGroup:o,nodeGroups:a,nodeRadius:h,nodeTitle:l,nodeFill:u="0xFFFFFF",nodeStroke:c="0xFFFFFF",nodeStrokeWidth:d=4,nodeFillOpacity:f=1,nodeStrokeOpacity:p=1,nodeMinSize:g=6,linkStroke:m="0xFFFFFF",linkStrokeOpacity:y=.7,linkStrokeWidth:_=1.5,labelColor:v="white",labelScale:x=2,colors:E=KT,width:N=640,height:I=400,tooltipStyles:S={width:"300px",height:"auto",padding:"10px","background-color":"white",border:"1px solid black","z-index":10}}={}){console.log("received data",i,t);const D=0;let U=0,L={},C={},b=[],R=[],tt=["NAME","Parameter Explanation","SUBMODULE_NAME","SEGMENT_NAME"],et=[],Z=0,at,gt=!1,k=!1,F=!1,ct=!0,bt=!1,yt=!0,St=!1,Rt=!0,Gt=1,$t="Whole";const le=Ve(i,w=>w[r]).map(Mr),Yt=Ve(t,w=>w[n]).map(Mr),Dt=Ve(t,w=>w[s]).map(Mr);i=Ve(i,(w,M)=>({id:le[M],...w,type:"tier3"})),t=Ve(t,(w,M)=>({source:Yt[M],target:Dt[M]}));const Nt=[...new Set(i.filter(w=>w.SUBMODULE>D).map(w=>w.SUBMODULE))].filter(w=>w).map(w=>{L["submodule-"+w]=0,C[w]=ct?1:0;const M=i.find(j=>j.SUBMODULE===w);return{id:"submodule-"+w,NAME:M?M.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE_NAME:M?M.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE:w,type:"tier1"}}),It=[...new Set(i.filter(w=>w.SUBMODULE>D).map(w=>w.SUBMODULE+"_"+w.SEGMENT))].filter(w=>w!=="null_null").map(w=>{L["segment-"+w]=0,C[w]=ct?0:1;const M=i.find(j=>j.SUBMODULE===+w.split("_")[0]&&j.SEGMENT===+w.split("_")[1]);return{id:"segment-"+w,NAME:M?M.SEGMENT_NAME.split(",")[0]:"",SUBMODULE_NAME:M?M.SUBMODULE_NAME.split(",")[0]:"",SUBMODULE:+w.split("_")[0],SEGMENT_NAME:M?M.SEGMENT_NAME.split(",")[0]:"",SEGMENT:+w.split("_")[1],type:"tier2"}});for(let w=0;w<i.length;w++)L[i[w].id]=0;for(let w=0;w<t.length;w++){let M=t[w];const j=i.find(z=>z.id===M.source),P=i.find(z=>z.id===M.target);L[M.target]++,L["segment-"+P.SUBMODULE+"_"+P.SEGMENT]++,L["submodule-"+P.SUBMODULE]++,M.sourceSegment=j.SEGMENT,M.targetSegment=P.SEGMENT,M.sourceSubmodule=j.SUBMODULE,M.targetSubmodule=P.SUBMODULE}let ye=Yi(i,t,!0,"SUBMODULE",D),A=Yi(i.concat(It),t,ct,"SUBMODULE",D),hi=[...ye.nodes],se=[...ye.links],li=[...ye.nodes,...It,...Nt];const tu=YT().domain(h?Hb(i,h):[0,r1(Object.values(L))]).range([g,g*5]).clamp(!0),rs=Vt(e).append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden");for(const w in S)rs.style(w,S[w]);const ze=Vt(e).append("div").attr("class","message");if(ze.append("h2").attr("class","clickedNodes-1"),ze.append("h2").attr("class","clickedNodes-2"),ze.append("h3").attr("class","shortestPath-status").style("color","white"),ze.append("h3").attr("class","clickedNodes-reset").attr("text-decoration","underline").attr("pointer-events","auto").style("cursor","pointer").style("color","white").html("RESET").on("click",function(){br()}),window.location.href.includes("?state=%")){let w=window.location.href.split("?state=%")[1].split("-");w[0]=w[0].slice(2),w[w.length-1]=w[w.length-1].slice(0,-3),A.nodes=li.filter(P=>Pr(w,P.NAME.toString())),A.links=se.filter(P=>Ls(w,P));for(let P=0;P<A.nodes.length;P++)iu(A.nodes[P]),ru(A.nodes[P]),nu(A.nodes[P]);const M=A.nodes.map(P=>P.id);let j=[];for(let P=0;P<A.links.length;P++)Ls(M,A.links[P])&&j.push(A.links[P]);A.links=j,Nt.map(P=>{C[P.SUBMODULE]=1}),It.map(P=>{C[P.SEGMENT]=0})}const We=ZS().force("link",zS().id(w=>w.id)).force("x",QS(w=>w.x)).force("y",JS(w=>w.y)).force("collide",$S().radius(w=>w.type==="tier1"||w.type==="tier2"?w.radius*2:w.radius).iterations(3)).force("cluster",zg().strength(.45)),Ee=new Qf({width:N,height:I,resolution:2,transparent:!0,antialias:!0,autoDensity:!0,autoStart:!0});document.querySelector(e).appendChild(Ee.view);const ue=new Lb({screenWidth:N,screenHeight:I,worldWidth:N,worldHeight:I,events:Ee.renderer.events});Ee.stage.eventMode="static",Ee.stage.hitArea=Ee.screen;const eu=()=>{Ee.stage.off("pointermove"),ue.pause=!1};Ee.stage.on("pointerup",eu),Ee.stage.on("pointerupoutside",eu),Ee.stage.addChild(ue),ue.drag().pinch().wheel().decelerate().clampZoom({minScale:.2,maxScale:5}),ue.center=new ot(0,0);const ns=new mo;ns.beginFill(u),ns.lineStyle(d,c,p),ns.drawCircle(0,0,44);const Gg=Ee.renderer.generateTexture(ns,{resolution:2}),Vi=new mo;let un=12;Vi.beginFill(16777215,1),Vi.lineStyle(0,16777215,1),Vi.moveTo(-un,0),Vi.lineTo(un,un),Vi.lineTo(un,-un),Vi.endFill();const $g=Ee.renderer.generateTexture(Vi,{resolution:2}),Ko=new ie;ue.addChild(Ko);const Zo=new ie;ue.addChild(Zo);const Qo=new ie;ue.addChild(Qo);let ui=new WeakMap,Jo=new WeakMap,ji=new WeakMap,Ci=new WeakMap;wr(!0),Wg();function wr(w){const M=[],j=new Set;for(let G=0;G<A.links.length;G++){let H=A.links[G];if(Object.keys(H).length===0)continue;const X=`${ce(H)}-${oe(H)}`;!j.has(X)&&ce(H)!==oe(H)&&(j.add(X),M.push(H))}A.links=M,l===void 0?Ve(A.nodes,G=>G.NAME).map(Mr):Ve(A.nodes,l).map(Mr);const P=o==null?null:Ve(A.nodes,o).map(Mr),z=typeof _!="function"?null:Ve(A.links,_),nt=typeof m!="function"?null:Ve(A.links,m);P&&a===void 0&&(a=Kb(P));const ht=o==null?null:Jp(a,E);for(let G=0;G<A.nodes.length;G++){let H=A.nodes[G];if(H.linkCnt=L[H.id]||0,H.color=P?ht(P[G]):u,H.radius=tu(H.linkCnt),R.length>0){let X=R.find(dt=>dt.id===H.SUBMODULE+"_"+H.SEGMENT)||R.find(dt=>dt.id===H.SUBMODULE);X&&!H.x&&!H.y&&(H.x=X.x,H.y=X.y)}}for(let G=0;G<A.links.length;G++){let H=A.links[G];H.linkStroke=nt?nt[G]:m,H.linkStrokeWidth=z?z[G]:_}console.log("elements on screen",A);const pt=Dd(A.nodes,A.links),B=()=>{const G=ue.scale.x,X=[1,2,3,1/0].findIndex(dt=>G<=dt);for(let dt=0;dt<A.nodes.length;dt++){const xt=ji.get(A.nodes[dt]);xt.visible=A.nodes[dt].type==="tier1"||A.nodes[dt].type==="tier2"?1:X>=3}},K=(G,H)=>{G.fx=H.x,G.fy=H.y,cn()},Et=G=>{ue.pause=!0,Ee.stage.on("pointermove",function(H){K(G,ue.toWorld(H.global))})},st=G=>{console.log("double click on node"),G.type==="tier1"||C[G.SUBMODULE+"_"+G.SEGMENT]===1&&C[G.SUBMODULE]===0?(console.log("expand"),ea(G)):(console.log("collapse"),ta(G))},Ct=G=>{if(et.length<2&&(et.indexOf(G.id)===-1?et.push(G.id):et.splice(G.id,1)),ou(et),et.length===2){const H=Pd(pt,et);k=!0,H?ia(H):Vt(".shortestPath-status").html("No shortest path found. Would you like to try again?"),document.querySelectorAll('input[type="checkbox"]').forEach(X=>X.disabled=!0)}},At=G=>{hu(G);const H=Rd(pt,[G],Gt);ia(H),ze.style("visibility","visible"),F=!0};let vt=[];for(let G=0;G<li.length;G++){let H=li[G],X=ui.get(H),dt=ji.get(H);if(A.nodes.findIndex(xt=>xt.id===H.id)===-1)X&&Zo.removeChild(X),dt&&Qo.removeChild(dt);else{if(!X){X=new ie,X.name=H.id,X.cursor="pointer",X.hitArea=new Yn(0,0,H.radius+2),X.eventMode="static",X.visible=!Pr(b,H.id),X.on("pointerdown",function(Ht){Z++;const Qt=Jo.get(Ht.currentTarget);Z===1?St?at=setTimeout(function(){Ct(Qt),Z=0},300):yt?at=setTimeout(function(){At(Qt),Z=0},300):(Et(Qt),at=setTimeout(function(){Z=0},300)):Z===2&&!St&&!yt&&(clearTimeout(at),st(Qt),Z=0)}),X.on("mouseover",Ht=>hu(Jo.get(Ht.currentTarget))),X.on("mouseout",()=>rs.style("visibility","hidden"));const xt=new bi(Gg);xt.name="CIRCLE",xt.x=-H.radius,xt.y=-H.radius,xt.tint=H.color,xt.alpha=f,xt.width=H.radius*2,xt.height=H.radius*2,X.addChild(xt),Zo.addChild(X)}if(!dt){dt=new ie,dt.visible=H.type==="tier1"||H.type==="tier2";const xt=new Si({fontFamily:"Lato",fontSize:H.radius*x,align:"left",fill:v,stroke:"black",strokeThickness:6}),Ht=new bl(H.NAME,xt);Ht.name="LABEL";const Qt=mi.measureText(H.NAME,xt);Ht.x=-Qt.width/4,Ht.y=3,Ht.resolution=2,Ht.scale.set(.5),dt.addChild(Ht),Qo.addChild(dt)}vt.push([H,X,dt])}}Ko.removeChildren();let Ot=[];for(let G=0;G<A.links.length;G++){let H=A.links[G];const X=H.linkStrokeWidth,dt=A.nodes.find(dn=>dn.id===oe(H)),xt=new ie;xt.name=ce(H)+"-"+oe(H),xt.pivot.set(0,X/2),xt.alpha=A.links.length>200?.3:y;const Ht=new bi(Q.WHITE);Ht.name="LINE",Ht.x=dt?dt.radius:0,Ht.y=-X/2,Ht.height=X,xt.addChild(Ht);const Qt=new bi($g);Qt.name="ARROW",Qt.x=dt?dt.radius:0,Qt.y=-3,Qt.width=6,Qt.height=6,Qt.alpha=bt?1:0,xt.addChild(Qt),Ko.addChild(xt),Ot.push([H,xt])}ui=new WeakMap(vt.map(([G,H,X])=>[G,H])),Jo=new WeakMap(vt.map(([G,H,X])=>[H,G])),ji=new WeakMap(vt.map(([G,H,X])=>[G,X])),new WeakMap(vt.map(([G,H,X])=>[X,G])),Ci=new WeakMap(Ot.map(([G,H])=>[G,H])),new WeakMap(Ot.map(([G,H])=>[H,G])),We.nodes(A.nodes).force("link").links(A.links),w?(console.log("run static graph layout"),We.force("charge",dd().strength(ct?-100:-250)),We.alphaTarget(.1).restart(),We.tick(Math.ceil(Math.log(We.alphaMin())/Math.log(1-We.alphaDecay()))),cn()):(console.log("reheat graph"),We.force("charge",dd().strength(ct?-100:-150).distanceMin(100)),We.alphaTarget(.2).alphaDecay(ct?.5:.3).restart(),We.on("tick",()=>cn())),R=A.nodes.filter(G=>G.type==="tier1"||G.type==="tier2").map(G=>({x:G.x,y:G.y,id:G.type==="tier1"?G.SUBMODULE:G.SUBMODULE+"_"+G.SEGMENT})),ue.on("zoomed-end",()=>{if(ue.dirty){if(k||gt||F)return;B(),ue.dirty=!1}}),nM(A.nodes,D),Xg(A.nodes),document.querySelector(".viewport").scrollTo(0,U),$a(".list-label-2").on("click",function(G,H){if(k||gt||F)return;G.preventDefault(),G.stopPropagation(),U=document.querySelector(".viewport").scrollTop;let X=H.data;X.SUBMODULE=+X.id.split("-")[1].split("_")[0],X.SEGMENT=+X.id.split("-")[1].split("_")[1],Vt(this).select(".arrow").text()!==" "?(console.log("expand segment to variable nodes",X.type),ea(X)):(console.log("collapse variable nodes to segment"),X.type="tier3",ta(X));const dt=Vt(Vt(this).node().parentNode).select("ul");if(dt.size()){const xt=dt.style("display")!=="none";Vt(this).select(".arrow").text(xt?" ":" ")}}),$a(".list-label-1").on("click",function(G,H){if(k||gt||F)return;G.preventDefault(),G.stopPropagation(),U=document.querySelector(".viewport").scrollTop;let X=H.data;X.SUBMODULE=+X.id.split("-")[1].split("_")[0],Vt(this).select(".arrow").text()!==" "?(console.log("expand submodule to segments",X.type),ea(X)):(console.log("collapse segments to submodules"),X.type="tier2",ta(X));const dt=Vt(Vt(this).node().parentNode).select("ul");if(dt.size()){const xt=dt.style("display")!=="none";Vt(this).select(".arrow").text(xt?" ":" ")}}),$a(".list-label-3 input").on("change",function(G,H){G.preventDefault(),G.stopPropagation();const X=oM(Vt("#view"));if(console.log("checkbox click",X),X.length===0)return br();let dt=[];if(yt&&(dt=Rd(pt,X,Gt)),St&&(ou(X),dt=Pd(pt,X),X.length===2&&(k=!0,document.querySelectorAll('input[type="checkbox"]').forEach(xt=>xt.disabled=!0))),!yt&&!St){const xt=X[X.length-1],Ht=A.nodes.find(Qt=>Qt.NAME===xt);au(Ht),su(Ht.NAME)}dt&&dt.length>0&&ia(dt)});function cn(){for(let G=0;G<A.nodes.length;G++){let H=A.nodes[G];const X=ui.get(H),dt=ji.get(H);X.x=H.x,X.y=H.y,dt.x=H.x,dt.y=H.y}for(let G=0;G<A.links.length;G++){let H=A.links[G];const X=A.nodes.find(dn=>dn.id===oe(H)),dt=A.nodes.find(dn=>dn.id===ce(H)),xt=Ci.get(H);xt.x=X.x,xt.y=X.y,xt.rotation=Math.atan2(dt.y-X.y,dt.x-X.x);const Ht=xt.getChildByName("LINE"),Qt=Math.max(Math.sqrt((dt.x-X.x)**2+(dt.y-X.y)**2)-X.radius-dt.radius,0);Ht.width=Qt}}}function Hg(w){let M=0,j=0,P=0;for(const z of w){let nt=tu(z.linkCnt)**2;M+=z.x*nt,j+=z.y*nt,P+=nt}return{x:M/P,y:j/P}}function zg(){var w=.8;let M;function j(P){const z=jb(M,Hg,o),nt=P*w;for(const ht of M){const{x:pt,y:B}=z.get(ht.SUBMODULE);ht.vx-=(ht.x-pt)*nt,ht.vy-=(ht.y-B)*nt}}return j.initialize=P=>M=P,j.strength=function(P){return arguments.length?(w=+P,j):w},j}function Yi(w,M,j,P,z,nt){let ht=w.filter(K=>K[P]>z);j&&(ht=ht.filter(K=>K.type!=="tier1"&&K.type!=="tier2"));const pt=ht.map(K=>K.id),B=M.filter(K=>Ls(pt,K));if(j===!1){const K=ht.filter(st=>nt==="Quilt"?st.type==="tier1":st.type==="tier2"),Et=[];return B.forEach(st=>{if(nt==="Quilt"){const Ct=Et.map(vt=>vt.sourceSubmodule+"_"+vt.targetSubmodule),At=st.sourceSubmodule+"_"+st.targetSubmodule;Ct.indexOf(At)===-1&&st.sourceSubmodule!==null&&st.targetSubmodule!==null&&Et.push({source:"submodule-"+st.sourceSubmodule,target:"submodule-"+st.targetSubmodule,sourceSegment:st.sourceSubmodule,targetSegment:st.targetSubmodule,sourceSubmodule:st.sourceSubmodule,targetSubmodule:st.targetSubmodule,type:"tier1"})}else{const Ct=Et.map(vt=>vt.sourceSubmodule+"_"+vt.sourceSegment+"_"+vt.targetSubmodule+"_"+vt.targetSegment),At=st.sourceSubmodule+"_"+st.sourceSegment+"_"+st.targetSubmodule+"_"+st.targetSegment;Ct.indexOf(At)===-1&&st.sourceSubmodule!==null&&st.sourceSegment!==null&&st.targetSubmodule!==null&&st.targetSegment!==null&&Et.push({source:"segment-"+st.sourceSubmodule+"_"+st.sourceSegment,target:"segment-"+st.targetSubmodule+"_"+st.targetSegment,sourceSegment:st.sourceSegment,targetSegment:st.targetSegment,sourceSubmodule:st.sourceSubmodule,targetSubmodule:st.targetSubmodule,type:"tier2"})}}),{nodes:K,links:Et}}return{nodes:ht,links:B}}function ta(w){if(w.type!=="tier1"){if(w.type==="tier2"){const M="submodule-"+w.SUBMODULE;A.nodes=A.nodes.filter(P=>P.SUBMODULE!==w.SUBMODULE),A.links=A.links.filter(P=>P.source.SUBMODULE!==w.SUBMODULE&&P.target.SUBMODULE!==w.SUBMODULE);const j=Nt.find(P=>P.id===M);A.nodes.push(j),iu(w),C[w.SUBMODULE]=0}if(w.type==="tier3"){const M=hi.filter(B=>B.SUBMODULE===w.SUBMODULE&&B.SEGMENT===w.SEGMENT).map(B=>B.id),j=A.nodes.map(B=>B.id);let P=[];A.links.forEach(B=>{M.indexOf(ce(B))!==-1&&P.push(B),M.indexOf(oe(B))!==-1&&P.push(B),j.indexOf(ce(B))===-1&&P.push(B),j.indexOf(oe(B))===-1&&P.push(B)}),A.nodes=A.nodes.filter(B=>M.indexOf(B.id)===-1),A.links=A.links.filter(B=>P.indexOf(B)===-1);const z=se.filter(B=>B.sourceSubmodule===w.SUBMODULE&&B.sourceSegment===w.SEGMENT),nt=se.filter(B=>B.targetSubmodule===w.SUBMODULE&&B.targetSegment===w.SEGMENT),ht="segment-"+w.SUBMODULE+"_"+w.SEGMENT,pt=It.find(B=>B.id===ht);A.nodes.push(pt),nt.forEach(B=>{const K="segment-"+B.sourceSubmodule+"_"+B.sourceSegment,Et="submodule-"+B.sourceSubmodule,st=ce(B);let Ct={};A.nodes.findIndex(At=>At.id===st)!==-1?Ct={source:st,target:ht}:A.nodes.findIndex(At=>At.id===K)!==-1?Ct={source:K,target:ht}:A.nodes.findIndex(At=>At.id===Et)!==-1&&(Ct={source:Et,target:ht}),A.links.push(Ct)}),z.forEach(B=>{const K="segment-"+B.targetSubmodule+"_"+B.targetSegment,Et="submodule-"+B.targetSubmodule,st=oe(B);let Ct={};A.nodes.findIndex(At=>At.id===st)!==-1?Ct={source:ht,target:st}:A.nodes.findIndex(At=>At.id===K)!==-1?Ct={source:ht,target:K}:A.nodes.findIndex(At=>At.id===Et)!==-1&&(Ct={source:ht,target:Et}),A.links.push(Ct)}),C[w.SUBMODULE+"_"+w.SEGMENT]=1,C[w.SUBMODULE]=1}qa(A.nodes.map(M=>M.NAME).join("-")),wr()}}function iu(w){const M="submodule-"+w.SUBMODULE,j=se.filter(z=>z.sourceSubmodule===w.SUBMODULE);se.filter(z=>z.targetSubmodule===w.SUBMODULE).forEach(z=>{const nt="segment-"+z.sourceSubmodule+"_"+z.sourceSegment,ht="submodule-"+z.sourceSubmodule,pt=ce(z);let B={};A.nodes.findIndex(K=>K.id===pt)!==-1?B={source:pt,target:M}:A.nodes.findIndex(K=>K.id===nt)!==-1?B={source:nt,target:M}:A.nodes.findIndex(K=>K.id===ht)!==-1&&(B={source:ht,target:M}),A.links.push(B)}),j.forEach(z=>{const nt="segment-"+z.targetSubmodule+"_"+z.targetSegment,ht="submodule-"+z.targetSubmodule,pt=oe(z);let B={};A.nodes.findIndex(K=>K.id===pt)!==-1?B={source:M,target:pt}:A.nodes.findIndex(K=>K.id===nt)!==-1?B={source:M,target:nt}:A.nodes.findIndex(K=>K.id===ht)!==-1&&(B={source:M,target:ht}),A.links.push(B)})}function ea(w){if(w.type!=="tier3"){if(w.type==="tier1"){C[w.SUBMODULE]=0;const M=It.filter(j=>j.SUBMODULE===w.SUBMODULE);M.forEach(j=>{C[j.SUBMODULE+"_"+j.SEGMENT]=1}),A.nodes=A.nodes.concat(M),A.nodes=A.nodes.filter(j=>j.id!=="submodule-"+w.SUBMODULE),A.links=A.links.filter(j=>ce(j)!=="submodule-"+w.SUBMODULE&&oe(j)!=="submodule-"+w.SUBMODULE),ru(w)}if(w.type==="tier2"){const M=w.id;C[w.SUBMODULE+"_"+w.SEGMENT]=0,A.nodes=A.nodes.filter(nt=>nt.id!==M&&nt.id!=="submodule-"+w.SUBMODULE),A.links=A.links.filter(nt=>ce(nt)!==M&&oe(nt)!==M);const j=hi.filter(nt=>nt.SUBMODULE===w.SUBMODULE&&nt.SEGMENT===w.SEGMENT&&nt.type!=="tier1"&&nt.type!=="tier2"),z=se.filter(nt=>nt.sourceSubmodule===w.SUBMODULE&&nt.targetSubmodule===w.SUBMODULE&&nt.targetSegment===w.SEGMENT&&nt.sourceSegment===w.SEGMENT);A.nodes=A.nodes.concat(j),A.links=A.links.concat(z),nu(w)}qa(A.nodes.map(M=>M.NAME).join("-")),wr()}}function ru(w){const M=se.filter(z=>z.sourceSubmodule===w.SUBMODULE&&z.targetSubmodule!==w.SUBMODULE),j=se.filter(z=>z.targetSubmodule===w.SUBMODULE&&z.sourceSubmodule!==w.SUBMODULE);se.filter(z=>z.targetSubmodule===w.SUBMODULE&&z.sourceSubmodule===w.SUBMODULE).forEach(z=>{A.links.push({source:"segment-"+w.SUBMODULE+"_"+z.sourceSegment,target:"segment-"+w.SUBMODULE+"_"+z.targetSegment})}),M.forEach(z=>{const nt="segment-"+w.SUBMODULE+"_"+z.sourceSegment,ht="segment-"+z.targetSubmodule+"_"+z.targetSegment,pt="submodule-"+z.targetSubmodule,B=oe(z);let K={};A.nodes.findIndex(Et=>Et.id===ht)!==-1?K={source:nt,target:ht}:A.nodes.findIndex(Et=>Et.id===pt)!==-1?K={source:nt,target:pt}:A.nodes.findIndex(Et=>Et.id===B)!==-1&&(K={source:nt,target:B}),A.links.push(K)}),j.forEach(z=>{const nt="segment-"+w.SUBMODULE+"_"+z.targetSegment,ht="segment-"+z.sourceSubmodule+"_"+z.sourceSegment,pt="submodule-"+z.sourceSubmodule,B=ce(z);let K={};A.nodes.findIndex(Et=>Et.id===ht)!==-1?K={source:ht,target:nt}:A.nodes.findIndex(Et=>Et.id===pt)!==-1?K={source:pt,target:nt}:A.nodes.findIndex(Et=>Et.id===B)!==-1&&(K={source:B,target:nt}),A.links.push(K)})}function nu(w){const M=se.filter(P=>P.sourceSubmodule===w.SUBMODULE&&P.sourceSegment===w.SEGMENT),j=se.filter(P=>P.targetSubmodule===w.SUBMODULE&&P.targetSegment===w.SEGMENT);M.forEach(P=>{const z=ce(P),nt="segment-"+P.targetSubmodule+"_"+P.targetSegment,ht="submodule-"+P.targetSubmodule,pt=oe(P);let B={};A.nodes.findIndex(K=>K.id===nt)!==-1?B={source:z,target:nt}:A.nodes.findIndex(K=>K.id===ht)!==-1?B={source:z,target:ht}:A.nodes.findIndex(K=>K.id===z)!==-1&&A.nodes.findIndex(K=>K.id===pt)!==-1&&(B=P),A.links.push(B)}),j.forEach(P=>{const z=oe(P),nt="segment-"+P.sourceSubmodule+"_"+P.sourceSegment,ht="submodule-"+P.sourceSubmodule,pt=ce(P);let B={};A.nodes.findIndex(K=>K.id===nt)!==-1?B={source:nt,target:z}:A.nodes.findIndex(K=>K.id==ht)!==-1?B={source:ht,target:z}:A.nodes.findIndex(K=>K.id===pt)!==-1&&A.nodes.findIndex(K=>K.id===z)!==-1&&(B=P),A.links.push(B)})}function ia(w){A.nodes.forEach(M=>{const j=ui.get(M);j.visible=!!Pr(w,M.id);const P=ji.get(M);P.visible=!!Pr(w,M.id)}),A.links.forEach(M=>{const j=Ci.get(M);j.alpha=Ls(w,M)?.7:0}),qa(w.map(M=>M).join("-"))}function su(w){A.nodes.forEach(M=>{const j=ui.get(M);j.visible=!0,j.alpha=M.NAME===w?1:.2;const P=ji.get(M);P.visible=M.NAME===w}),A.links.forEach(M=>{const j=Ci.get(M);j.alpha=.1})}function ou(w){const M=A.nodes.find(P=>P.id===w[0]),j=A.nodes.find(P=>P.id===w[1]);w[0]&&Vt(".clickedNodes-1").html("Start node: "+(M?M.NAME:"")),w[1]&&Vt(".clickedNodes-2").html("End node: "+(j?j.NAME:"")),w.length>0&&Vt(".message").style("visibility","visible")}function br(){A.nodes.forEach(w=>{const M=ui.get(w);M.alpha=1,M.visible=!Pr(b,w.id);const j=ji.get(w);j.visible=w.type==="tier1"||w.type==="tier2"}),A.links.forEach(w=>{const M=Ci.get(w);M.alpha=A.links.length>200?.3:y}),gt&&(ue.animate({position:new ot(0,0),scaleX:1,scaleY:1,time:1e3}),document.getElementById("search-input").value="",document.getElementById("suggestions-container").innerHTML="",document.getElementById("reset-search").style.display="none",ze.select(".shortestPath-status").html(""),gt=!1),F=!1,k=!1,et=[],ze.select(".clickedNodes-1").html(""),ze.select(".clickedNodes-2").html(""),ze.select(".shortestPath-status").html(""),ze.style("visibility","hidden"),rs.style("visibility","hidden"),document.querySelectorAll('input[type="checkbox"]').forEach(w=>w.checked=!1),document.querySelectorAll('input[type="checkbox"]').forEach(w=>w.disabled=!1)}function au(w){ue.animate({position:new ot(w.x,w.y),scaleX:2,scaleY:2,time:800}),gt=!0}function hu(w){let M=[];M.push(`<div><h3 style='text-align: center'>${w.NAME}</h3></div>`);const j=li.find(z=>z.NAME===w.NAME);tt.forEach(z=>{M.push(`<div><b>${z}: </b><span>${j[z]}</span></div>`)});let P="";M.map(z=>P+=z),rs.html(`${P}`).style("top","150px").style("left","5px").style("visibility","visible")}function Wg(){function w(st,Ct,At){const vt=document.createElement("button");return vt.textContent=st,At!==6?vt.classList.add("button"):vt.classList.add("button1"),vt.addEventListener("click",Ct),vt}function M(st){switch(st.target.getAttribute("data-button-id")){case"button1":bt=!bt,bt?(st.target.classList.add("clicked"),A.links.forEach(vt=>{const Ot=Ci.get(vt);Ot.getChildByName("ARROW").alpha=1})):(st.target.classList.remove("clicked"),A.links.forEach(vt=>{const Ot=Ci.get(vt);Ot.getChildByName("ARROW").alpha=0}));break;case"button2":St=!St,St?st.target.classList.add("clicked"):(st.target.classList.remove("clicked"),br()),yt=!1,F=!1,document.querySelector('.button[data-button-id="button3"]').classList.remove("clicked");break;case"button3":if(k)return;yt=!yt,yt?st.target.classList.add("clicked"):(st.target.classList.remove("clicked"),br()),St=!1,document.querySelector('.button[data-button-id="button2"]').classList.remove("clicked");break;case"button4":if(k||gt||F)return;ct=!ct,C={},Nt.map(vt=>{C[vt.SUBMODULE]=ct?1:0}),It.map(vt=>{C[vt.SUBMODULE+"_"+vt.SEGMENT]=ct?0:1}),ct?(st.target.classList.add("clicked"),A=Yi(i,t,!0,"SUBMODULE",D),wr(!0)):(st.target.classList.remove("clicked"),A=Yi(i.concat(It),t,!1,"SUBMODULE",D),wr(!0));break;case"button5":if(k||gt||F)return;if(Rt=!Rt,Rt)st.target.classList.remove("clicked"),A.nodes.forEach(vt=>{const Ot=ui.get(vt);Ot.visible=!0}),b=[];else{st.target.classList.add("clicked");const vt=Dd(A.nodes,A.links);b=A.nodes.filter(Ot=>vt.degreeWithoutSelfLoops(Ot.id)===0).map(Ot=>Ot.id),A.nodes.forEach(Ot=>{const cn=ui.get(Ot);cn.visible=!Pr(b,Ot.id)})}break;case"button6":br(),document.querySelectorAll("button").forEach(function(vt,Ot){Ot!==3&&vt.classList.remove("clicked")}),A.links.forEach(vt=>{const Ot=Ci.get(vt);Ot.getChildByName("ARROW").alpha=0}),A.nodes.forEach(vt=>{const Ot=ui.get(vt);Ot.visible=!0,Ot.alpha=1}),et=[],k=!1,F=!1,ct=!1,bt=!1,yt=!1,St=!1,gt=!1,Rt=!0,$t==="Quilt"&&(A=Yi(i.concat(Nt),se,!1,"SUBMODULE",D,"Quilt")),$t==="Middle"&&(A=Yi(i.concat(It),se,!1,"SUBMODULE",D)),$t==="Whole"&&(A=Yi(hi,se,!0,"SUBMODULE",D)),wr();break}}const j=document.getElementById("buttonPanel"),P=document.createElement("div"),z=document.createElement("div");j.appendChild(P),j.appendChild(z),["Show directions","Show shortest path","Show neighbors"].forEach((st,Ct)=>{const At=w(st,M,Ct+1);At.setAttribute("data-button-id",`button${Ct+1}`),bt&&Ct===0&&At.classList.add("clicked"),St&&Ct===1&&At.classList.add("clicked"),yt&&Ct===2&&At.classList.add("clicked"),Rt&&Ct===5&&At.classList.add("clicked"),P.appendChild(At)});const nt=document.createElement("select");nt.id="degreeSelection",P.appendChild(nt);const ht=[1,2,3];for(var pt=0;pt<ht.length;pt++){var B=document.createElement("option");B.value=ht[pt],B.text=ht[pt],nt.appendChild(B)}document.getElementById("degreeSelection").addEventListener("change",function(){Gt=document.getElementById("degreeSelection").value}),["Expanded Graph","Hide Single Nodes","Reset"].forEach((st,Ct)=>{const At=w(st,M,Ct+4);At.setAttribute("data-button-id",`button${Ct+4}`),z.appendChild(At)});const K=document.createElement("select");K.classList.add("default-dd"),K.id="resetSelection",z.appendChild(K);const Et=["Quilt","Middle","Whole"];for(var pt=0;pt<Et.length;pt++){var B=document.createElement("option");B.value=Et[pt],B.text=Et[pt],B.value===$t&&(B.selected=!0),K.appendChild(B)}document.getElementById("resetSelection").addEventListener("change",function(){$t=document.getElementById("resetSelection").value})}function Xg(w){const M=document.getElementById("search-input"),j=document.getElementById("reset-search"),P=document.getElementById("suggestions-container");function z(ht){return w.filter(pt=>pt.NAME.toLowerCase().includes(ht.toLowerCase())||(pt.DEFINITION?pt.DEFINITION.toLowerCase().includes(ht.toLowerCase()):!1))}function nt(ht){const pt=z(ht);P.innerHTML="",pt.sort(function(B,K){return B.NAME.toLowerCase().localeCompare(K.NAME.toLowerCase())}),pt.forEach(B=>{const K=document.createElement("div");K.classList.add("suggestion"),K.textContent=B.DEFINITION?`${B.NAME} - ${B.DEFINITION}`:B.NAME,K.addEventListener("click",()=>{gt=!0,M.value=B.NAME,P.style.display="none",j.style.display="block",A.nodes.find(Et=>Et.NAME===B.NAME)?(au(B),su(B.NAME),document.querySelectorAll('input[type="checkbox"]').forEach(Et=>Et.disabled=!0)):(Vt(".message").style("visibility","visible"),Vt(".shortestPath-status").html("No such node found."))}),P.appendChild(K)}),pt.length>0?P.style.display="block":P.style.display="none"}M.addEventListener("input",()=>{We.alpha(0);const ht=M.value;nt(ht)}),j.addEventListener("click",()=>{gt=!1,M.value="",P.innerHTML="",j.style.display="none",br()}),document.addEventListener("click",ht=>{P.contains(ht.target)||(P.style.display="none")})}}function Pd(i,t){return OI.bidirectional(i,t[0],t[1])}function Rd(i,t,e){let r=[];return t.forEach(n=>{Ad(i,n.id?n.id:n,function(s,o,a){a<=e&&r.push(s)},{mode:"outbound"}),Ad(i,n.id?n.id:n,function(s,o,a){a<=e&&r.push(s)},{mode:"inbound"})}),r}function Dd(i,t){const e=new Pt;for(let r=0;r<i.length;r++)e.hasNode(i[r].id)||e.addNode(i[r].id);for(let r=0;r<t.length;r++){let n=ce(t[r]),s=oe(t[r]);e.hasNode(n)&&e.hasNode(s)&&(e.hasEdge(n,s)||e.addEdge(n,s))}return e}function qa(i){const t=encodeURIComponent(JSON.stringify(i)),e=`${window.location.pathname}?state=${t}`;window.history.pushState({state:i},"",e)}function oM(i){return i.selectAll("input:checked").data().map(t=>t.id)}function Mr(i){return i!==null&&typeof i=="object"?i.valueOf():i}function ce(i){return i.source&&(i.source.id?i.source.id:i.source)}function oe(i){return i.target&&(i.target.id?i.target.id:i.target)}function Ls(i,t){return i.indexOf(ce(t))!==-1&&i.indexOf(oe(t))!==-1}function Pr(i,t){return i.indexOf(t)!==-1}async function aM(){try{const[i,t]=await Promise.all([fetch("/assets/nodes.json"),fetch("/assets/edges.json")]);if(!i.ok||!t.ok)throw new Error(`HTTP error! Status: ${i.status} ${t.status}`);const e=await i.json(),r=await t.json();if(e&&r){const n=["#418BFC","#46BCC8","#D6AB1B","#EB5E68","#B6BE1C","#F64D1A","#BA6DE4","#EA6BCB","#B9AAC8","#F08519"],s=e.map(o=>({NAME:o.NAME,DEFINITION:o.DEFINITION,SUBMODULE:o.SUBMODULE,SUBMODULE_NAME:o["SUBMODULE NAME"],SEGMENT:o.SEGMENT,SEGMENT_NAME:o["SEGMENT NAME"],UNITS:o.UNITS,ReportValue:o.ReportValue,...o}));sM({nodes:s,links:r},{containerSelector:"#app",nodeId:"NAME",sourceId:"UsesVariable",targetId:"Variable",nodeGroup:o=>o.SUBMODULE,nodeTitle:o=>o.NAME,linkStroke:"#fff",nodeStroke:"#000",linkStrokeWidth:.6,linkStroke:"#fff",labelColor:"#fff",labelScale:3,colors:n,width:window.innerWidth,height:window.innerHeight})}else throw new Error("Invalid response format")}catch(i){console.error("Error fetching data:",i)}}aM();
